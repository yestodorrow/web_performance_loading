{"version":3,"file":"configuration.js","names":["assign","display","isPercentage","validateAndBuildConfiguration","validatePostRequestRequireParamsConfiguration","isArray","TraceType","isNullUndefinedDefaultValue","DefaultPrivacyLevel","objectHasValue","isMatchOption","getOrigin","each","buildEnv","isTracingOption","validateAndBuildRumConfiguration","initConfiguration","applicationId","error","requireParamsValidate","sessionReplaySampleRate","undefined","allowedTracingUrls","validateAndBuildTracingOptions","tracingSampleRate","excludedActivityUrls","baseConfiguration","trackUserInteractions","trackInteractions","actionNameAttribute","trackViewsManually","traceType","DDTRACE","traceId128Bit","defaultPrivacyLevel","MASK_USER_INPUT","allowedTracingOrigins","warn","tracingOptions","option","push","match","legacyMatchOption","tracingOption","convertLegacyMatchOptionToTracingOption","allowedDDTracingOrigins","item","RegExp","url","test"],"sources":["../../src/domain/configuration.js"],"sourcesContent":["import {\n  assign,\n  display,\n  isPercentage,\n  validateAndBuildConfiguration,\n  validatePostRequestRequireParamsConfiguration,\n  isArray,\n  TraceType,\n  isNullUndefinedDefaultValue,\n  DefaultPrivacyLevel,\n  objectHasValue,\n  isMatchOption,\n  getOrigin,\n  each\n} from '@cloudcare/browser-core'\nimport { buildEnv } from '../boot/buildEnv'\nimport { isTracingOption } from '../domain/tracing/tracer'\n\nexport function validateAndBuildRumConfiguration(initConfiguration) {\n  if (!initConfiguration.applicationId) {\n    display.error(\n      'Application ID is not configured, no RUM data will be collected.'\n    )\n    return\n  }\n  var requireParamsValidate =\n    validatePostRequestRequireParamsConfiguration(initConfiguration)\n  if (!requireParamsValidate) return\n  // TODO remove fallback in next major\n  if (\n    initConfiguration.sessionReplaySampleRate !== undefined &&\n    !isPercentage(initConfiguration.sessionReplaySampleRate)\n  ) {\n    display.error('Premium Sample Rate should be a number between 0 and 100')\n    return\n  }\n  var allowedTracingUrls = validateAndBuildTracingOptions(initConfiguration)\n  if (!allowedTracingUrls) {\n    return\n  }\n  //   if (initConfiguration.allowedTracingOrigins !== undefined) {\n  //     if (!isArray(initConfiguration.allowedTracingOrigins)) {\n  //       display.error('Allowed Tracing Origins should be an array')\n  //       return\n  //     }\n  //   }\n  //   if (initConfiguration.allowedDDTracingOrigins !== undefined) {\n  //     if (!isArray(initConfiguration.allowedDDTracingOrigins)) {\n  //       display.error('Allowed Tracing Origins should be an array')\n  //       return\n  //     }\n  //   }\n  if (\n    initConfiguration.tracingSampleRate !== undefined &&\n    !isPercentage(initConfiguration.tracingSampleRate)\n  ) {\n    display.error('Tracing Sample Rate should be a number between 0 and 100')\n    return\n  }\n  if (\n    initConfiguration.excludedActivityUrls !== undefined &&\n    !isArray(initConfiguration.excludedActivityUrls)\n  ) {\n    display.error('Excluded Activity Urls should be an array')\n    return\n  }\n\n  var baseConfiguration = validateAndBuildConfiguration(initConfiguration)\n  if (!baseConfiguration) {\n    return\n  }\n  var trackUserInteractions = !!isNullUndefinedDefaultValue(\n    initConfiguration.trackUserInteractions,\n    initConfiguration.trackInteractions\n  )\n\n  return assign(\n    {\n      applicationId: initConfiguration.applicationId,\n      actionNameAttribute: initConfiguration.actionNameAttribute,\n      sessionReplaySampleRate: isNullUndefinedDefaultValue(\n        initConfiguration.sessionReplaySampleRate,\n        100\n      ),\n      tracingSampleRate: initConfiguration.tracingSampleRate,\n      allowedTracingUrls: allowedTracingUrls,\n      excludedActivityUrls: isNullUndefinedDefaultValue(\n        initConfiguration.excludedActivityUrls,\n        []\n      ),\n      trackUserInteractions: trackUserInteractions,\n      trackViewsManually: !!initConfiguration.trackViewsManually,\n      traceType: isNullUndefinedDefaultValue(\n        initConfiguration.traceType,\n        TraceType.DDTRACE\n      ),\n      traceId128Bit: !!initConfiguration.traceId128Bit,\n      defaultPrivacyLevel: objectHasValue(\n        DefaultPrivacyLevel,\n        initConfiguration.defaultPrivacyLevel\n      )\n        ? initConfiguration.defaultPrivacyLevel\n        : DefaultPrivacyLevel.MASK_USER_INPUT\n    },\n    baseConfiguration,\n    buildEnv\n  )\n}\n/**\n * Handles allowedTracingUrls and processes legacy allowedTracingOrigins\n */\nfunction validateAndBuildTracingOptions(initConfiguration) {\n  // Advise about parameters precedence.\n  if (\n    initConfiguration.allowedTracingUrls !== undefined &&\n    initConfiguration.allowedTracingOrigins !== undefined\n  ) {\n    display.warn(\n      'Both allowedTracingUrls and allowedTracingOrigins (deprecated) have been defined. The parameter allowedTracingUrls will override allowedTracingOrigins.'\n    )\n  }\n  // Handle allowedTracingUrls first\n  if (initConfiguration.allowedTracingUrls !== undefined) {\n    if (!isArray(initConfiguration.allowedTracingUrls)) {\n      display.error('Allowed Tracing URLs should be an array')\n      return\n    }\n    // if (initConfiguration.allowedTracingUrls.length !== 0 && initConfiguration.service === undefined) {\n    //   display.error('Service needs to be configured when tracing is enabled')\n    //   return\n    // }\n    // Convert from (MatchOption | TracingOption) to TracingOption, remove unknown properties\n    var tracingOptions = []\n    each(initConfiguration.allowedTracingUrls, function (option) {\n      if (isMatchOption(option)) {\n        tracingOptions.push({\n          match: option,\n          traceType: isNullUndefinedDefaultValue(\n            initConfiguration.traceType,\n            TraceType.DDTRACE\n          )\n        })\n      } else if (isTracingOption(option)) {\n        tracingOptions.push(option)\n      } else {\n        display.warn(\n          'Allowed Tracing Urls parameters should be a string, RegExp, function, or an object. Ignoring parameter',\n          option\n        )\n      }\n    })\n    return tracingOptions\n  }\n\n  // Handle conversion of allowedTracingOrigins to allowedTracingUrls\n  if (initConfiguration.allowedTracingOrigins !== undefined) {\n    if (!isArray(initConfiguration.allowedTracingOrigins)) {\n      display.error('Allowed Tracing Origins should be an array')\n      return\n    }\n\n    var tracingOptions = []\n    each(initConfiguration.allowedTracingOrigins, function (legacyMatchOption) {\n      var tracingOption = convertLegacyMatchOptionToTracingOption(\n        legacyMatchOption,\n        isNullUndefinedDefaultValue(\n          initConfiguration.traceType,\n          TraceType.DDTRACE\n        )\n      )\n      if (tracingOption) {\n        tracingOptions.push(tracingOption)\n      }\n    })\n\n    return tracingOptions\n  }\n  // Handle conversion of allowedDDTracingOrigins to allowedTracingUrls\n  if (initConfiguration.allowedDDTracingOrigins !== undefined) {\n    if (!isArray(initConfiguration.allowedDDTracingOrigins)) {\n      display.error('Allowed Tracing Origins should be an array')\n      return\n    }\n\n    var tracingOptions = []\n    each(\n      initConfiguration.allowedDDTracingOrigins,\n      function (legacyMatchOption) {\n        var tracingOption = convertLegacyMatchOptionToTracingOption(\n          legacyMatchOption,\n          isNullUndefinedDefaultValue(\n            initConfiguration.traceType,\n            TraceType.DDTRACE\n          )\n        )\n        if (tracingOption) {\n          tracingOptions.push(tracingOption)\n        }\n      }\n    )\n\n    return tracingOptions\n  }\n\n  return []\n}\n\n/**\n * Converts parameters from the deprecated allowedTracingOrigins\n * to allowedTracingUrls. Handles the change from origin to full URLs.\n */\nfunction convertLegacyMatchOptionToTracingOption(item, traceType) {\n  var match\n  if (typeof item === 'string') {\n    match = item\n  } else if (item instanceof RegExp) {\n    match = function (url) {\n      return item.test(getOrigin(url))\n    }\n  } else if (typeof item === 'function') {\n    match = function (url) {\n      return item(getOrigin(url))\n    }\n  }\n\n  if (match === undefined) {\n    display.warn(\n      'Allowed Tracing Origins parameters should be a string, RegExp or function. Ignoring parameter',\n      item\n    )\n    return undefined\n  }\n\n  return { match: match, traceType: traceType }\n}\n"],"mappings":"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","ignoreList":[]}