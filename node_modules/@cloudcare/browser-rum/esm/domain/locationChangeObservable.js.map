{"version":3,"file":"locationChangeObservable.js","names":["addEventListener","DOM_EVENT","Observable","shallowClone","instrumentMethodAndCallOriginal","createLocationChangeObservable","location","currentLocation","observable","_trackHistory","trackHistory","onLocationChange","_trackHash","trackHash","href","newLocation","notify","oldLocation","stop","onHistoryChange","pushState","history","after","replaceState","popState","window","POP_STATE","onHashChange","HASH_CHANGE"],"sources":["../../src/domain/locationChangeObservable.js"],"sourcesContent":["import {\n  addEventListener,\n  DOM_EVENT,\n  Observable,\n  shallowClone,\n  instrumentMethodAndCallOriginal\n} from '@cloudcare/browser-core'\n\nexport function createLocationChangeObservable(location) {\n  var currentLocation = shallowClone(location)\n  return new Observable(function (observable) {\n    var _trackHistory = trackHistory(onLocationChange)\n    var _trackHash = trackHash(onLocationChange)\n    function onLocationChange() {\n      if (currentLocation.href === location.href) {\n        return\n      }\n      var newLocation = shallowClone(location)\n      observable.notify({\n        newLocation: newLocation,\n        oldLocation: currentLocation\n      })\n      currentLocation = newLocation\n    }\n    return function () {\n      _trackHistory.stop()\n      _trackHash.stop()\n    }\n  })\n}\n\nfunction trackHistory(onHistoryChange) {\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  var pushState = instrumentMethodAndCallOriginal(history, 'pushState', {\n    after: onHistoryChange\n  })\n  var replaceState = instrumentMethodAndCallOriginal(history, 'replaceState', {\n    after: onHistoryChange\n  })\n  var popState = addEventListener(window, DOM_EVENT.POP_STATE, onHistoryChange)\n\n  return {\n    stop: function () {\n      pushState.stop()\n      replaceState.stop()\n      popState.stop()\n    }\n  }\n}\n\nfunction trackHash(onHashChange) {\n  return addEventListener(window, DOM_EVENT.HASH_CHANGE, onHashChange)\n}\n"],"mappings":"AAAA,SACEA,gBAAgB,EAChBC,SAAS,EACTC,UAAU,EACVC,YAAY,EACZC,+BAA+B,QAC1B,yBAAyB;AAEhC,OAAO,SAASC,8BAA8BA,CAACC,QAAQ,EAAE;EACvD,IAAIC,eAAe,GAAGJ,YAAY,CAACG,QAAQ,CAAC;EAC5C,OAAO,IAAIJ,UAAU,CAAC,UAAUM,UAAU,EAAE;IAC1C,IAAIC,aAAa,GAAGC,YAAY,CAACC,gBAAgB,CAAC;IAClD,IAAIC,UAAU,GAAGC,SAAS,CAACF,gBAAgB,CAAC;IAC5C,SAASA,gBAAgBA,CAAA,EAAG;MAC1B,IAAIJ,eAAe,CAACO,IAAI,KAAKR,QAAQ,CAACQ,IAAI,EAAE;QAC1C;MACF;MACA,IAAIC,WAAW,GAAGZ,YAAY,CAACG,QAAQ,CAAC;MACxCE,UAAU,CAACQ,MAAM,CAAC;QAChBD,WAAW,EAAEA,WAAW;QACxBE,WAAW,EAAEV;MACf,CAAC,CAAC;MACFA,eAAe,GAAGQ,WAAW;IAC/B;IACA,OAAO,YAAY;MACjBN,aAAa,CAACS,IAAI,CAAC,CAAC;MACpBN,UAAU,CAACM,IAAI,CAAC,CAAC;IACnB,CAAC;EACH,CAAC,CAAC;AACJ;AAEA,SAASR,YAAYA,CAACS,eAAe,EAAE;EACrC;EACA,IAAIC,SAAS,GAAGhB,+BAA+B,CAACiB,OAAO,EAAE,WAAW,EAAE;IACpEC,KAAK,EAAEH;EACT,CAAC,CAAC;EACF,IAAII,YAAY,GAAGnB,+BAA+B,CAACiB,OAAO,EAAE,cAAc,EAAE;IAC1EC,KAAK,EAAEH;EACT,CAAC,CAAC;EACF,IAAIK,QAAQ,GAAGxB,gBAAgB,CAACyB,MAAM,EAAExB,SAAS,CAACyB,SAAS,EAAEP,eAAe,CAAC;EAE7E,OAAO;IACLD,IAAI,EAAE,SAAAA,KAAA,EAAY;MAChBE,SAAS,CAACF,IAAI,CAAC,CAAC;MAChBK,YAAY,CAACL,IAAI,CAAC,CAAC;MACnBM,QAAQ,CAACN,IAAI,CAAC,CAAC;IACjB;EACF,CAAC;AACH;AAEA,SAASL,SAASA,CAACc,YAAY,EAAE;EAC/B,OAAO3B,gBAAgB,CAACyB,MAAM,EAAExB,SAAS,CAAC2B,WAAW,EAAED,YAAY,CAAC;AACtE","ignoreList":[]}