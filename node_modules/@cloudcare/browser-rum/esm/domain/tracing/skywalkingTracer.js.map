{"version":3,"file":"skywalkingTracer.js","names":["base64Encode","urlParse","uuid","replace","c","r","Math","random","v","toString","getSkyWalkingSw8","traceId","traceSegmentId","applicationId","env","version","requestUrlHost","traceIdStr","String","segmentId","service","instance","endpoint","window","location","href","peer","index","err","SkyWalkingTracer","configuration","requestUrl","traceSampled","_spanId","_traceId","_applicationId","_env","_version","_urlParse","getParse","_traceSampled","prototype","isTracingSupported","getSpanId","getTraceId","Host","makeTracingHeaders","sw8"],"sources":["../../../src/domain/tracing/skywalkingTracer.js"],"sourcesContent":["import { base64Encode, urlParse } from '@cloudcare/browser-core'\n// start SkyWalking\nfunction uuid() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    /* tslint:disable */\n    var r = (Math.random() * 16) | 0\n    /* tslint:disable */\n    var v = c === 'x' ? r : (r & 0x3) | 0x8\n\n    return v.toString(16)\n  })\n}\n/**\n *\n * @param {*} traceId\n * @param {*} traceSegmentId\n * @param {*} applicationId\n * @param {*} version\n * @param {*} requestUrlHost\n */\nfunction getSkyWalkingSw8(\n  traceId,\n  traceSegmentId,\n  applicationId,\n  env,\n  version,\n  requestUrlHost\n) {\n  try {\n    var traceIdStr = String(base64Encode(traceId))\n    var segmentId = String(base64Encode(traceSegmentId))\n    var service = String(base64Encode(applicationId + '_rum_' + env))\n    var instance = String(base64Encode(version))\n    var endpoint = String(base64Encode(window.location.href))\n    var peer = String(base64Encode(requestUrlHost))\n    var index = '0'\n    // var values = `${1}-${traceIdStr}-${segmentId}-${index}-${service}-${instance}-${endpoint}-${peer}`;\n    return (\n      '1-' +\n      traceIdStr +\n      '-' +\n      segmentId +\n      '-' +\n      index +\n      '-' +\n      service +\n      '-' +\n      instance +\n      '-' +\n      endpoint +\n      '-' +\n      peer\n    )\n  } catch (err) {\n    return ''\n  }\n}\n/**\n *\n * @param {*} configuration  配置信息\n * @param {*} requestUrl 请求的url\n */\nexport function SkyWalkingTracer(configuration, requestUrl, traceSampled) {\n  this._spanId = uuid()\n  this._traceId = uuid()\n  this._applicationId = configuration.applicationId\n  this._env = configuration.env\n  this._version = configuration.version\n  this._urlParse = urlParse(requestUrl).getParse()\n  this._traceSampled = traceSampled\n}\nSkyWalkingTracer.prototype = {\n  isTracingSupported: function () {\n    if (this._env && this._version && this._urlParse) return true\n    return false\n  },\n  getSpanId: function () {\n    return this._spanId\n  },\n  getTraceId: function () {\n    return this._traceId\n  },\n  getSkyWalkingSw8: function () {\n    try {\n      var traceIdStr = String(base64Encode(this._traceId))\n      var segmentId = String(base64Encode(this._spanId))\n      var service = String(\n        base64Encode(this._applicationId + '_rum_' + this.env)\n      )\n      var instance = String(base64Encode(this._version))\n      var endpoint = String(base64Encode(window.location.href))\n      var peer = String(base64Encode(this._urlParse.Host))\n      var index = '0'\n      // var values = `${1}-${traceIdStr}-${segmentId}-${index}-${service}-${instance}-${endpoint}-${peer}`;\n      return (\n        (this._traceSampled ? '1' : '0') +\n        '-' +\n        traceIdStr +\n        '-' +\n        segmentId +\n        '-' +\n        index +\n        '-' +\n        service +\n        '-' +\n        instance +\n        '-' +\n        endpoint +\n        '-' +\n        peer\n      )\n    } catch (err) {\n      return ''\n    }\n  },\n  makeTracingHeaders: function () {\n    return {\n      sw8: this.getSkyWalkingSw8()\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}