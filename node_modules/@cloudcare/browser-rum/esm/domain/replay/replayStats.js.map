{"version":3,"file":"replayStats.js","names":["MAX_STATS_HISTORY","statsPerView","getSegmentsCount","viewId","getOrCreateReplayStats","segments_count","addSegment","addRecord","records_count","addWroteData","additionalBytesCount","segments_total_raw_size","getReplayStats","get","resetReplayStats","undefined","Map","replayStats","has","set","size","deleteOldestStats","keys","next","value","isFirst","forEach","_value","key"],"sources":["../../../src/domain/replay/replayStats.js"],"sourcesContent":["export var MAX_STATS_HISTORY = 10\nvar statsPerView\n\nexport function getSegmentsCount(viewId) {\n  return getOrCreateReplayStats(viewId).segments_count\n}\n\nexport function addSegment(viewId) {\n  getOrCreateReplayStats(viewId).segments_count += 1\n}\n\nexport function addRecord(viewId) {\n  getOrCreateReplayStats(viewId).records_count += 1\n}\n\nexport function addWroteData(viewId, additionalBytesCount) {\n  getOrCreateReplayStats(viewId).segments_total_raw_size += additionalBytesCount\n}\n\nexport function getReplayStats(viewId) {\n  return statsPerView && statsPerView.get(viewId)\n}\n\nexport function resetReplayStats() {\n  statsPerView = undefined\n}\n\nfunction getOrCreateReplayStats(viewId) {\n  if (!statsPerView) {\n    statsPerView = new Map()\n  }\n\n  var replayStats\n  if (statsPerView.has(viewId)) {\n    replayStats = statsPerView.get(viewId)\n  } else {\n    replayStats = {\n      records_count: 0,\n      segments_count: 0,\n      segments_total_raw_size: 0\n    }\n    statsPerView.set(viewId, replayStats)\n    if (statsPerView.size > MAX_STATS_HISTORY) {\n      deleteOldestStats()\n    }\n  }\n\n  return replayStats\n}\n\nfunction deleteOldestStats() {\n  if (!statsPerView) {\n    return\n  }\n  if (statsPerView.keys) {\n    statsPerView.delete(statsPerView.keys().next().value)\n  } else {\n    // IE11 doesn't support map.keys\n    var isFirst = true\n    statsPerView.forEach(function (_value, key) {\n      if (isFirst) {\n        statsPerView.delete(key)\n        isFirst = false\n      }\n    })\n  }\n}\n"],"mappings":"AAAA,OAAO,IAAIA,iBAAiB,GAAG,EAAE;AACjC,IAAIC,YAAY;AAEhB,OAAO,SAASC,gBAAgBA,CAACC,MAAM,EAAE;EACvC,OAAOC,sBAAsB,CAACD,MAAM,CAAC,CAACE,cAAc;AACtD;AAEA,OAAO,SAASC,UAAUA,CAACH,MAAM,EAAE;EACjCC,sBAAsB,CAACD,MAAM,CAAC,CAACE,cAAc,IAAI,CAAC;AACpD;AAEA,OAAO,SAASE,SAASA,CAACJ,MAAM,EAAE;EAChCC,sBAAsB,CAACD,MAAM,CAAC,CAACK,aAAa,IAAI,CAAC;AACnD;AAEA,OAAO,SAASC,YAAYA,CAACN,MAAM,EAAEO,oBAAoB,EAAE;EACzDN,sBAAsB,CAACD,MAAM,CAAC,CAACQ,uBAAuB,IAAID,oBAAoB;AAChF;AAEA,OAAO,SAASE,cAAcA,CAACT,MAAM,EAAE;EACrC,OAAOF,YAAY,IAAIA,YAAY,CAACY,GAAG,CAACV,MAAM,CAAC;AACjD;AAEA,OAAO,SAASW,gBAAgBA,CAAA,EAAG;EACjCb,YAAY,GAAGc,SAAS;AAC1B;AAEA,SAASX,sBAAsBA,CAACD,MAAM,EAAE;EACtC,IAAI,CAACF,YAAY,EAAE;IACjBA,YAAY,GAAG,IAAIe,GAAG,CAAC,CAAC;EAC1B;EAEA,IAAIC,WAAW;EACf,IAAIhB,YAAY,CAACiB,GAAG,CAACf,MAAM,CAAC,EAAE;IAC5Bc,WAAW,GAAGhB,YAAY,CAACY,GAAG,CAACV,MAAM,CAAC;EACxC,CAAC,MAAM;IACLc,WAAW,GAAG;MACZT,aAAa,EAAE,CAAC;MAChBH,cAAc,EAAE,CAAC;MACjBM,uBAAuB,EAAE;IAC3B,CAAC;IACDV,YAAY,CAACkB,GAAG,CAAChB,MAAM,EAAEc,WAAW,CAAC;IACrC,IAAIhB,YAAY,CAACmB,IAAI,GAAGpB,iBAAiB,EAAE;MACzCqB,iBAAiB,CAAC,CAAC;IACrB;EACF;EAEA,OAAOJ,WAAW;AACpB;AAEA,SAASI,iBAAiBA,CAAA,EAAG;EAC3B,IAAI,CAACpB,YAAY,EAAE;IACjB;EACF;EACA,IAAIA,YAAY,CAACqB,IAAI,EAAE;IACrBrB,YAAY,UAAO,CAACA,YAAY,CAACqB,IAAI,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC;EACvD,CAAC,MAAM;IACL;IACA,IAAIC,OAAO,GAAG,IAAI;IAClBxB,YAAY,CAACyB,OAAO,CAAC,UAAUC,MAAM,EAAEC,GAAG,EAAE;MAC1C,IAAIH,OAAO,EAAE;QACXxB,YAAY,UAAO,CAAC2B,GAAG,CAAC;QACxBH,OAAO,GAAG,KAAK;MACjB;IACF,CAAC,CAAC;EACJ;AACF","ignoreList":[]}