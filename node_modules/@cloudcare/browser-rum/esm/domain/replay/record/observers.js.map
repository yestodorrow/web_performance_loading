{"version":3,"file":"observers.js","names":["instrumentSetter","instrumentMethodAndCallOriginal","assign","throttle","DOM_EVENT","addEventListeners","addEventListener","noop","LifeCycleEventType","RumEventType","ActionType","isNodeShadowHost","cssEscape","getScrollX","getScrollY","initViewportObservable","NodePrivacyLevel","RecordType","IncrementalSource","MediaInteractionType","MouseInteractionType","getNodePrivacyLevel","shouldMaskNode","getElementInputValue","getSerializedNodeId","hasSerializedNode","assembleIncrementalSnapshot","forEach","getPathToNestedCSSRule","isTouchEvent","startMutationObserver","getVisualViewport","convertMouseEventToLayoutCoordinates","MOUSE_MOVE_OBSERVER_THRESHOLD","SCROLL_OBSERVER_THRESHOLD","VISUAL_VIEWPORT_OBSERVER_THRESHOLD","recordIds","WeakMap","nextId","getRecordIdForEvent","event","has","set","get","initObservers","o","mutationHandler","initMutationObserver","mutationCb","configuration","shadowRootsController","mousemoveHandler","initMoveObserver","mousemoveCb","mouseInteractionHandler","initMouseInteractionObserver","mouseInteractionCb","defaultPrivacyLevel","scrollHandler","initScrollObserver","scrollCb","elementsScrollPositions","viewportResizeHandler","initViewportResizeObserver","viewportResizeCb","inputHandler","initInputObserver","inputCb","mediaInteractionHandler","initMediaInteractionObserver","mediaInteractionCb","styleSheetObserver","initStyleSheetObserver","styleSheetCb","focusHandler","initFocusObserver","focusCb","visualViewportResizeHandler","initVisualViewportResizeObserver","visualViewportResizeCb","frustrationHandler","initFrustrationObserver","lifeCycle","frustrationCb","flush","stop","cb","document","_updatePosition","target","getEventTarget","coordinates","tryToComputeCoordinates","position","id","timeOffset","x","y","TouchMove","MouseMove","trailing","cancelThrottle","cancel","updatePosition","throttled","_listener","MOUSE_MOVE","TOUCH_MOVE","capture","passive","removeListener","eventTypeToMouseInteraction","_eventTypeToMouseInte","_defineProperty","POINTER_UP","MouseUp","MOUSE_DOWN","MouseDown","CLICK","Click","CONTEXT_MENU","ContextMenu","DBL_CLICK","DblClick","FOCUS","Focus","BLUR","Blur","TOUCH_START","TouchStart","TOUCH_END","TouchEnd","handler","HIDDEN","type","interaction","record","MouseInteraction","Object","keys","_event","changedTouches","clientX","clientY","window","visualViewport","_convertMouseEventToLayoutCoordinates","visualViewportX","visualViewportY","Number","isFinite","undefined","scrollPositions","scrollTop","scrollLeft","Math","round","SCROLL","subscribe","unsubscribe","lastInputStateMap","isShadowRoot","_addEventListeners","CHANGE","INPUT","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","onElementChange","stopEventListeners","stopPropertySetterInstrumentation","instrumentationStoppers","prototype","stopper","nodePrivacyLevel","inputState","isChecked","checked","value","text","cbWithDedup","name","querySelectorAll","el","lastInputState","checkStyleSheetAndCallback","styleSheet","callback","ownerNode","CSSStyleSheet","before","rule","index","adds","removes","CSSGroupingRule","instrumentGroupingCSSRuleClass","CSSMediaRule","CSSSupportsRule","cls","push","_this","parentStyleSheet","path","PLAY","Play","Pause","PAUSE","has_focus","hasFocus","_updateDimension","RESIZE","RAW_RUM_EVENT_COLLECTED","data","rawRumEvent","ACTION","action","frustration","length","domainContext","events","timestamp","date","FrustrationRecord","frustrationTypes","map","e","composed","composedPath"],"sources":["../../../../src/domain/replay/record/observers.js"],"sourcesContent":["import {\n  instrumentSetter,\n  instrumentMethodAndCallOriginal,\n  assign,\n  throttle,\n  DOM_EVENT,\n  addEventListeners,\n  addEventListener,\n  noop,\n  LifeCycleEventType,\n  RumEventType,\n  ActionType,\n  isNodeShadowHost,\n  cssEscape,\n  getScrollX,\n  getScrollY\n} from '@cloudcare/browser-core'\nimport { initViewportObservable } from '../../initViewportObservable'\nimport { NodePrivacyLevel } from '../../../constants'\n\nimport {\n  RecordType,\n  IncrementalSource,\n  MediaInteractionType,\n  MouseInteractionType\n} from '../../../types'\nimport { getNodePrivacyLevel, shouldMaskNode } from './privacy'\nimport {\n  getElementInputValue,\n  getSerializedNodeId,\n  hasSerializedNode\n} from './serializationUtils'\nimport {\n  assembleIncrementalSnapshot,\n  forEach,\n  getPathToNestedCSSRule,\n  isTouchEvent\n} from './utils'\nimport { startMutationObserver } from './mutationObserver'\nimport {\n  getVisualViewport,\n  convertMouseEventToLayoutCoordinates\n} from './viewports'\n\nvar MOUSE_MOVE_OBSERVER_THRESHOLD = 50\nvar SCROLL_OBSERVER_THRESHOLD = 100\nvar VISUAL_VIEWPORT_OBSERVER_THRESHOLD = 200\n\nvar recordIds = new WeakMap()\nlet nextId = 1\n\nexport function getRecordIdForEvent(event) {\n  if (!recordIds.has(event)) {\n    recordIds.set(event, nextId++)\n  }\n  return recordIds.get(event)\n}\nexport function initObservers(o) {\n  var mutationHandler = initMutationObserver(\n    o.mutationCb,\n    o.configuration,\n    o.shadowRootsController\n  )\n  var mousemoveHandler = initMoveObserver(o.mousemoveCb)\n  var mouseInteractionHandler = initMouseInteractionObserver(\n    o.mouseInteractionCb,\n    o.configuration.defaultPrivacyLevel\n  )\n  var scrollHandler = initScrollObserver(\n    o.scrollCb,\n    o.configuration.defaultPrivacyLevel,\n    o.elementsScrollPositions\n  )\n  var viewportResizeHandler = initViewportResizeObserver(o.viewportResizeCb)\n  var inputHandler = initInputObserver(\n    o.inputCb,\n    o.configuration.defaultPrivacyLevel\n  )\n  var mediaInteractionHandler = initMediaInteractionObserver(\n    o.mediaInteractionCb,\n    o.configuration.defaultPrivacyLevel\n  )\n  var styleSheetObserver = initStyleSheetObserver(o.styleSheetCb)\n  var focusHandler = initFocusObserver(o.focusCb)\n  var visualViewportResizeHandler = initVisualViewportResizeObserver(\n    o.visualViewportResizeCb\n  )\n  var frustrationHandler = initFrustrationObserver(o.lifeCycle, o.frustrationCb)\n\n  return {\n    flush: function () {\n      mutationHandler.flush()\n    },\n    stop: function () {\n      mutationHandler.stop()\n      mousemoveHandler()\n      mouseInteractionHandler()\n      scrollHandler()\n      viewportResizeHandler()\n      inputHandler()\n      mediaInteractionHandler()\n      styleSheetObserver()\n      focusHandler()\n      visualViewportResizeHandler()\n      frustrationHandler()\n    }\n  }\n}\n\nexport function initMutationObserver(cb, configuration, shadowRootsController) {\n  return startMutationObserver(\n    cb,\n    configuration,\n    shadowRootsController,\n    document\n  )\n}\n\nexport function initMoveObserver(cb) {\n  var _updatePosition = throttle(\n    function (event) {\n      var target = getEventTarget(event)\n      if (hasSerializedNode(target)) {\n        var coordinates = tryToComputeCoordinates(event)\n        if (!coordinates) {\n          return\n        }\n        var position = {\n          id: getSerializedNodeId(target),\n          timeOffset: 0,\n          x: coordinates.x,\n          y: coordinates.y\n        }\n\n        cb(\n          [position],\n          isTouchEvent(event)\n            ? IncrementalSource.TouchMove\n            : IncrementalSource.MouseMove\n        )\n      }\n    },\n    MOUSE_MOVE_OBSERVER_THRESHOLD,\n    {\n      trailing: false\n    }\n  )\n  var cancelThrottle = _updatePosition.cancel\n  var updatePosition = _updatePosition.throttled\n\n  var _listener = addEventListeners(\n    document,\n    [DOM_EVENT.MOUSE_MOVE, DOM_EVENT.TOUCH_MOVE],\n    updatePosition,\n    {\n      capture: true,\n      passive: true\n    }\n  )\n  var removeListener = _listener.stop\n  return function () {\n    removeListener()\n    cancelThrottle()\n  }\n}\n\nvar eventTypeToMouseInteraction = {\n  // Listen for pointerup DOM events instead of mouseup for MouseInteraction/MouseUp records. This\n  // allows to reference such records from Frustration records.\n  //\n  // In the context of supporting Mobile Session Replay, we introduced `PointerInteraction` records\n  // used by the Mobile SDKs in place of `MouseInteraction`. In the future, we should replace\n  // `MouseInteraction` by `PointerInteraction` in the Browser SDK so we have an uniform way to\n  // convey such interaction. This would cleanly solve the issue since we would have\n  // `PointerInteraction/Up` records that we could reference from `Frustration` records.\n  [DOM_EVENT.POINTER_UP]: MouseInteractionType.MouseUp,\n\n  [DOM_EVENT.MOUSE_DOWN]: MouseInteractionType.MouseDown,\n  [DOM_EVENT.CLICK]: MouseInteractionType.Click,\n  [DOM_EVENT.CONTEXT_MENU]: MouseInteractionType.ContextMenu,\n  [DOM_EVENT.DBL_CLICK]: MouseInteractionType.DblClick,\n  [DOM_EVENT.FOCUS]: MouseInteractionType.Focus,\n  [DOM_EVENT.BLUR]: MouseInteractionType.Blur,\n  [DOM_EVENT.TOUCH_START]: MouseInteractionType.TouchStart,\n  [DOM_EVENT.TOUCH_END]: MouseInteractionType.TouchEnd\n}\nexport function initMouseInteractionObserver(cb, defaultPrivacyLevel) {\n  var handler = function (event) {\n    var target = getEventTarget(event)\n    if (\n      getNodePrivacyLevel(target, defaultPrivacyLevel) ===\n        NodePrivacyLevel.HIDDEN ||\n      !hasSerializedNode(target)\n    ) {\n      return\n    }\n    var id = getSerializedNodeId(target)\n    var type = eventTypeToMouseInteraction[event.type]\n\n    var interaction\n    if (\n      type !== MouseInteractionType.Blur &&\n      type !== MouseInteractionType.Focus\n    ) {\n      var coordinates = tryToComputeCoordinates(event)\n      if (!coordinates) {\n        return\n      }\n      interaction = { id: id, type: type, x: coordinates.x, y: coordinates.y }\n    } else {\n      interaction = { id: id, type: type }\n    }\n\n    var record = assign(\n      { id: getRecordIdForEvent(event) },\n      assembleIncrementalSnapshot(\n        IncrementalSource.MouseInteraction,\n        interaction\n      )\n    )\n    cb(record)\n  }\n  return addEventListeners(\n    document,\n    Object.keys(eventTypeToMouseInteraction),\n    handler,\n    {\n      capture: true,\n      passive: true\n    }\n  ).stop\n}\n\nfunction tryToComputeCoordinates(event) {\n  var _event = isTouchEvent(event) ? event.changedTouches[0] : event\n  var x = _event.clientX\n  var y = _event.clientY\n  if (window.visualViewport) {\n    var _convertMouseEventToLayoutCoordinates =\n      convertMouseEventToLayoutCoordinates(x, y)\n    x = _convertMouseEventToLayoutCoordinates.visualViewportX\n    y = _convertMouseEventToLayoutCoordinates.visualViewportY\n  }\n  if (!Number.isFinite(x) || !Number.isFinite(y)) {\n    return undefined\n  }\n  return { x: x, y: y }\n}\n\nfunction initScrollObserver(cb, defaultPrivacyLevel, elementsScrollPositions) {\n  var _updatePosition = throttle(function (event) {\n    var target = getEventTarget(event)\n    if (\n      !target ||\n      getNodePrivacyLevel(target, defaultPrivacyLevel) ===\n        NodePrivacyLevel.HIDDEN ||\n      !hasSerializedNode(target)\n    ) {\n      return\n    }\n    var id = getSerializedNodeId(target)\n    var scrollPositions =\n      target === document\n        ? {\n            scrollTop: getScrollY(),\n            scrollLeft: getScrollX()\n          }\n        : {\n            scrollTop: Math.round(target.scrollTop),\n            scrollLeft: Math.round(target.scrollLeft)\n          }\n    elementsScrollPositions.set(target, scrollPositions)\n    cb({\n      id: id,\n      x: scrollPositions.scrollLeft,\n      y: scrollPositions.scrollTop\n    })\n  }, SCROLL_OBSERVER_THRESHOLD)\n  var cancelThrottle = _updatePosition.cancel\n  var updatePosition = _updatePosition.throttled\n\n  var _listener = addEventListener(document, DOM_EVENT.SCROLL, updatePosition, {\n    capture: true,\n    passive: true\n  })\n  var removeListener = _listener.stop\n  return function () {\n    removeListener()\n    cancelThrottle()\n  }\n}\n\nfunction initViewportResizeObserver(cb) {\n  return initViewportObservable().subscribe(cb).unsubscribe\n}\n\nexport function initInputObserver(cb, defaultPrivacyLevel, target) {\n  if (target === undefined) {\n    target = document\n  }\n  var lastInputStateMap = new WeakMap()\n  var isShadowRoot = target !== document\n\n  var _addEventListeners = addEventListeners(\n    target,\n    // The 'input' event bubbles across shadow roots, so we don't have to listen for it on shadow\n    // roots since it will be handled by the event listener that we did add to the document. Only\n    // the 'change' event is blocked and needs to be handled on shadow roots.\n    isShadowRoot ? [DOM_EVENT.CHANGE] : [DOM_EVENT.INPUT, DOM_EVENT.CHANGE],\n    function (event) {\n      var target = getEventTarget(event)\n      if (\n        target instanceof HTMLInputElement ||\n        target instanceof HTMLTextAreaElement ||\n        target instanceof HTMLSelectElement\n      ) {\n        onElementChange(target)\n      }\n    },\n    {\n      capture: true,\n      passive: true\n    }\n  )\n  var stopEventListeners = _addEventListeners.stop\n  var stopPropertySetterInstrumentation\n  if (!isShadowRoot) {\n    const instrumentationStoppers = [\n      instrumentSetter(HTMLInputElement.prototype, 'value', onElementChange),\n      instrumentSetter(HTMLInputElement.prototype, 'checked', onElementChange),\n      instrumentSetter(HTMLSelectElement.prototype, 'value', onElementChange),\n      instrumentSetter(HTMLTextAreaElement.prototype, 'value', onElementChange),\n      instrumentSetter(\n        HTMLSelectElement.prototype,\n        'selectedIndex',\n        onElementChange\n      )\n    ]\n    stopPropertySetterInstrumentation = function () {\n      instrumentationStoppers.forEach(function (stopper) {\n        return stopper.stop()\n      })\n    }\n  } else {\n    stopPropertySetterInstrumentation = noop\n  }\n\n  return function () {\n    stopPropertySetterInstrumentation()\n    stopEventListeners()\n  }\n\n  function onElementChange(target) {\n    var nodePrivacyLevel = getNodePrivacyLevel(target, defaultPrivacyLevel)\n    if (nodePrivacyLevel === NodePrivacyLevel.HIDDEN) {\n      return\n    }\n\n    var type = target.type\n\n    let inputState\n    if (type === 'radio' || type === 'checkbox') {\n      if (shouldMaskNode(target, nodePrivacyLevel)) {\n        return\n      }\n      inputState = { isChecked: target.checked }\n    } else {\n      var value = getElementInputValue(target, nodePrivacyLevel)\n      if (value === undefined) {\n        return\n      }\n      inputState = { text: value }\n    }\n\n    // Can be multiple changes on the same node within the same batched mutation observation.\n    cbWithDedup(target, inputState)\n\n    // If a radio was checked, other radios with the same name attribute will be unchecked.\n    var name = target.name\n    if (type === 'radio' && name && target.checked) {\n      forEach(\n        document.querySelectorAll(\n          'input[type=\"radio\"][name=\"' + cssEscape(name) + '\"]'\n        ),\n        function (el) {\n          if (el !== target) {\n            cbWithDedup(el, { isChecked: false })\n          }\n        }\n      )\n    }\n  }\n\n  /**\n   * There can be multiple changes on the same node within the same batched mutation observation.\n   */\n  function cbWithDedup(target, inputState) {\n    if (!hasSerializedNode(target)) {\n      return\n    }\n    var lastInputState = lastInputStateMap.get(target)\n    if (\n      !lastInputState ||\n      lastInputState.text !== inputState.text ||\n      lastInputState.isChecked !== inputState.isChecked\n    ) {\n      lastInputStateMap.set(target, inputState)\n      cb(\n        assign(\n          {\n            id: getSerializedNodeId(target)\n          },\n          inputState\n        )\n      )\n    }\n  }\n}\n\nexport function initStyleSheetObserver(cb) {\n  function checkStyleSheetAndCallback(styleSheet, callback) {\n    if (styleSheet && hasSerializedNode(styleSheet.ownerNode)) {\n      callback(getSerializedNodeId(styleSheet.ownerNode))\n    }\n  }\n\n  var instrumentationStoppers = [\n    instrumentMethodAndCallOriginal(CSSStyleSheet.prototype, 'insertRule', {\n      before: function (rule, index) {\n        checkStyleSheetAndCallback(this, function (id) {\n          return cb({ id: id, adds: [{ rule: rule, index: index }] })\n        })\n      }\n    }),\n    instrumentMethodAndCallOriginal(CSSStyleSheet.prototype, 'deleteRule', {\n      before: function (index) {\n        checkStyleSheetAndCallback(this, function (id) {\n          return cb({ id: id, removes: [{ index: index }] })\n        })\n      }\n    })\n  ]\n\n  if (typeof CSSGroupingRule !== 'undefined') {\n    instrumentGroupingCSSRuleClass(CSSGroupingRule)\n  } else {\n    instrumentGroupingCSSRuleClass(CSSMediaRule)\n    instrumentGroupingCSSRuleClass(CSSSupportsRule)\n  }\n\n  function instrumentGroupingCSSRuleClass(cls) {\n    instrumentationStoppers.push(\n      instrumentMethodAndCallOriginal(cls.prototype, 'insertRule', {\n        before: function (rule, index) {\n          var _this = this\n          checkStyleSheetAndCallback(this.parentStyleSheet, function (id) {\n            var path = getPathToNestedCSSRule(_this)\n            if (path) {\n              path.push(index || 0)\n              cb({ id: id, adds: [{ rule: rule, index: path }] })\n            }\n          })\n        }\n      }),\n      instrumentMethodAndCallOriginal(cls.prototype, 'deleteRule', {\n        before: function (index) {\n          var _this = this\n          checkStyleSheetAndCallback(this.parentStyleSheet, function (id) {\n            var path = getPathToNestedCSSRule(_this)\n            if (path) {\n              path.push(index)\n              cb({ id: id, removes: [{ index: path }] })\n            }\n          })\n        }\n      })\n    )\n  }\n\n  return function () {\n    instrumentationStoppers.forEach(function (stopper) {\n      stopper.stop()\n    })\n  }\n}\n\nfunction initMediaInteractionObserver(mediaInteractionCb, defaultPrivacyLevel) {\n  var handler = function (event) {\n    var target = getEventTarget(event)\n    if (\n      !target ||\n      getNodePrivacyLevel(target, defaultPrivacyLevel) ===\n        NodePrivacyLevel.HIDDEN ||\n      !hasSerializedNode(target)\n    ) {\n      return\n    }\n    mediaInteractionCb({\n      id: getSerializedNodeId(target),\n      type:\n        event.type === DOM_EVENT.PLAY\n          ? MediaInteractionType.Play\n          : MediaInteractionType.Pause\n    })\n  }\n  return addEventListeners(\n    document,\n    [DOM_EVENT.PLAY, DOM_EVENT.PAUSE],\n    handler,\n    { capture: true, passive: true }\n  ).stop\n}\n\nfunction initFocusObserver(focusCb) {\n  return addEventListeners(\n    window,\n    [DOM_EVENT.FOCUS, DOM_EVENT.BLUR],\n    function () {\n      focusCb({ has_focus: document.hasFocus() })\n    }\n  ).stop\n}\n\nfunction initVisualViewportResizeObserver(cb) {\n  if (!window.visualViewport) {\n    return noop\n  }\n  var _updateDimension = throttle(\n    function () {\n      cb(getVisualViewport())\n    },\n    VISUAL_VIEWPORT_OBSERVER_THRESHOLD,\n    {\n      trailing: false\n    }\n  )\n  var removeListener = addEventListeners(\n    window.visualViewport,\n    [DOM_EVENT.RESIZE, DOM_EVENT.SCROLL],\n    _updateDimension.throttled,\n    {\n      capture: true,\n      passive: true\n    }\n  ).stop\n  var cancelThrottle = _updateDimension.cancel\n  return function stop() {\n    removeListener()\n    cancelThrottle()\n  }\n}\n\nexport function initFrustrationObserver(lifeCycle, frustrationCb) {\n  return lifeCycle.subscribe(\n    LifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n    function (data) {\n      if (\n        data.rawRumEvent.type === RumEventType.ACTION &&\n        data.rawRumEvent.action.type === ActionType.CLICK &&\n        data.rawRumEvent.action.frustration &&\n        data.rawRumEvent.action.frustration.type &&\n        data.rawRumEvent.action.frustration.type.length &&\n        'events' in data.domainContext &&\n        data.domainContext.events &&\n        data.domainContext.events.length\n      ) {\n        frustrationCb({\n          timestamp: data.rawRumEvent.date,\n          type: RecordType.FrustrationRecord,\n          data: {\n            frustrationTypes: data.rawRumEvent.action.frustration.type,\n            recordIds: data.domainContext.events.map(function (e) {\n              return getRecordIdForEvent(e)\n            })\n          }\n        })\n      }\n    }\n  ).unsubscribe\n}\n\nfunction getEventTarget(event) {\n  if (event.composed === true && isNodeShadowHost(event.target)) {\n    return event.composedPath()[0]\n  }\n  return event.target\n}\n"],"mappings":"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","ignoreList":[]}