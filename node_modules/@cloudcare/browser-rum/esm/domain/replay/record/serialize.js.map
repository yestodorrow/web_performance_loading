{"version":3,"file":"serialize.js","names":["assign","startsWith","isNodeShadowRoot","forEachChildNodes","hasChildNodes","STABLE_ATTRIBUTES","NodePrivacyLevel","PRIVACY_ATTR_NAME","PRIVACY_ATTR_VALUE_HIDDEN","CENSORED_STRING_MARK","CENSORED_IMG_MARK","NodeType","getTextContent","shouldMaskNode","reducePrivacyLevel","getNodeSelfPrivacyLevel","getSerializedNodeId","setSerializedNodeId","getElementInputValue","switchToAbsoluteUrl","serializeStyleSheets","absoluteToDoc","getAbsoluteSrcsetString","isSVGElement","getHref","getCssRulesString","isLongDataUrl","sanitizeDataUrl","SerializationContextStatus","INITIAL_FULL_SNAPSHOT","SUBSEQUENT_FULL_SNAPSHOT","MUTATION","serializeDocument","document","configuration","serializationContext","serializeNodeWithId","parentNodePrivacyLevel","defaultPrivacyLevel","node","options","serializedNode","serializeNode","id","generateNextId","serializedNodeWithId","serializedNodeIds","add","nodeType","DOCUMENT_NODE","serializeDocumentNode","DOCUMENT_FRAGMENT_NODE","serializeDocumentFragmentNode","DOCUMENT_TYPE_NODE","serializeDocumentTypeNode","ELEMENT_NODE","serializeElementNode","TEXT_NODE","serializeTextNode","CDATA_SECTION_NODE","serializeCDataNode","type","Document","childNodes","serializeChildNodes","adoptedStyleSheets","documentType","DocumentType","name","publicId","systemId","element","isShadowRoot","shadowRootsController","addShadowRoot","DocumentFragment","undefined","tagName","getValidTagName","isSVG","nodePrivacyLevel","HIDDEN","_boundingClientRect","getBoundingClientRect","width","height","Element","attributes","_defineProperty","rr_width","rr_height","IGNORE","getAttributesForPrivacyLevel","childNodesSerializationOptions","ignoreWhiteSpace","textNode","textContent","Text","CDATA","result","childNode","serializedChildNode","push","serializeAttribute","attributeName","attributeValue","getAttribute","MASK","includes","actionNameAttribute","_nextId","TAG_NAME_REGEX","processedTagName","toLowerCase","trim","test","transformAttribute","doc","value","safeAttrs","ownerDocument","i","length","attribute","item","formValue","ALLOW","optionElement","selected","stylesheet","Array","from","styleSheets","find","s","href","cssText","_cssText","sheet","inputElement","checked","mediaElement","rr_mediaState","paused","scrollTop","scrollLeft","status","Math","round","elementsScrollPositions","set","has","scroll","get","rr_scrollLeft","rr_scrollTop"],"sources":["../../../../src/domain/replay/record/serialize.js"],"sourcesContent":["import {\n  assign,\n  startsWith,\n  isNodeShadowRoot,\n  forEachChildNodes,\n  hasChildNodes\n} from '@cloudcare/browser-core'\nimport { STABLE_ATTRIBUTES } from '../../rumEventsCollection/actions/getSelectorsFromElement'\nimport {\n  NodePrivacyLevel,\n  PRIVACY_ATTR_NAME,\n  PRIVACY_ATTR_VALUE_HIDDEN,\n  CENSORED_STRING_MARK,\n  CENSORED_IMG_MARK\n} from '../../../constants'\n\nimport { NodeType } from '../../../types'\nimport {\n  getTextContent,\n  shouldMaskNode,\n  reducePrivacyLevel,\n  getNodeSelfPrivacyLevel\n} from './privacy'\nimport {\n  getSerializedNodeId,\n  setSerializedNodeId,\n  getElementInputValue,\n  switchToAbsoluteUrl,\n  serializeStyleSheets,\n  absoluteToDoc,\n  getAbsoluteSrcsetString,\n  isSVGElement,\n  getHref,\n  getCssRulesString\n} from './serializationUtils'\nimport {\n  isLongDataUrl,\n  sanitizeDataUrl\n} from '../../rumEventsCollection/resource/resourceUtils'\n// Those values are the only one that can be used when inheriting privacy levels from parent to\n// children during serialization, since HIDDEN and IGNORE shouldn't serialize their children. This\n// ensures that no children are serialized when they shouldn't.\n\nexport var SerializationContextStatus = {\n  INITIAL_FULL_SNAPSHOT: 0,\n  SUBSEQUENT_FULL_SNAPSHOT: 1,\n  MUTATION: 2\n}\n\nexport function serializeDocument(\n  document,\n  configuration,\n  serializationContext\n) {\n  // We are sure that Documents are never ignored, so this function never returns null\n  return serializeNodeWithId(document, {\n    serializationContext: serializationContext,\n    parentNodePrivacyLevel: configuration.defaultPrivacyLevel,\n    configuration: configuration\n  })\n}\n\nexport function serializeNodeWithId(node, options) {\n  var serializedNode = serializeNode(node, options)\n  if (!serializedNode) {\n    return null\n  }\n\n  // Try to reuse the previous id\n  var id = getSerializedNodeId(node) || generateNextId()\n  var serializedNodeWithId = serializedNode\n  serializedNodeWithId.id = id\n  setSerializedNodeId(node, id)\n  if (options.serializedNodeIds) {\n    options.serializedNodeIds.add(id)\n  }\n  return serializedNodeWithId\n}\n\nfunction serializeNode(node, options) {\n  switch (node.nodeType) {\n    case node.DOCUMENT_NODE:\n      return serializeDocumentNode(node, options)\n    case node.DOCUMENT_FRAGMENT_NODE:\n      return serializeDocumentFragmentNode(node, options)\n    case node.DOCUMENT_TYPE_NODE:\n      return serializeDocumentTypeNode(node)\n    case node.ELEMENT_NODE:\n      return serializeElementNode(node, options)\n    case node.TEXT_NODE:\n      return serializeTextNode(node, options)\n    case node.CDATA_SECTION_NODE:\n      return serializeCDataNode()\n  }\n}\n\nexport function serializeDocumentNode(document, options) {\n  return {\n    type: NodeType.Document,\n    childNodes: serializeChildNodes(document, options),\n    adoptedStyleSheets: serializeStyleSheets(document.adoptedStyleSheets)\n  }\n}\n\nfunction serializeDocumentTypeNode(documentType) {\n  return {\n    type: NodeType.DocumentType,\n    name: documentType.name,\n    publicId: documentType.publicId,\n    systemId: documentType.systemId\n  }\n}\n\nfunction serializeDocumentFragmentNode(element, options) {\n  var isShadowRoot = isNodeShadowRoot(element)\n  if (isShadowRoot) {\n    options.serializationContext.shadowRootsController.addShadowRoot(element)\n  }\n  return {\n    type: NodeType.DocumentFragment,\n    childNodes: serializeChildNodes(element, options),\n    isShadowRoot: isShadowRoot,\n    adoptedStyleSheets: isShadowRoot\n      ? serializeStyleSheets(element.adoptedStyleSheets)\n      : undefined\n  }\n}\n\n/**\n * Serializing Element nodes involves capturing:\n * 1. HTML ATTRIBUTES:\n * 2. JS STATE:\n * - scroll offsets\n * - Form fields (input value, checkbox checked, option selection, range)\n * - Canvas state,\n * - Media (video/audio) play mode + currentTime\n * - iframe contents\n * - webcomponents\n * 3. CUSTOM PROPERTIES:\n * - height+width for when `hidden` to cover the element\n * 4. EXCLUDED INTERACTION STATE:\n * - focus (possible, but not worth perf impact)\n * - hover (tracked only via mouse activity)\n * - fullscreen mode\n */\nexport function serializeElementNode(element, options) {\n  var tagName = getValidTagName(element.tagName)\n  var isSVG = isSVGElement(element) || undefined\n\n  // For performance reason, we don't use getNodePrivacyLevel directly: we leverage the\n  // parentNodePrivacyLevel option to avoid iterating over all parents\n  var nodePrivacyLevel = reducePrivacyLevel(\n    getNodeSelfPrivacyLevel(element),\n    options.parentNodePrivacyLevel\n  )\n\n  if (nodePrivacyLevel === NodePrivacyLevel.HIDDEN) {\n    var _boundingClientRect = element.getBoundingClientRect()\n    var width = _boundingClientRect.width\n    var height = _boundingClientRect.height\n    return {\n      type: NodeType.Element,\n      tagName: tagName,\n      attributes: {\n        rr_width: width + 'px',\n        rr_height: height + 'px',\n        [PRIVACY_ATTR_NAME]: PRIVACY_ATTR_VALUE_HIDDEN\n      },\n      childNodes: [],\n      isSVG: isSVG\n    }\n  }\n\n  // Ignore Elements like Script and some Link, Metas\n  if (nodePrivacyLevel === NodePrivacyLevel.IGNORE) {\n    return\n  }\n\n  var attributes = getAttributesForPrivacyLevel(\n    element,\n    nodePrivacyLevel,\n    options\n  )\n\n  var childNodes = []\n  if (hasChildNodes(element) && tagName !== 'style') {\n    // OBJECT POOLING OPTIMIZATION:\n    // We should not create a new object systematically as it could impact performances. Try to reuse\n    // the same object as much as possible, and clone it only if we need to.\n    var childNodesSerializationOptions\n    if (\n      options.parentNodePrivacyLevel === nodePrivacyLevel &&\n      options.ignoreWhiteSpace === (tagName === 'head')\n    ) {\n      childNodesSerializationOptions = options\n    } else {\n      childNodesSerializationOptions = assign({}, options, {\n        parentNodePrivacyLevel: nodePrivacyLevel,\n        ignoreWhiteSpace: tagName === 'head'\n      })\n    }\n    childNodes = serializeChildNodes(element, childNodesSerializationOptions)\n  }\n\n  //   if (isNodeShadowHost(element)) {\n  //     var shadowRoot = serializeNodeWithId(element.shadowRoot, options)\n  //     if (shadowRoot !== null) {\n  //       childNodes.push(shadowRoot)\n  //     }\n  //   }\n\n  return {\n    type: NodeType.Element,\n    tagName: tagName,\n    attributes: attributes,\n    childNodes: childNodes,\n    isSVG: isSVG\n  }\n}\n\n/**\n * Text Nodes are dependant on Element nodes\n * Privacy levels are set on elements so we check the parentElement of a text node\n * for privacy level.\n */\nfunction serializeTextNode(textNode, options) {\n  // The parent node may not be a html element which has a tagName attribute.\n  // So just let it be undefined which is ok in this use case.\n  //   var parentTagName = textNode.parentElement && textNode.parentElement.tagName\n  var textContent = getTextContent(\n    textNode,\n    options.ignoreWhiteSpace || false,\n    options.parentNodePrivacyLevel\n  )\n  if (textContent === undefined) {\n    return\n  }\n  return {\n    type: NodeType.Text,\n    textContent: textContent\n    // isStyle: parentTagName === 'STYLE' ? true : undefined\n  }\n}\n\nfunction serializeCDataNode() {\n  return {\n    type: NodeType.CDATA,\n    textContent: ''\n  }\n}\n\nexport function serializeChildNodes(node, options) {\n  var result = []\n  forEachChildNodes(node, function (childNode) {\n    var serializedChildNode = serializeNodeWithId(childNode, options)\n    if (serializedChildNode) {\n      result.push(serializedChildNode)\n    }\n  })\n  //   node.childNodes.forEach()\n  return result\n}\n\nexport function serializeAttribute(\n  element,\n  nodePrivacyLevel,\n  attributeName,\n  configuration\n) {\n  if (nodePrivacyLevel === NodePrivacyLevel.HIDDEN) {\n    // dup condition for direct access case\n    return null\n  }\n  var attributeValue = element.getAttribute(attributeName)\n  if (\n    nodePrivacyLevel === NodePrivacyLevel.MASK &&\n    attributeName !== PRIVACY_ATTR_NAME &&\n    !STABLE_ATTRIBUTES.includes(attributeName) &&\n    attributeName !== configuration.actionNameAttribute\n  ) {\n    var tagName = element.tagName\n\n    switch (attributeName) {\n      // Mask Attribute text content\n      case 'title':\n      case 'alt':\n      case 'placeholder':\n        return CENSORED_STRING_MARK\n    }\n    // mask image URLs\n    if (tagName === 'IMG' || tagName === 'SOURCE') {\n      if (attributeName === 'src' || attributeName === 'srcset') {\n        return CENSORED_IMG_MARK\n      } else if (attributeName === 'onerror') {\n        return null\n      }\n    }\n    // mask <a> URLs\n    if (tagName === 'A' && attributeName === 'href') {\n      return CENSORED_STRING_MARK\n    }\n\n    // mask data-* attributes\n    if (attributeValue && startsWith(attributeName, 'data-')) {\n      // Exception: it's safe to reveal the `${PRIVACY_ATTR_NAME}` attr\n      return CENSORED_STRING_MARK\n    }\n    // mask iframe srcdoc\n    if (tagName === 'IFRAME' && attributeName === 'srcdoc') {\n      return CENSORED_STRING_MARK\n    }\n  }\n\n  if (!attributeValue || typeof attributeValue !== 'string') {\n    return attributeValue\n  }\n\n  // Minimum Fix for customer.\n  //   if (\n  //     attributeValue.length > MAX_ATTRIBUTE_VALUE_CHAR_LENGTH &&\n  //     attributeValue.slice(0, 5) === 'data:'\n  //   ) {\n  //     return 'data:truncated'\n  //   }\n  if (isLongDataUrl(attributeValue)) {\n    return sanitizeDataUrl(attributeValue)\n  }\n  return attributeValue\n}\n\nvar _nextId = 1\nfunction generateNextId() {\n  return _nextId++\n}\n\nvar TAG_NAME_REGEX = /[^a-z1-6-_]/\nfunction getValidTagName(tagName) {\n  var processedTagName = (tagName + '').toLowerCase().trim()\n\n  if (TAG_NAME_REGEX.test(processedTagName)) {\n    // if the tag name is odd and we cannot extract\n    // anything from the string, then we return a\n    // generic div\n    return 'div'\n  }\n\n  return processedTagName\n}\n\nfunction transformAttribute(doc, tagName, name, value) {\n  if (!value) return value\n  if (\n    name === 'src' ||\n    (name === 'href' && !(tagName === 'use' && value[0] === '#'))\n  ) {\n    return absoluteToDoc(doc, value)\n  } else if (name === 'xlink:href' && value[0] !== '#') {\n    return absoluteToDoc(doc, value)\n  } else if (\n    name === 'background' &&\n    value &&\n    (tagName === 'table' || tagName === 'td' || tagName === 'th')\n  ) {\n    return absoluteToDoc(doc, value)\n  } else if (name === 'srcset') {\n    return getAbsoluteSrcsetString(doc, value)\n  } else if (name === 'style') {\n    return switchToAbsoluteUrl(value, getHref())\n  } else if (tagName === 'object' && name === 'data') {\n    return absoluteToDoc(doc, value)\n  } else {\n    return value\n  }\n}\n\nfunction getAttributesForPrivacyLevel(element, nodePrivacyLevel, options) {\n  if (nodePrivacyLevel === NodePrivacyLevel.HIDDEN) {\n    return {}\n  }\n  var safeAttrs = {}\n  var tagName = getValidTagName(element.tagName)\n  var doc = element.ownerDocument\n\n  for (var i = 0; i < element.attributes.length; i += 1) {\n    var attribute = element.attributes.item(i)\n    var attributeName = attribute.name\n    var attributeValue = serializeAttribute(\n      element,\n      nodePrivacyLevel,\n      attributeName,\n      options.configuration\n    )\n    if (attributeValue !== null) {\n      safeAttrs[attributeName] = transformAttribute(\n        doc,\n        tagName,\n        attributeName,\n        attributeValue\n      )\n    }\n  }\n\n  if (\n    element.value &&\n    (tagName === 'textarea' ||\n      tagName === 'select' ||\n      tagName === 'option' ||\n      tagName === 'input')\n  ) {\n    var formValue = getElementInputValue(element, nodePrivacyLevel)\n    if (formValue !== undefined) {\n      safeAttrs.value = formValue\n    }\n  }\n\n  /**\n   * <Option> can be selected, which occurs if its `value` matches ancestor `<Select>.value`\n   */\n  if (tagName === 'option' && nodePrivacyLevel === NodePrivacyLevel.ALLOW) {\n    // For privacy=`MASK`, all the values would be the same, so skip.\n    var optionElement = element\n    if (optionElement.selected) {\n      safeAttrs.selected = optionElement.selected\n    }\n  }\n\n  // remote css\n  if (tagName === 'link') {\n    var stylesheet = Array.from(doc.styleSheets).find(function (s) {\n      return s.href === element.href\n    })\n    var cssText = getCssRulesString(stylesheet)\n\n    if (cssText && stylesheet) {\n      safeAttrs._cssText = cssText\n    }\n  }\n\n  // dynamic stylesheet\n  if (tagName === 'style' && element.sheet) {\n    var cssText = getCssRulesString(element.sheet)\n    if (cssText) {\n      safeAttrs._cssText = cssText\n    }\n  }\n\n  /**\n   * Forms: input[type=checkbox,radio]\n   * The `checked` property for <input> is a little bit special:\n   * 1. el.checked is a setter that returns if truthy.\n   * 2. getAttribute returns the string value\n   * getAttribute('checked') does not sync with `Element.checked`, so use JS property\n   * NOTE: `checked` property exists on `HTMLInputElement`. For serializer assumptions, we check for type=radio|check.\n   */\n  var inputElement = element\n  if (\n    tagName === 'input' &&\n    (inputElement.type === 'radio' || inputElement.type === 'checkbox')\n  ) {\n    if (nodePrivacyLevel === NodePrivacyLevel.ALLOW) {\n      safeAttrs.checked = !!inputElement.checked\n    } else if (shouldMaskNode(inputElement, nodePrivacyLevel)) {\n      delete safeAttrs.checked\n    }\n  }\n\n  /**\n   * Serialize the media playback state\n   */\n  if (tagName === 'audio' || tagName === 'video') {\n    var mediaElement = element\n    safeAttrs.rr_mediaState = mediaElement.paused ? 'paused' : 'played'\n  }\n\n  /**\n   * Serialize the scroll state for each element only for full snapshot\n   */\n  var scrollTop\n  var scrollLeft\n  var serializationContext = options.serializationContext\n  switch (serializationContext.status) {\n    case SerializationContextStatus.INITIAL_FULL_SNAPSHOT:\n      scrollTop = Math.round(element.scrollTop)\n      scrollLeft = Math.round(element.scrollLeft)\n      if (scrollTop || scrollLeft) {\n        serializationContext.elementsScrollPositions.set(element, {\n          scrollTop: scrollTop,\n          scrollLeft: scrollLeft\n        })\n      }\n      break\n    case SerializationContextStatus.SUBSEQUENT_FULL_SNAPSHOT:\n      if (serializationContext.elementsScrollPositions.has(element)) {\n        const scroll = serializationContext.elementsScrollPositions.get(element)\n        scrollTop = scroll.scrollTop\n        scrollLeft = scroll.scrollLeft\n      }\n      break\n  }\n  if (scrollLeft) {\n    safeAttrs.rr_scrollLeft = scrollLeft\n  }\n  if (scrollTop) {\n    safeAttrs.rr_scrollTop = scrollTop\n  }\n\n  return safeAttrs\n}\n"],"mappings":"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","ignoreList":[]}