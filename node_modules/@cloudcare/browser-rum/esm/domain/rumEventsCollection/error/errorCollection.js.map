{"version":3,"file":"errorCollection.js","names":["assign","computeStackTrace","computeRawError","ErrorSource","UUID","ErrorHandling","Observable","trackRuntimeError","RumEventType","LifeCycleEventType","NonErrorPrefix","trackConsoleError","trackReportError","startErrorCollection","lifeCycle","configuration","pageStateHistory","errorObservable","subscribe","error","notify","RAW_ERROR_COLLECTED","doStartErrorCollection","RAW_RUM_EVENT_COLLECTED","customerContext","savedCommonContext","processError","addError","providedError","stackTrace","Error","undefined","rawError","originalError","handlingStack","startClocks","nonErrorPrefix","PROVIDED","source","CUSTOM","handling","HANDLED","context","rawRumEvent","date","timeStamp","id","message","stack","handling_stack","type","causes","source_type","ERROR","view","in_foreground","isInActivePageStateAt","relative","startTime","domainContext"],"sources":["../../../../src/domain/rumEventsCollection/error/errorCollection.js"],"sourcesContent":["import {\n  assign,\n  computeStackTrace,\n  computeRawError,\n  ErrorSource,\n  UUID,\n  ErrorHandling,\n  Observable,\n  trackRuntimeError,\n  RumEventType,\n  LifeCycleEventType,\n  NonErrorPrefix\n} from '@cloudcare/browser-core'\nimport { trackConsoleError } from './trackConsoleError'\nimport { trackReportError } from './trackReportError'\n\nexport function startErrorCollection(\n  lifeCycle,\n  configuration,\n  pageStateHistory\n) {\n  var errorObservable = new Observable()\n\n  trackConsoleError(errorObservable)\n  trackRuntimeError(errorObservable)\n  trackReportError(configuration, errorObservable)\n\n  errorObservable.subscribe(function (error) {\n    lifeCycle.notify(LifeCycleEventType.RAW_ERROR_COLLECTED, { error: error })\n  })\n\n  return doStartErrorCollection(lifeCycle, pageStateHistory)\n}\n\nexport function doStartErrorCollection(lifeCycle, pageStateHistory) {\n  lifeCycle.subscribe(LifeCycleEventType.RAW_ERROR_COLLECTED, function (error) {\n    lifeCycle.notify(\n      LifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n      assign(\n        {\n          customerContext: error.customerContext,\n          savedCommonContext: error.savedCommonContext\n        },\n        processError(error.error, pageStateHistory)\n      )\n    )\n  })\n\n  return {\n    addError: function (providedError, savedCommonContext) {\n      var error = providedError.error\n      var stackTrace =\n        error instanceof Error ? computeStackTrace(error) : undefined\n      var rawError = computeRawError({\n        stackTrace,\n        originalError: error,\n        handlingStack: providedError.handlingStack,\n        startClocks: providedError.startClocks,\n        nonErrorPrefix: NonErrorPrefix.PROVIDED,\n        source: ErrorSource.CUSTOM,\n        handling: ErrorHandling.HANDLED\n      })\n      lifeCycle.notify(LifeCycleEventType.RAW_ERROR_COLLECTED, {\n        customerContext: providedError.context,\n        savedCommonContext: savedCommonContext,\n        error: rawError\n      })\n    }\n  }\n}\n\nfunction processError(error, pageStateHistory) {\n  var rawRumEvent = {\n    date: error.startClocks.timeStamp,\n    error: {\n      id: UUID(),\n      message: error.message,\n      source: error.source,\n      stack: error.stack,\n      handling_stack: error.handlingStack,\n      type: error.type,\n      handling: error.handling,\n      causes: error.causes,\n      source_type: 'browser'\n    },\n    type: RumEventType.ERROR,\n    view: {\n      in_foreground: pageStateHistory.isInActivePageStateAt(\n        error.startClocks.relative\n      )\n    }\n  }\n\n  return {\n    rawRumEvent: rawRumEvent,\n    startTime: error.startClocks.relative,\n    domainContext: {\n      error: error.originalError\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}