{"version":3,"file":"resourceUtils.js","names":["includes","msToNs","each","toArray","extend","getPathName","isValidUrl","isIntakeRequest","ResourceType","preferredNow","FAKE_INITIAL_DOCUMENT","RESOURCE_TYPES","DOCUMENT","initiatorType","XHR","FETCH","BEACON","CSS","_","path","match","JS","IMAGE","FONT","MEDIA","computeResourceKind","timing","url","name","OTHER","type","res","_type","isType","areInOrder","numbers","arguments","i","length","isRequestKind","HAS_MULTI_BYTES_CHARACTERS","getStrSize","candidate","test","window","TextEncoder","undefined","encode","Blob","size","isResourceUrlLimit","limitSize","computePerformanceResourceDuration","entry","duration","startTime","responseEnd","is304","encodedBodySize","transferSize","isCacheHit","decodedBodySize","computePerformanceResourceDetails","validEntry","toValidEntry","fetchStart","redirectStart","redirectEnd","domainLookupStart","domainLookupEnd","connectStart","secureConnectionStart","connectEnd","requestStart","responseStart","details","firstbyte","trans","downloadTime","formatTiming","firstByteTime","ttfb","tcp","connectTime","ssl","sslTime","dns","dnsTime","hasRedirection","redirect","redirectTime","renderBlockingStatus","origin","start","end","computeSize","isAllowedRequestUrl","configuration","DATA_URL_REGEX","MAX_ATTRIBUTE_VALUE_CHAR_LENGTH","isLongDataUrl","substring","sanitizeDataUrl"],"sources":["../../../../src/domain/rumEventsCollection/resource/resourceUtils.js"],"sourcesContent":["import {\n  includes,\n  msToNs,\n  each,\n  toArray,\n  extend,\n  getPathName,\n  isValidUrl,\n  isIntakeRequest,\n  ResourceType,\n  preferredNow\n} from '@cloudcare/browser-core'\nexport var FAKE_INITIAL_DOCUMENT = 'initial_document'\n\nvar RESOURCE_TYPES = [\n  [\n    ResourceType.DOCUMENT,\n    function (initiatorType) {\n      return FAKE_INITIAL_DOCUMENT === initiatorType\n    }\n  ],\n  [\n    ResourceType.XHR,\n    function (initiatorType) {\n      return 'xmlhttprequest' === initiatorType\n    }\n  ],\n  [\n    ResourceType.FETCH,\n    function (initiatorType) {\n      return 'fetch' === initiatorType\n    }\n  ],\n  [\n    ResourceType.BEACON,\n    function (initiatorType) {\n      return 'beacon' === initiatorType\n    }\n  ],\n  [\n    ResourceType.CSS,\n    function (_, path) {\n      return path.match(/\\.css$/i) !== null\n    }\n  ],\n  [\n    ResourceType.JS,\n    function (_, path) {\n      return path.match(/\\.js$/i) !== null\n    }\n  ],\n  [\n    ResourceType.IMAGE,\n    function (initiatorType, path) {\n      return (\n        includes(['image', 'img', 'icon'], initiatorType) ||\n        path.match(/\\.(gif|jpg|jpeg|tiff|png|svg|ico)$/i) !== null\n      )\n    }\n  ],\n  [\n    ResourceType.FONT,\n    function (_, path) {\n      return path.match(/\\.(woff|eot|woff2|ttf)$/i) !== null\n    }\n  ],\n  [\n    ResourceType.MEDIA,\n    function (initiatorType, path) {\n      return (\n        includes(['audio', 'video'], initiatorType) ||\n        path.match(/\\.(mp3|mp4)$/i) !== null\n      )\n    }\n  ]\n]\n\nexport function computeResourceKind(timing) {\n  var url = timing.name\n  if (!isValidUrl(url)) {\n    return ResourceType.OTHER\n  }\n  var path = getPathName(url)\n  var type = ResourceType.OTHER\n  each(RESOURCE_TYPES, function (res) {\n    var _type = res[0],\n      isType = res[1]\n    if (isType(timing.initiatorType, path)) {\n      type = _type\n      return false\n    }\n  })\n  return type\n}\nfunction areInOrder() {\n  var numbers = toArray(arguments)\n  for (var i = 1; i < numbers.length; i += 1) {\n    if (numbers[i - 1] > numbers[i]) {\n      return false\n    }\n  }\n  return true\n}\n\nexport function isRequestKind(timing) {\n  return (\n    timing.initiatorType === 'xmlhttprequest' ||\n    timing.initiatorType === 'fetch'\n  )\n}\nvar HAS_MULTI_BYTES_CHARACTERS = /[^\\u0000-\\u007F]/\nexport function getStrSize(candidate) {\n  if (!HAS_MULTI_BYTES_CHARACTERS.test(candidate)) {\n    return candidate.length\n  }\n\n  if (window.TextEncoder !== undefined) {\n    return new TextEncoder().encode(candidate).length\n  }\n\n  return new Blob([candidate]).size\n}\nexport function isResourceUrlLimit(name, limitSize) {\n  return getStrSize(name) > limitSize\n}\nexport function computePerformanceResourceDuration(entry) {\n  // Safari duration is always 0 on timings blocked by cross origin policies.\n  if (entry.duration === 0 && entry.startTime < entry.responseEnd) {\n    return msToNs(entry.responseEnd - entry.startTime)\n  }\n\n  return msToNs(entry.duration)\n}\nexport function is304(entry) {\n  if (\n    entry.encodedBodySize > 0 &&\n    entry.transferSize > 0 &&\n    entry.transferSize < entry.encodedBodySize\n  ) {\n    return true\n  }\n\n  // unknown\n  return null\n}\nexport function isCacheHit(entry) {\n  // if we transferred bytes, it must not be a cache hit\n  // (will return false for 304 Not Modified)\n  if (entry.transferSize > 0) return false\n\n  // if the body size is non-zero, it must mean this is a\n  // ResourceTiming2 browser, this was same-origin or TAO,\n  // and transferSize was 0, so it was in the cache\n  if (entry.decodedBodySize > 0) return true\n\n  // fall back to duration checking (non-RT2 or cross-origin)\n  return entry.duration < 30\n}\n//  interface PerformanceResourceDetails {\n//   redirect?: PerformanceResourceDetailsElement\n//   dns?: PerformanceResourceDetailsElement\n//   connect?: PerformanceResourceDetailsElement\n//   ssl?: PerformanceResourceDetailsElement\n//   firstByte: PerformanceResourceDetailsElement\n//   download: PerformanceResourceDetailsElement\n//   fmp:\n// }\n// page_fmp\tfloat\t\t首屏时间(用于衡量用户什么时候看到页面的主要内容)，跟FCP的时长非常接近，这里我们就用FCP的时间作为首屏时间\tfirstPaintContentEnd - firstPaintContentStart\n// page_fpt\tfloat\t\t首次渲染时间，即白屏时间(从请求开始到浏览器开始解析第一批HTML文档字节的时间差。)\tresponseEnd - fetchStart\n// page_tti\tfloat\t\t首次可交互时间(浏览器完成所有HTML解析并且完成DOM构建，此时浏览器开始加载资源。)\tdomInteractive - fetchStart\n// page_firstbyte\tfloat\t\t首包时间\tresponseStart - domainLookupStart\n// page_dom_ready\tfloat\t\tDOM Ready时间(如果页面有同步执行的JS，则同步JS执行时间=ready-tti。)\tdomContentLoadEventEnd - fetchStart\n// page_load\tfloat\t\t页面完全加载时间(load=首次渲染时间+DOM解析耗时+同步JS执行+资源加载耗时。)\tloadEventStart - fetchStart\n// page_dns\tfloat\t\tdns解析时间\tdomainLookupEnd - domainLookupStart\n// page_tcp\tfloat\t\ttcp连接时间\tconnectEnd - connectStart\n// page_ssl\tfloat\t\tssl安全连接时间(仅适用于https)\tconnectEnd - secureConnectionStart\n// page_ttfb\tfloat\t\t请求响应耗时\tresponseStart - requestStart\n// page_trans\tfloat\t\t内容传输时间\tresponseEnd - responseStart\n// page_dom\tfloat\t\tDOM解析耗时\tdomInteractive - responseEnd\n// page_resource_load_time\tfloat\t\t资源加载时间\tloadEventStart - domContentLoadedEventEnd\n\n//  navigationStart：当前浏览器窗口的前一个网页关闭，发生unload事件时的Unix毫秒时间戳。如果没有前一个网页，则等于fetchStart属性。\n\n// ·   unloadEventStart：如果前一个网页与当前网页属于同一个域名，则返回前一个网页的unload事件发生时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。\n\n// ·   unloadEventEnd：如果前一个网页与当前网页属于同一个域名，则返回前一个网页unload事件的回调函数结束时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。\n\n// ·   redirectStart：返回第一个HTTP跳转开始时的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。\n\n// ·   redirectEnd：返回最后一个HTTP跳转结束时（即跳转回应的最后一个字节接受完成时）的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。\n\n// ·   fetchStart：返回浏览器准备使用HTTP请求读取文档时的Unix毫秒时间戳。该事件在网页查询本地缓存之前发生。\n\n// ·   domainLookupStart：返回域名查询开始时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。\n\n// ·   domainLookupEnd：返回域名查询结束时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。\n\n// ·   connectStart：返回HTTP请求开始向服务器发送时的Unix毫秒时间戳。如果使用持久连接（persistent connection），则返回值等同于fetchStart属性的值。\n\n// ·   connectEnd：返回浏览器与服务器之间的连接建立时的Unix毫秒时间戳。如果建立的是持久连接，则返回值等同于fetchStart属性的值。连接建立指的是所有握手和认证过程全部结束。\n\n// ·   secureConnectionStart：返回浏览器与服务器开始安全链接的握手时的Unix毫秒时间戳。如果当前网页不要求安全连接，则返回0。\n\n// ·   requestStart：返回浏览器向服务器发出HTTP请求时（或开始读取本地缓存时）的Unix毫秒时间戳。\n\n// ·   responseStart：返回浏览器从服务器收到（或从本地缓存读取）第一个字节时的Unix毫秒时间戳。\n\n// ·   responseEnd：返回浏览器从服务器收到（或从本地缓存读取）最后一个字节时（如果在此之前HTTP连接已经关闭，则返回关闭时）的Unix毫秒时间戳。\n\n// ·   domLoading：返回当前网页DOM结构开始解析时（即Document.readyState属性变为“loading”、相应的readystatechange事件触发时）的Unix毫秒时间戳。\n\n// ·   domInteractive：返回当前网页DOM结构结束解析、开始加载内嵌资源时（即Document.readyState属性变为“interactive”、相应的readystatechange事件触发时）的Unix毫秒时间戳。\n\n// ·   domContentLoadedEventStart：返回当前网页DOMContentLoaded事件发生时（即DOM结构解析完毕、所有脚本开始运行时）的Unix毫秒时间戳。\n\n// ·   domContentLoadedEventEnd：返回当前网页所有需要执行的脚本执行完成时的Unix毫秒时间戳。\n\n// ·   domComplete：返回当前网页DOM结构生成时（即Document.readyState属性变为“complete”，以及相应的readystatechange事件发生时）的Unix毫秒时间戳。\n\n// ·   loadEventStart：返回当前网页load事件的回调函数开始时的Unix毫秒时间戳。如果该事件还没有发生，返回0。\n\n// ·   loadEventEnd：返回当前网页load事件的回调函数运行结束时的Unix毫秒时间戳。如果该事件还没有发生，返回0\nexport function computePerformanceResourceDetails(entry) {\n  var validEntry = toValidEntry(entry)\n\n  if (!validEntry) {\n    return undefined\n  }\n\n  var startTime = validEntry.startTime,\n    fetchStart = validEntry.fetchStart,\n    redirectStart = validEntry.redirectStart,\n    redirectEnd = validEntry.redirectEnd,\n    domainLookupStart = validEntry.domainLookupStart,\n    domainLookupEnd = validEntry.domainLookupEnd,\n    connectStart = validEntry.connectStart,\n    secureConnectionStart = validEntry.secureConnectionStart,\n    connectEnd = validEntry.connectEnd,\n    requestStart = validEntry.requestStart,\n    responseStart = validEntry.responseStart,\n    responseEnd = validEntry.responseEnd\n  var details = {\n    firstbyte: msToNs(responseStart - domainLookupStart),\n    trans: msToNs(responseEnd - responseStart),\n    downloadTime: formatTiming(startTime, responseStart, responseEnd),\n    firstByteTime: formatTiming(startTime, requestStart, responseStart)\n  }\n  if (responseStart > 0 && responseStart <= preferredNow()) {\n    details.ttfb = msToNs(responseStart - requestStart)\n  }\n  // Make sure a connection occurred\n  if (connectEnd !== fetchStart) {\n    details.tcp = msToNs(connectEnd - connectStart)\n    details.connectTime = formatTiming(startTime, connectStart, connectEnd)\n    // Make sure a secure connection occurred\n    if (areInOrder(connectStart, secureConnectionStart, connectEnd)) {\n      details.ssl = msToNs(connectEnd - secureConnectionStart)\n      details.sslTime = formatTiming(\n        startTime,\n        secureConnectionStart,\n        connectEnd\n      )\n    }\n  }\n\n  // Make sure a domain lookup occurred\n  if (domainLookupEnd !== fetchStart) {\n    details.dns = msToNs(domainLookupEnd - domainLookupStart)\n    details.dnsTime = formatTiming(\n      startTime,\n      domainLookupStart,\n      domainLookupEnd\n    )\n  }\n\n  if (hasRedirection(entry)) {\n    details.redirect = msToNs(redirectEnd - redirectStart)\n    details.redirectTime = formatTiming(startTime, redirectStart, redirectEnd)\n  }\n  // renderBlockstatus\n  if (entry.renderBlockingStatus) {\n    details.renderBlockingStatus = entry.renderBlockingStatus\n  }\n  return details\n}\n\nexport function toValidEntry(entry) {\n  // Ensure timings are in the right order. On top of filtering out potential invalid\n  // RumPerformanceResourceTiming, it will ignore entries from requests where timings cannot be\n  // collected, for example cross origin requests without a \"Timing-Allow-Origin\" header allowing\n  // it.\n  // page_fmp\tfloat\t\t首屏时间(用于衡量用户什么时候看到页面的主要内容)，跟FCP的时长非常接近，这里我们就用FCP的时间作为首屏时间\tfirstPaintContentEnd - firstPaintContentStart\n  // page_fpt\tfloat\t\t首次渲染时间，即白屏时间(从请求开始到浏览器开始解析第一批HTML文档字节的时间差。)\tresponseEnd - fetchStart\n  // page_tti\tfloat\t\t首次可交互时间(浏览器完成所有HTML解析并且完成DOM构建，此时浏览器开始加载资源。)\tdomInteractive - fetchStart\n  // page_firstbyte\tfloat\t\t首包时间\tresponseStart - domainLookupStart\n  // page_dom_ready\tfloat\t\tDOM Ready时间(如果页面有同步执行的JS，则同步JS执行时间=ready-tti。)\tdomContentLoadEventEnd - fetchStart\n  // page_load\tfloat\t\t页面完全加载时间(load=首次渲染时间+DOM解析耗时+同步JS执行+资源加载耗时。)\tloadEventStart - fetchStart\n  // page_dns\tfloat\t\tdns解析时间\tdomainLookupEnd - domainLookupStart\n  // page_tcp\tfloat\t\ttcp连接时间\tconnectEnd - connectStart\n  // page_ssl\tfloat\t\tssl安全连接时间(仅适用于https)\tconnectEnd - secureConnectionStart\n  // page_ttfb\tfloat\t\t请求响应耗时\tresponseStart - requestStart\n  // page_trans\tfloat\t\t内容传输时间\tresponseEnd - responseStart\n  // page_dom\tfloat\t\tDOM解析耗时\tdomInteractive - responseEnd\n  // page_resource_load_time\tfloat\t\t资源加载时间\tloadEventStart - domContentLoadedEventEnd\n  if (\n    !areInOrder(\n      entry.startTime,\n      entry.fetchStart,\n      entry.domainLookupStart,\n      entry.domainLookupEnd,\n      entry.connectStart,\n      entry.connectEnd,\n      entry.requestStart,\n      entry.responseStart,\n      entry.responseEnd\n    )\n  ) {\n    return undefined\n  }\n\n  if (!hasRedirection(entry)) {\n    return entry\n  }\n\n  var redirectStart = entry.redirectStart\n  var redirectEnd = entry.redirectEnd\n  // Firefox doesn't provide redirect timings on cross origin requests.\n  // Provide a default for those.\n  if (redirectStart < entry.startTime) {\n    redirectStart = entry.startTime\n  }\n  if (redirectEnd < entry.startTime) {\n    redirectEnd = entry.fetchStart\n  }\n\n  // Make sure redirect timings are in order\n  if (\n    !areInOrder(entry.startTime, redirectStart, redirectEnd, entry.fetchStart)\n  ) {\n    return undefined\n  }\n  return extend({}, entry, {\n    redirectEnd: redirectEnd,\n    redirectStart: redirectStart\n  })\n  // return {\n  //   ...entry,\n  //   redirectEnd,\n  //   redirectStart\n  // }\n}\n\nfunction hasRedirection(entry) {\n  // The only time fetchStart is different than startTime is if a redirection occurred.\n  return entry.fetchStart !== entry.startTime\n}\n\nfunction formatTiming(origin, start, end) {\n  return {\n    duration: msToNs(end - start),\n    start: msToNs(start - origin)\n  }\n}\n\nexport function computeSize(entry) {\n  // Make sure a request actually occurred\n  if (entry.startTime < entry.responseStart) {\n    return {\n      size: entry.decodedBodySize,\n      encodedBodySize: entry.encodedBodySize,\n      decodedBodySize: entry.decodedBodySize,\n      transferSize: entry.transferSize\n    }\n    // return {\n    //   size: entry.decodedBodySize,\n    //   encodeSize:\n    //     Number.MAX_SAFE_INTEGER < entry.encodedBodySize\n    //       ? 0\n    //       : entry.encodedBodySize // max safe interger\n    // }\n  }\n  return {\n    size: undefined,\n    encodedBodySize: undefined,\n    decodedBodySize: undefined,\n    transferSize: undefined\n  }\n}\n\nexport function isAllowedRequestUrl(configuration, url) {\n  return url && !isIntakeRequest(url, configuration)\n}\n\nvar DATA_URL_REGEX = /data:(.+)?(;base64)?,/g\nexport var MAX_ATTRIBUTE_VALUE_CHAR_LENGTH = 24_000\nexport function isLongDataUrl(url) {\n  if (url.length <= MAX_ATTRIBUTE_VALUE_CHAR_LENGTH) {\n    return false\n  } else if (url.substring(0, 5) === 'data:') {\n    // Avoid String.match RangeError: Maximum call stack size exceeded\n    url = url.substring(0, MAX_ATTRIBUTE_VALUE_CHAR_LENGTH)\n    return true\n  }\n  return false\n}\n\nexport function sanitizeDataUrl(url) {\n  return url.match(DATA_URL_REGEX)[0] + '[...]'\n}\n"],"mappings":"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","ignoreList":[]}