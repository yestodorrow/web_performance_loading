{"version":3,"file":"trackViews.js","names":["shallowClone","elapsed","UUID","ONE_MINUTE","throttle","clocksNow","clocksOrigin","timeStampNow","looksLikeRelativeTime","ViewLoadingType","LifeCycleEventType","PageExitReason","isHashAnAnchor","getPathFromHash","noop","setInterval","Observable","clearInterval","setTimeout","isNullUndefinedDefaultValue","trackInitialViewMetrics","trackCommonViewMetrics","trackViewEventCounts","THROTTLE_VIEW_UPDATE_PERIOD","SESSION_KEEP_ALIVE_INTERVAL","KEEP_TRACKING_AFTER_VIEW_DELAY","trackViews","location","lifeCycle","domMutationObservable","configuration","locationChangeObservable","areViewsTrackedAutomatically","initialViewOptions","activeViews","Set","startNewView","loadingType","startClocks","viewOptions","newlyCreatedView","newView","add","stopObservable","subscribe","currentView","INITIAL_LOAD","startViewLifeCycle","locationChangeSubscription","renewViewOnLocationChange","SESSION_RENEWED","ROUTE_CHANGE","undefined","name","service","version","SESSION_EXPIRED","end","sessionIsActive","PAGE_EXITED","pageExitEvent","reason","UNLOADING","PAGEHIDE","params","oldLocation","newLocation","areDifferentLocation","addTiming","time","startView","options","endClocks","stop","unsubscribe","forEach","view","initialLocation","id","customTimings","documentVersion","viewCreatedEvent","notify","BEFORE_VIEW_CREATED","VIEW_CREATED","_scheduleViewUpdate","triggerViewUpdate","leading","scheduleViewUpdate","throttled","cancelScheduleViewUpdate","cancel","_trackCommonViewMetrics","setLoadEvent","stopCommonViewMetricsTracking","getCommonViewMetrics","stopINPTracking","setViewEnd","_trackInitialViewTimings","initialViewMetrics","stopInitialViewMetricsTracking","_trackViewEventCounts","stopEventCountsTracking","scheduleStop","eventCounts","keepAliveIntervalId","currentEnd","timeStamp","VIEW_UPDATED","commonViewMetrics","duration","isActive","result","VIEW_ENDED","AFTER_VIEW_ENDED","relative","relativeTime","sanitizeTiming","sanitized","replace","console","warn","currentLocation","otherLocation","pathname","hash"],"sources":["../../../../src/domain/rumEventsCollection/view/trackViews.js"],"sourcesContent":["import {\n  shallowClone,\n  elapsed,\n  UUID,\n  ONE_MINUTE,\n  throttle,\n  clocksNow,\n  clocksOrigin,\n  timeStampNow,\n  looksLikeRelativeTime,\n  ViewLoadingType,\n  LifeCycleEventType,\n  PageExitReason,\n  isHashAnAnchor,\n  getPathFromHash,\n  noop,\n  setInterval,\n  Observable,\n  clearInterval,\n  setTimeout,\n  isNullUndefinedDefaultValue\n} from '@cloudcare/browser-core'\n\nimport { trackInitialViewMetrics } from './trackInitialViewTimings'\nimport { trackCommonViewMetrics } from './trackCommonViewMetrics'\nimport { trackViewEventCounts } from './trackViewEventCounts'\nexport var THROTTLE_VIEW_UPDATE_PERIOD = 3000\nexport var SESSION_KEEP_ALIVE_INTERVAL = 5 * ONE_MINUTE\nexport var KEEP_TRACKING_AFTER_VIEW_DELAY = 5 * ONE_MINUTE\nexport function trackViews(\n  location,\n  lifeCycle,\n  domMutationObservable,\n  configuration,\n  locationChangeObservable,\n  areViewsTrackedAutomatically,\n  initialViewOptions\n) {\n  var activeViews = new Set()\n  function startNewView(loadingType, startClocks, viewOptions) {\n    var newlyCreatedView = newView(\n      lifeCycle,\n      domMutationObservable,\n      configuration,\n      location,\n      loadingType,\n      startClocks,\n      viewOptions\n    )\n    activeViews.add(newlyCreatedView)\n    newlyCreatedView.stopObservable.subscribe(function () {\n      activeViews.delete(newlyCreatedView)\n    })\n    return newlyCreatedView\n  }\n  var currentView = startNewView(\n    ViewLoadingType.INITIAL_LOAD,\n    clocksOrigin(),\n    initialViewOptions\n  )\n  startViewLifeCycle()\n  var locationChangeSubscription\n  if (areViewsTrackedAutomatically) {\n    locationChangeSubscription = renewViewOnLocationChange(\n      locationChangeObservable\n    )\n  }\n  function startViewLifeCycle() {\n    lifeCycle.subscribe(LifeCycleEventType.SESSION_RENEWED, function () {\n      currentView = startNewView(ViewLoadingType.ROUTE_CHANGE, undefined, {\n        name: currentView.name,\n        service: currentView.service,\n        version: currentView.version\n      })\n    })\n\n    lifeCycle.subscribe(LifeCycleEventType.SESSION_EXPIRED, function () {\n      currentView.end({ sessionIsActive: false })\n    })\n    // End the current view on page unload\n    lifeCycle.subscribe(\n      LifeCycleEventType.PAGE_EXITED,\n      function (pageExitEvent) {\n        if (\n          pageExitEvent.reason === PageExitReason.UNLOADING ||\n          pageExitEvent.reason === PageExitReason.PAGEHIDE\n        ) {\n          currentView.end()\n        }\n      }\n    )\n  }\n\n  function renewViewOnLocationChange(locationChangeObservable) {\n    return locationChangeObservable.subscribe(function (params) {\n      var oldLocation = params.oldLocation\n      var newLocation = params.newLocation\n      if (areDifferentLocation(oldLocation, newLocation)) {\n        currentView.end()\n        currentView = startNewView(ViewLoadingType.ROUTE_CHANGE)\n        return\n      }\n    })\n  }\n\n  return {\n    addTiming: function (name, time) {\n      if (typeof time === 'undefined') {\n        time = timeStampNow()\n      }\n      currentView.addTiming(name, time)\n    },\n    startView: function (options, startClocks) {\n      currentView.end({ endClocks: startClocks })\n      currentView = startNewView(\n        ViewLoadingType.ROUTE_CHANGE,\n        startClocks,\n        options\n      )\n    },\n    stop: function () {\n      if (locationChangeSubscription) {\n        locationChangeSubscription.unsubscribe()\n      }\n      currentView.end()\n      activeViews.forEach(function (view) {\n        view.stop()\n      })\n    }\n  }\n}\n\nfunction newView(\n  lifeCycle,\n  domMutationObservable,\n  configuration,\n  initialLocation,\n  loadingType,\n  startClocks,\n  viewOptions\n) {\n  // Setup initial values\n  if (typeof startClocks === 'undefined') {\n    startClocks = clocksNow()\n  }\n  var id = UUID()\n  var stopObservable = new Observable()\n  var customTimings = {}\n  var documentVersion = 0\n  var endClocks\n  var location = shallowClone(initialLocation)\n\n  var sessionIsActive = true\n  var name\n  var service\n  var version\n  if (viewOptions) {\n    name = viewOptions.name\n    service = viewOptions.service\n    version = viewOptions.version\n  }\n  var viewCreatedEvent = {\n    id: id,\n    name: name,\n    startClocks: startClocks,\n    service: service,\n    version: version\n  }\n  lifeCycle.notify(LifeCycleEventType.BEFORE_VIEW_CREATED, viewCreatedEvent)\n  lifeCycle.notify(LifeCycleEventType.VIEW_CREATED, viewCreatedEvent)\n\n  // Update the view every time the measures are changing\n  var _scheduleViewUpdate = throttle(\n    triggerViewUpdate,\n    THROTTLE_VIEW_UPDATE_PERIOD,\n    {\n      leading: false\n    }\n  )\n  var scheduleViewUpdate = _scheduleViewUpdate.throttled\n  var cancelScheduleViewUpdate = _scheduleViewUpdate.cancel\n\n  var _trackCommonViewMetrics = trackCommonViewMetrics(\n    lifeCycle,\n    domMutationObservable,\n    configuration,\n    scheduleViewUpdate,\n    loadingType,\n    startClocks\n  )\n  var setLoadEvent = _trackCommonViewMetrics.setLoadEvent\n  var stopCommonViewMetricsTracking = _trackCommonViewMetrics.stop\n  var getCommonViewMetrics = _trackCommonViewMetrics.getCommonViewMetrics\n  var stopINPTracking = _trackCommonViewMetrics.stopINPTracking\n  var setViewEnd = _trackCommonViewMetrics.setViewEnd\n  var _trackInitialViewTimings =\n    loadingType === ViewLoadingType.INITIAL_LOAD\n      ? trackInitialViewMetrics(\n          lifeCycle,\n          configuration,\n          setLoadEvent,\n          scheduleViewUpdate\n        )\n      : {\n          stop: noop,\n          initialViewMetrics: {}\n        }\n  var stopInitialViewMetricsTracking = _trackInitialViewTimings.stop\n  var initialViewMetrics = _trackInitialViewTimings.initialViewMetrics\n  var _trackViewEventCounts = trackViewEventCounts(\n    lifeCycle,\n    id,\n    scheduleViewUpdate\n  )\n  var stopEventCountsTracking = _trackViewEventCounts.scheduleStop\n  var eventCounts = _trackViewEventCounts.eventCounts\n\n  // Session keep alive\n  var keepAliveIntervalId = setInterval(\n    triggerViewUpdate,\n    SESSION_KEEP_ALIVE_INTERVAL\n  )\n  triggerViewUpdate()\n\n  function triggerViewUpdate() {\n    cancelScheduleViewUpdate()\n\n    documentVersion += 1\n    var currentEnd =\n      endClocks === undefined ? timeStampNow() : endClocks.timeStamp\n    lifeCycle.notify(LifeCycleEventType.VIEW_UPDATED, {\n      customTimings: customTimings,\n      documentVersion: documentVersion,\n      id: id,\n      name: name,\n      service: service,\n      version: version,\n      loadingType: loadingType,\n      location: location,\n      startClocks: startClocks,\n      commonViewMetrics: getCommonViewMetrics(),\n      initialViewMetrics: initialViewMetrics,\n      duration: elapsed(startClocks.timeStamp, currentEnd),\n      isActive: endClocks === undefined,\n      sessionIsActive: sessionIsActive,\n      eventCounts: eventCounts\n    })\n  }\n  var result = {\n    name: name,\n    service: service,\n    version: version,\n    stopObservable: stopObservable,\n    end: function (options) {\n      if (endClocks) {\n        // view already ended\n        return\n      }\n      endClocks = isNullUndefinedDefaultValue(\n        options && options.endClocks,\n        clocksNow()\n      )\n      sessionIsActive = isNullUndefinedDefaultValue(\n        options && options.sessionIsActive,\n        true\n      )\n      lifeCycle.notify(LifeCycleEventType.VIEW_ENDED, { endClocks: endClocks })\n      lifeCycle.notify(LifeCycleEventType.AFTER_VIEW_ENDED, {\n        endClocks: endClocks\n      })\n      clearInterval(keepAliveIntervalId)\n      setViewEnd(endClocks.relative)\n      stopCommonViewMetricsTracking()\n      triggerViewUpdate()\n      setTimeout(function () {\n        result.stop()\n      }, KEEP_TRACKING_AFTER_VIEW_DELAY)\n    },\n    stop: function () {\n      stopInitialViewMetricsTracking()\n      stopEventCountsTracking()\n      stopINPTracking()\n      stopObservable.notify()\n    },\n    addTiming: function (name, time) {\n      if (endClocks) {\n        return\n      }\n      var relativeTime = looksLikeRelativeTime(time)\n        ? time\n        : elapsed(startClocks.timeStamp, time)\n      customTimings[sanitizeTiming(name)] = relativeTime\n      scheduleViewUpdate()\n    }\n  }\n  return result\n}\n\n/**\n * Timing name is used as facet path that must contain only letters, digits, or the characters - _ . @ $\n */\nfunction sanitizeTiming(name) {\n  var sanitized = name.replace(/[^a-zA-Z0-9-_.@$]/g, '_')\n  if (sanitized !== name) {\n    console.warn(\n      'Invalid timing name: ' + name + ', sanitized to: ' + sanitized\n    )\n  }\n  return sanitized\n}\n\nfunction areDifferentLocation(currentLocation, otherLocation) {\n  return (\n    currentLocation.pathname !== otherLocation.pathname ||\n    (!isHashAnAnchor(otherLocation.hash) &&\n      getPathFromHash(otherLocation.hash) !==\n        getPathFromHash(currentLocation.hash))\n  )\n}\n"],"mappings":"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","ignoreList":[]}