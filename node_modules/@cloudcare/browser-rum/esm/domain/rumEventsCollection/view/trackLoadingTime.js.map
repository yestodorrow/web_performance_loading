{"version":3,"file":"trackLoadingTime.js","names":["elapsed","ViewLoadingType","waitPageActivityEnd","trackLoadingTime","lifeCycle","domMutationObservable","configuration","loadType","viewStart","callback","isWaitingForLoadEvent","INITIAL_LOAD","isWaitingForActivityLoadingTime","loadingTimeCandidates","invokeCallbackIfAllCandidatesAreReceived","length","Math","max","apply","stopEndCallback","_waitPageActivityEnd","event","hadActivity","push","timeStamp","end","stop","setLoadEvent","loadEvent"],"sources":["../../../../src/domain/rumEventsCollection/view/trackLoadingTime.js"],"sourcesContent":["import { elapsed, ViewLoadingType } from '@cloudcare/browser-core'\nimport { waitPageActivityEnd } from '../../waitPageActivityEnd'\nexport function trackLoadingTime(\n  lifeCycle,\n  domMutationObservable,\n  configuration,\n  loadType,\n  viewStart,\n  callback\n) {\n  var isWaitingForLoadEvent = loadType === ViewLoadingType.INITIAL_LOAD\n  var isWaitingForActivityLoadingTime = true\n  var loadingTimeCandidates = []\n\n  function invokeCallbackIfAllCandidatesAreReceived() {\n    if (\n      !isWaitingForActivityLoadingTime &&\n      !isWaitingForLoadEvent &&\n      loadingTimeCandidates.length > 0\n    ) {\n      callback(Math.max.apply(Math, loadingTimeCandidates))\n    }\n  }\n  function stopEndCallback() {\n    if (loadingTimeCandidates.length > 0) {\n      callback(Math.max.apply(Math, loadingTimeCandidates))\n    }\n  }\n  var _waitPageActivityEnd = waitPageActivityEnd(\n    lifeCycle,\n    domMutationObservable,\n    configuration,\n    function (event) {\n      if (isWaitingForActivityLoadingTime) {\n        isWaitingForActivityLoadingTime = false\n        if (event.hadActivity) {\n          loadingTimeCandidates.push(elapsed(viewStart.timeStamp, event.end))\n        }\n        invokeCallbackIfAllCandidatesAreReceived()\n      }\n    }\n  )\n\n  var stop = _waitPageActivityEnd.stop\n  return {\n    setLoadEvent: function (loadEvent) {\n      if (isWaitingForLoadEvent) {\n        isWaitingForLoadEvent = false\n        loadingTimeCandidates.push(loadEvent)\n        invokeCallbackIfAllCandidatesAreReceived()\n      }\n    },\n    stop: function () {\n      stop()\n      stopEndCallback()\n    }\n  }\n}\n"],"mappings":"AAAA,SAASA,OAAO,EAAEC,eAAe,QAAQ,yBAAyB;AAClE,SAASC,mBAAmB,QAAQ,2BAA2B;AAC/D,OAAO,SAASC,gBAAgBA,CAC9BC,SAAS,EACTC,qBAAqB,EACrBC,aAAa,EACbC,QAAQ,EACRC,SAAS,EACTC,QAAQ,EACR;EACA,IAAIC,qBAAqB,GAAGH,QAAQ,KAAKN,eAAe,CAACU,YAAY;EACrE,IAAIC,+BAA+B,GAAG,IAAI;EAC1C,IAAIC,qBAAqB,GAAG,EAAE;EAE9B,SAASC,wCAAwCA,CAAA,EAAG;IAClD,IACE,CAACF,+BAA+B,IAChC,CAACF,qBAAqB,IACtBG,qBAAqB,CAACE,MAAM,GAAG,CAAC,EAChC;MACAN,QAAQ,CAACO,IAAI,CAACC,GAAG,CAACC,KAAK,CAACF,IAAI,EAAEH,qBAAqB,CAAC,CAAC;IACvD;EACF;EACA,SAASM,eAAeA,CAAA,EAAG;IACzB,IAAIN,qBAAqB,CAACE,MAAM,GAAG,CAAC,EAAE;MACpCN,QAAQ,CAACO,IAAI,CAACC,GAAG,CAACC,KAAK,CAACF,IAAI,EAAEH,qBAAqB,CAAC,CAAC;IACvD;EACF;EACA,IAAIO,oBAAoB,GAAGlB,mBAAmB,CAC5CE,SAAS,EACTC,qBAAqB,EACrBC,aAAa,EACb,UAAUe,KAAK,EAAE;IACf,IAAIT,+BAA+B,EAAE;MACnCA,+BAA+B,GAAG,KAAK;MACvC,IAAIS,KAAK,CAACC,WAAW,EAAE;QACrBT,qBAAqB,CAACU,IAAI,CAACvB,OAAO,CAACQ,SAAS,CAACgB,SAAS,EAAEH,KAAK,CAACI,GAAG,CAAC,CAAC;MACrE;MACAX,wCAAwC,CAAC,CAAC;IAC5C;EACF,CACF,CAAC;EAED,IAAIY,KAAI,GAAGN,oBAAoB,CAACM,IAAI;EACpC,OAAO;IACLC,YAAY,EAAE,SAAAA,aAAUC,SAAS,EAAE;MACjC,IAAIlB,qBAAqB,EAAE;QACzBA,qBAAqB,GAAG,KAAK;QAC7BG,qBAAqB,CAACU,IAAI,CAACK,SAAS,CAAC;QACrCd,wCAAwC,CAAC,CAAC;MAC5C;IACF,CAAC;IACDY,IAAI,EAAE,SAAAA,KAAA,EAAY;MAChBA,KAAI,CAAC,CAAC;MACNP,eAAe,CAAC,CAAC;IACnB;EACF,CAAC;AACH","ignoreList":[]}