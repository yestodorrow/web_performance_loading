{"version":3,"file":"trackLargestContentfulPaint.js","names":["addEventListeners","DOM_EVENT","findLast","LifeCycleEventType","ONE_MINUTE","getSelectorFromElement","LCP_MAXIMUM_DELAY","trackLargestContentfulPaint","lifeCycle","configuration","firstHidden","eventTarget","callback","firstInteractionTimestamp","Infinity","_addEventListeners","POINTER_DOWN","KEY_DOWN","event","timeStamp","capture","once","stopEventListener","stop","biggestLcpSize","subscribe","PERFORMANCE_ENTRIES_COLLECTED","entries","lcpEntry","entry","entryType","startTime","geTimeStamp","size","lcpTargetSelector","element","actionNameAttribute","value","targetSelector","unsubscribeLifeCycle","unsubscribe"],"sources":["../../../../src/domain/rumEventsCollection/view/trackLargestContentfulPaint.js"],"sourcesContent":["import {\n  addEventListeners,\n  DOM_EVENT,\n  findLast,\n  LifeCycleEventType,\n  ONE_MINUTE\n} from '@cloudcare/browser-core'\nimport { getSelectorFromElement } from '../actions/getSelectorsFromElement'\n\n/**\n * Track the largest contentful paint (LCP) occurring during the initial View.  This can yield\n * multiple values, only the most recent one should be used.\n * Documentation: https://web.dev/lcp/\n * Reference implementation: https://github.com/GoogleChrome/web-vitals/blob/master/src/getLCP.ts\n */\n// It happens in some cases like sleep mode or some browser implementations\nexport var LCP_MAXIMUM_DELAY = 10 * ONE_MINUTE\nexport function trackLargestContentfulPaint(\n  lifeCycle,\n  configuration,\n  firstHidden,\n  eventTarget,\n  callback\n) {\n  // Ignore entries that come after the first user interaction.  According to the documentation, the\n  // browser should not send largest-contentful-paint entries after a user interact with the page,\n  // but the web-vitals reference implementation uses this as a safeguard.\n  var firstInteractionTimestamp = Infinity\n  var _addEventListeners = addEventListeners(\n    eventTarget,\n    [DOM_EVENT.POINTER_DOWN, DOM_EVENT.KEY_DOWN],\n    function (event) {\n      firstInteractionTimestamp = event.timeStamp\n    },\n    { capture: true, once: true }\n  )\n  var stopEventListener = _addEventListeners.stop\n  var biggestLcpSize = 0\n  var subscribe = lifeCycle.subscribe(\n    LifeCycleEventType.PERFORMANCE_ENTRIES_COLLECTED,\n    function (entries) {\n      var lcpEntry = findLast(entries, function (entry) {\n        return (\n          entry.entryType === 'largest-contentful-paint' &&\n          entry.startTime < firstInteractionTimestamp &&\n          entry.startTime < firstHidden.geTimeStamp() &&\n          entry.startTime < LCP_MAXIMUM_DELAY &&\n          // Ensure to get the LCP entry with the biggest size, see\n          // https://bugs.chromium.org/p/chromium/issues/detail?id=1516655\n          entry.size > biggestLcpSize\n        )\n      })\n      if (lcpEntry) {\n        var lcpTargetSelector\n        if (lcpEntry.element) {\n          lcpTargetSelector = getSelectorFromElement(\n            lcpEntry.element,\n            configuration.actionNameAttribute\n          )\n        }\n        callback({\n          value: lcpEntry.startTime,\n          targetSelector: lcpTargetSelector\n        })\n        biggestLcpSize = lcpEntry.size\n      }\n    }\n  )\n  var unsubscribeLifeCycle = subscribe.unsubscribe\n\n  return {\n    stop: function () {\n      stopEventListener()\n      unsubscribeLifeCycle()\n    }\n  }\n}\n"],"mappings":"AAAA,SACEA,iBAAiB,EACjBC,SAAS,EACTC,QAAQ,EACRC,kBAAkB,EAClBC,UAAU,QACL,yBAAyB;AAChC,SAASC,sBAAsB,QAAQ,oCAAoC;;AAE3E;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,IAAIC,iBAAiB,GAAG,EAAE,GAAGF,UAAU;AAC9C,OAAO,SAASG,2BAA2BA,CACzCC,SAAS,EACTC,aAAa,EACbC,WAAW,EACXC,WAAW,EACXC,QAAQ,EACR;EACA;EACA;EACA;EACA,IAAIC,yBAAyB,GAAGC,QAAQ;EACxC,IAAIC,kBAAkB,GAAGf,iBAAiB,CACxCW,WAAW,EACX,CAACV,SAAS,CAACe,YAAY,EAAEf,SAAS,CAACgB,QAAQ,CAAC,EAC5C,UAAUC,KAAK,EAAE;IACfL,yBAAyB,GAAGK,KAAK,CAACC,SAAS;EAC7C,CAAC,EACD;IAAEC,OAAO,EAAE,IAAI;IAAEC,IAAI,EAAE;EAAK,CAC9B,CAAC;EACD,IAAIC,iBAAiB,GAAGP,kBAAkB,CAACQ,IAAI;EAC/C,IAAIC,cAAc,GAAG,CAAC;EACtB,IAAIC,SAAS,GAAGjB,SAAS,CAACiB,SAAS,CACjCtB,kBAAkB,CAACuB,6BAA6B,EAChD,UAAUC,OAAO,EAAE;IACjB,IAAIC,QAAQ,GAAG1B,QAAQ,CAACyB,OAAO,EAAE,UAAUE,KAAK,EAAE;MAChD,OACEA,KAAK,CAACC,SAAS,KAAK,0BAA0B,IAC9CD,KAAK,CAACE,SAAS,GAAGlB,yBAAyB,IAC3CgB,KAAK,CAACE,SAAS,GAAGrB,WAAW,CAACsB,WAAW,CAAC,CAAC,IAC3CH,KAAK,CAACE,SAAS,GAAGzB,iBAAiB;MACnC;MACA;MACAuB,KAAK,CAACI,IAAI,GAAGT,cAAc;IAE/B,CAAC,CAAC;IACF,IAAII,QAAQ,EAAE;MACZ,IAAIM,iBAAiB;MACrB,IAAIN,QAAQ,CAACO,OAAO,EAAE;QACpBD,iBAAiB,GAAG7B,sBAAsB,CACxCuB,QAAQ,CAACO,OAAO,EAChB1B,aAAa,CAAC2B,mBAChB,CAAC;MACH;MACAxB,QAAQ,CAAC;QACPyB,KAAK,EAAET,QAAQ,CAACG,SAAS;QACzBO,cAAc,EAAEJ;MAClB,CAAC,CAAC;MACFV,cAAc,GAAGI,QAAQ,CAACK,IAAI;IAChC;EACF,CACF,CAAC;EACD,IAAIM,oBAAoB,GAAGd,SAAS,CAACe,WAAW;EAEhD,OAAO;IACLjB,IAAI,EAAE,SAAAA,KAAA,EAAY;MAChBD,iBAAiB,CAAC,CAAC;MACnBiB,oBAAoB,CAAC,CAAC;IACxB;EACF,CAAC;AACH","ignoreList":[]}