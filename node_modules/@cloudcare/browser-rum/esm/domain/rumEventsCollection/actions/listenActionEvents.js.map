{"version":3,"file":"listenActionEvents.js","names":["addEventListener","DOM_EVENT","each","listenActionEvents","events","selectionEmptyAtPointerDown","userActivity","selection","input","scroll","clickContext","listeners","window","POINTER_DOWN","event","isValidPointerEvent","isSelectionEmpty","onPointerDown","capture","SELECTION_CHANGE","POINTER_UP","localUserActivity","onPointerUp","undefined","SCROLL","passive","INPUT","stop","listener","getSelection","isCollapsed","target","Element","isPrimary"],"sources":["../../../../src/domain/rumEventsCollection/actions/listenActionEvents.js"],"sourcesContent":["import { addEventListener, DOM_EVENT, each } from '@cloudcare/browser-core'\n\nexport function listenActionEvents(events) {\n  var selectionEmptyAtPointerDown\n  var userActivity = {\n    selection: false,\n    input: false,\n    scroll: false\n  }\n  var clickContext\n  var listeners = [\n    addEventListener(\n      window,\n      DOM_EVENT.POINTER_DOWN,\n      function (event) {\n        if (isValidPointerEvent(event)) {\n          selectionEmptyAtPointerDown = isSelectionEmpty()\n          userActivity = {\n            selection: false,\n            input: false,\n            scroll: false\n          }\n          clickContext = events.onPointerDown(event)\n        }\n      },\n      { capture: true }\n    ),\n\n    addEventListener(\n      window,\n      DOM_EVENT.SELECTION_CHANGE,\n      function () {\n        if (!selectionEmptyAtPointerDown || !isSelectionEmpty()) {\n          userActivity.selection = true\n        }\n      },\n      { capture: true }\n    ),\n\n    addEventListener(\n      window,\n      DOM_EVENT.POINTER_UP,\n      function (event) {\n        if (isValidPointerEvent(event) && clickContext) {\n          // Use a scoped variable to make sure the value is not changed by other clicks\n          var localUserActivity = userActivity\n          events.onPointerUp(clickContext, event, function () {\n            return localUserActivity\n          })\n          clickContext = undefined\n        }\n      },\n      { capture: true }\n    ),\n    addEventListener(\n      window,\n      DOM_EVENT.SCROLL,\n      function () {\n        userActivity.scroll = true\n      },\n      { capture: true, passive: true }\n    ),\n    addEventListener(\n      window,\n      DOM_EVENT.INPUT,\n      function () {\n        userActivity.input = true\n      },\n      { capture: true }\n    )\n  ]\n\n  return {\n    stop: function () {\n      each(listeners, function (listener) {\n        return listener.stop()\n      })\n    }\n  }\n}\n\nfunction isSelectionEmpty() {\n  var selection = window.getSelection()\n  return !selection || selection.isCollapsed\n}\nfunction isValidPointerEvent(event) {\n  return (\n    event.target instanceof Element &&\n    // Only consider 'primary' pointer events for now. Multi-touch support could be implemented in\n    // the future.\n    event.isPrimary !== false\n  )\n}\n"],"mappings":"AAAA,SAASA,gBAAgB,EAAEC,SAAS,EAAEC,IAAI,QAAQ,yBAAyB;AAE3E,OAAO,SAASC,kBAAkBA,CAACC,MAAM,EAAE;EACzC,IAAIC,2BAA2B;EAC/B,IAAIC,YAAY,GAAG;IACjBC,SAAS,EAAE,KAAK;IAChBC,KAAK,EAAE,KAAK;IACZC,MAAM,EAAE;EACV,CAAC;EACD,IAAIC,YAAY;EAChB,IAAIC,SAAS,GAAG,CACdX,gBAAgB,CACdY,MAAM,EACNX,SAAS,CAACY,YAAY,EACtB,UAAUC,KAAK,EAAE;IACf,IAAIC,mBAAmB,CAACD,KAAK,CAAC,EAAE;MAC9BT,2BAA2B,GAAGW,gBAAgB,CAAC,CAAC;MAChDV,YAAY,GAAG;QACbC,SAAS,EAAE,KAAK;QAChBC,KAAK,EAAE,KAAK;QACZC,MAAM,EAAE;MACV,CAAC;MACDC,YAAY,GAAGN,MAAM,CAACa,aAAa,CAACH,KAAK,CAAC;IAC5C;EACF,CAAC,EACD;IAAEI,OAAO,EAAE;EAAK,CAClB,CAAC,EAEDlB,gBAAgB,CACdY,MAAM,EACNX,SAAS,CAACkB,gBAAgB,EAC1B,YAAY;IACV,IAAI,CAACd,2BAA2B,IAAI,CAACW,gBAAgB,CAAC,CAAC,EAAE;MACvDV,YAAY,CAACC,SAAS,GAAG,IAAI;IAC/B;EACF,CAAC,EACD;IAAEW,OAAO,EAAE;EAAK,CAClB,CAAC,EAEDlB,gBAAgB,CACdY,MAAM,EACNX,SAAS,CAACmB,UAAU,EACpB,UAAUN,KAAK,EAAE;IACf,IAAIC,mBAAmB,CAACD,KAAK,CAAC,IAAIJ,YAAY,EAAE;MAC9C;MACA,IAAIW,iBAAiB,GAAGf,YAAY;MACpCF,MAAM,CAACkB,WAAW,CAACZ,YAAY,EAAEI,KAAK,EAAE,YAAY;QAClD,OAAOO,iBAAiB;MAC1B,CAAC,CAAC;MACFX,YAAY,GAAGa,SAAS;IAC1B;EACF,CAAC,EACD;IAAEL,OAAO,EAAE;EAAK,CAClB,CAAC,EACDlB,gBAAgB,CACdY,MAAM,EACNX,SAAS,CAACuB,MAAM,EAChB,YAAY;IACVlB,YAAY,CAACG,MAAM,GAAG,IAAI;EAC5B,CAAC,EACD;IAAES,OAAO,EAAE,IAAI;IAAEO,OAAO,EAAE;EAAK,CACjC,CAAC,EACDzB,gBAAgB,CACdY,MAAM,EACNX,SAAS,CAACyB,KAAK,EACf,YAAY;IACVpB,YAAY,CAACE,KAAK,GAAG,IAAI;EAC3B,CAAC,EACD;IAAEU,OAAO,EAAE;EAAK,CAClB,CAAC,CACF;EAED,OAAO;IACLS,IAAI,EAAE,SAAAA,KAAA,EAAY;MAChBzB,IAAI,CAACS,SAAS,EAAE,UAAUiB,QAAQ,EAAE;QAClC,OAAOA,QAAQ,CAACD,IAAI,CAAC,CAAC;MACxB,CAAC,CAAC;IACJ;EACF,CAAC;AACH;AAEA,SAASX,gBAAgBA,CAAA,EAAG;EAC1B,IAAIT,SAAS,GAAGK,MAAM,CAACiB,YAAY,CAAC,CAAC;EACrC,OAAO,CAACtB,SAAS,IAAIA,SAAS,CAACuB,WAAW;AAC5C;AACA,SAASf,mBAAmBA,CAACD,KAAK,EAAE;EAClC,OACEA,KAAK,CAACiB,MAAM,YAAYC,OAAO;EAC/B;EACA;EACAlB,KAAK,CAACmB,SAAS,KAAK,KAAK;AAE7B","ignoreList":[]}