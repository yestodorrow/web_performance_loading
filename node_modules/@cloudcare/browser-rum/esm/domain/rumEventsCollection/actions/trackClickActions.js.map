{"version":3,"file":"trackClickActions.js","names":["timeStampNow","Observable","assign","getRelativeTime","ONE_MINUTE","ContextHistory","UUID","clocksNow","ONE_SECOND","elapsed","each","map","LifeCycleEventType","ActionType","isNullUndefinedDefaultValue","isArray","includes","trackEventCounts","waitPageActivityEnd","PAGE_ACTIVITY_VALIDATION_DELAY","createClickChain","getActionNameFromElement","getSelectorFromElement","listenActionEvents","computeFrustration","CLICK_ACTION_MAX_DURATION","ACTION_CONTEXT_TIME_OUT_DELAY","trackClickActions","lifeCycle","domMutationObservable","configuration","history","stopObservable","currentClickChain","subscribe","SESSION_RENEWED","reset","VIEW_ENDED","stopClickChain","_listenActionEvents","onPointerDown","pointerDownEvent","processPointerDown","onPointerUp","data","startEvent","getUserActivity","startClickAction","appendClickToClickChain","clickActionBase","hadActivityOnPointerDown","stopActionEventsListener","stop","actionContexts","findActionId","startTime","allIds","findAll","length","undefined","findAllActionId","notify","click","tryAppend","rageClick","clone","clicks","finalizeClicks","computeClickActionBase","actionNameAttribute","pageActivityEndEvent","hadActivity","newClick","_waitPageActivityEnd","end","startClocks","timeStamp","discard","stopWaitPageActivityEnd","viewEndedSubscription","endClocks","stopSubscription","unsubscribe","event","rect","target","getBoundingClientRect","type","CLICK","width","Math","round","height","selector","position","x","clientX","left","y","clientY","top","name","ClickStatus","ONGOING","STOPPED","FINALIZED","id","historyEntry","add","relative","eventCountsSubscription","isChildEvent","action","ids","status","activityEndTime","frustrationTypes","newActivityEndTime","close","remove","hasError","eventCounts","errorCount","hasPageActivity","addFrustration","frustrationType","push","isStopped","validate","domEvents","_eventCountsSubscription","resourceCount","longTaskCount","clickAction","duration","counts","events","AUTO_ACTION_COMPLETED","_computeFrustration","isRage"],"sources":["../../../../src/domain/rumEventsCollection/actions/trackClickActions.js"],"sourcesContent":["import {\n  timeStampNow,\n  Observable,\n  assign,\n  getRelativeTime,\n  ONE_MINUTE,\n  ContextHistory,\n  UUID,\n  clocksNow,\n  ONE_SECOND,\n  elapsed,\n  each,\n  map,\n  LifeCycleEventType,\n  ActionType,\n  isNullUndefinedDefaultValue,\n  isArray,\n  includes\n} from '@cloudcare/browser-core'\nimport { trackEventCounts } from '../../trackEventCounts'\nimport {\n  waitPageActivityEnd,\n  PAGE_ACTIVITY_VALIDATION_DELAY\n} from '../../waitPageActivityEnd'\nimport { createClickChain } from './clickChain'\nimport { getActionNameFromElement } from './getActionNameFromElement'\nimport { getSelectorFromElement } from './getSelectorsFromElement'\n// import { getSelectorsFromElement } from './getSelectorsFromElement'\nimport { listenActionEvents } from './listenActionEvents'\nimport { computeFrustration } from './computeFrustration'\n\n// Maximum duration for click actions\nexport var CLICK_ACTION_MAX_DURATION = 10 * ONE_SECOND\nexport var ACTION_CONTEXT_TIME_OUT_DELAY = 5 * ONE_MINUTE // arbitrary\n\nexport function trackClickActions(\n  lifeCycle,\n  domMutationObservable,\n  configuration\n) {\n  var history = new ContextHistory(ACTION_CONTEXT_TIME_OUT_DELAY)\n  var stopObservable = new Observable()\n  var currentClickChain\n\n  lifeCycle.subscribe(LifeCycleEventType.SESSION_RENEWED, function () {\n    history.reset()\n  })\n  lifeCycle.subscribe(LifeCycleEventType.VIEW_ENDED, stopClickChain)\n  var _listenActionEvents = listenActionEvents({\n    onPointerDown: function (pointerDownEvent) {\n      return processPointerDown(\n        configuration,\n        lifeCycle,\n        domMutationObservable,\n        pointerDownEvent\n      )\n    },\n    onPointerUp: function (data, startEvent, getUserActivity) {\n      startClickAction(\n        configuration,\n        lifeCycle,\n        domMutationObservable,\n        history,\n        stopObservable,\n        appendClickToClickChain,\n        data.clickActionBase,\n        startEvent,\n        getUserActivity,\n        data.hadActivityOnPointerDown\n      )\n    }\n  })\n  var stopActionEventsListener = _listenActionEvents.stop\n  var actionContexts = {\n    findActionId: function (startTime) {\n      const allIds = history.findAll(startTime)\n      if (allIds && allIds.length) {\n        return allIds[allIds.length - 1]\n      }\n      return undefined\n    },\n    findAllActionId: function (startTime) {\n      return history.findAll(startTime)\n    }\n  }\n\n  return {\n    stop: function () {\n      stopClickChain()\n      stopObservable.notify()\n      stopActionEventsListener()\n    },\n    actionContexts: actionContexts\n  }\n\n  function stopClickChain() {\n    if (currentClickChain) {\n      currentClickChain.stop()\n    }\n  }\n  function appendClickToClickChain(click) {\n    if (!currentClickChain || !currentClickChain.tryAppend(click)) {\n      var rageClick = click.clone()\n      currentClickChain = createClickChain(click, function (clicks) {\n        finalizeClicks(clicks, rageClick)\n      })\n    }\n  }\n}\nfunction processPointerDown(\n  configuration,\n  lifeCycle,\n  domMutationObservable,\n  pointerDownEvent\n) {\n  var clickActionBase = computeClickActionBase(\n    pointerDownEvent,\n    configuration.actionNameAttribute\n  )\n\n  var hadActivityOnPointerDown = false\n\n  waitPageActivityEnd(\n    lifeCycle,\n    domMutationObservable,\n    configuration,\n    function (pageActivityEndEvent) {\n      hadActivityOnPointerDown = pageActivityEndEvent.hadActivity\n    },\n    PAGE_ACTIVITY_VALIDATION_DELAY\n  )\n\n  return {\n    clickActionBase: clickActionBase,\n    hadActivityOnPointerDown: function () {\n      return hadActivityOnPointerDown\n    }\n  }\n}\nfunction startClickAction(\n  configuration,\n  lifeCycle,\n  domMutationObservable,\n  history,\n  stopObservable,\n  appendClickToClickChain,\n  clickActionBase,\n  startEvent,\n  getUserActivity,\n  hadActivityOnPointerDown\n) {\n  var click = newClick(\n    lifeCycle,\n    history,\n    getUserActivity,\n    clickActionBase,\n    startEvent\n  )\n  appendClickToClickChain(click)\n  var _waitPageActivityEnd = waitPageActivityEnd(\n    lifeCycle,\n    domMutationObservable,\n    configuration,\n    function (pageActivityEndEvent) {\n      if (\n        pageActivityEndEvent.hadActivity &&\n        pageActivityEndEvent.end < click.startClocks.timeStamp\n      ) {\n        // If the clock is looking weird, just discard the click\n        click.discard()\n      } else {\n        if (pageActivityEndEvent.hadActivity) {\n          click.stop(pageActivityEndEvent.end)\n        } else if (hadActivityOnPointerDown()) {\n          click.stop(\n            // using the click start as activity end, so the click will have some activity but its\n            // duration will be 0 (as the activity started before the click start)\n            click.startClocks.timeStamp\n          )\n        } else {\n          click.stop()\n        }\n      }\n    },\n    CLICK_ACTION_MAX_DURATION\n  )\n  var stopWaitPageActivityEnd = _waitPageActivityEnd.stop\n  var viewEndedSubscription = lifeCycle.subscribe(\n    LifeCycleEventType.VIEW_ENDED,\n    function (data) {\n      click.stop(data.endClocks.timeStamp)\n    }\n  )\n\n  var stopSubscription = stopObservable.subscribe(function () {\n    click.stop()\n  })\n\n  click.stopObservable.subscribe(function () {\n    viewEndedSubscription.unsubscribe()\n    stopWaitPageActivityEnd()\n    stopSubscription.unsubscribe()\n  })\n}\n\nfunction computeClickActionBase(event, actionNameAttribute) {\n  var rect = event.target.getBoundingClientRect()\n  return {\n    type: ActionType.CLICK,\n    target: {\n      width: Math.round(rect.width),\n      height: Math.round(rect.height),\n      selector: getSelectorFromElement(event.target, actionNameAttribute)\n    },\n    position: {\n      x: Math.round(event.clientX - rect.left),\n      y: Math.round(event.clientY - rect.top)\n    },\n    name: getActionNameFromElement(event.target, actionNameAttribute)\n  }\n}\n\nvar ClickStatus = {\n  // Initial state, the click is still ongoing.\n  ONGOING: 0,\n  // The click is no more ongoing but still needs to be validated or discarded.\n  STOPPED: 1,\n  // Final state, the click has been stopped and validated or discarded.\n  FINALIZED: 2\n}\n\nfunction newClick(\n  lifeCycle,\n  history,\n  getUserActivity,\n  clickActionBase,\n  startEvent\n) {\n  var id = UUID()\n  var startClocks = clocksNow()\n  var historyEntry = history.add(id, startClocks.relative)\n  var eventCountsSubscription = trackEventCounts({\n    lifeCycle: lifeCycle,\n    isChildEvent: function (event) {\n      return (\n        event.action !== undefined &&\n        (isArray(event.action.ids)\n          ? includes(event.action.ids, id)\n          : event.action.ids === id)\n      )\n    }\n  })\n  var status = ClickStatus.ONGOING\n  var activityEndTime\n  var frustrationTypes = []\n  var stopObservable = new Observable()\n\n  function stop(newActivityEndTime) {\n    if (status !== ClickStatus.ONGOING) {\n      return\n    }\n    activityEndTime = newActivityEndTime\n    status = ClickStatus.STOPPED\n    if (activityEndTime) {\n      historyEntry.close(getRelativeTime(activityEndTime))\n    } else {\n      historyEntry.remove()\n    }\n    eventCountsSubscription.stop()\n    stopObservable.notify()\n  }\n\n  return {\n    event: startEvent,\n    stop: stop,\n    stopObservable: stopObservable,\n    hasError: function () {\n      return eventCountsSubscription.eventCounts.errorCount > 0\n    },\n    hasPageActivity: function () {\n      return activityEndTime !== undefined\n    },\n    getUserActivity: getUserActivity,\n    addFrustration: function (frustrationType) {\n      frustrationTypes.push(frustrationType)\n    },\n    startClocks: startClocks,\n    isStopped: function () {\n      return status === ClickStatus.STOPPED || status === ClickStatus.FINALIZED\n    },\n\n    clone: function () {\n      return newClick(\n        lifeCycle,\n        history,\n        getUserActivity,\n        clickActionBase,\n        startEvent\n      )\n    },\n\n    validate: function (domEvents) {\n      stop()\n      if (status !== ClickStatus.STOPPED) {\n        return\n      }\n      var _eventCountsSubscription = eventCountsSubscription.eventCounts\n      var resourceCount = _eventCountsSubscription.resourceCount\n      var errorCount = _eventCountsSubscription.errorCount\n      var longTaskCount = _eventCountsSubscription.longTaskCount\n      var clickAction = assign(\n        {\n          type: ActionType.CLICK,\n          duration:\n            activityEndTime && elapsed(startClocks.timeStamp, activityEndTime),\n          startClocks: startClocks,\n          id: id,\n          frustrationTypes: frustrationTypes,\n          counts: {\n            resourceCount: resourceCount,\n            errorCount: errorCount,\n            longTaskCount: longTaskCount\n          },\n          events: isNullUndefinedDefaultValue(domEvents, [startEvent]),\n          event: startEvent\n        },\n        clickActionBase\n      )\n      lifeCycle.notify(LifeCycleEventType.AUTO_ACTION_COMPLETED, clickAction)\n      status = ClickStatus.FINALIZED\n    },\n\n    discard: function () {\n      stop()\n      status = ClickStatus.FINALIZED\n    }\n  }\n}\n\nexport function finalizeClicks(clicks, rageClick) {\n  var _computeFrustration = computeFrustration(clicks, rageClick)\n  var isRage = _computeFrustration.isRage\n  if (isRage) {\n    each(clicks, function (click) {\n      click.discard()\n    })\n    rageClick.stop(timeStampNow())\n    rageClick.validate(\n      map(clicks, function (click) {\n        return click.event\n      })\n    )\n  } else {\n    rageClick.discard()\n    each(clicks, function (click) {\n      click.validate()\n    })\n  }\n}\n"],"mappings":"AAAA,SACEA,YAAY,EACZC,UAAU,EACVC,MAAM,EACNC,eAAe,EACfC,UAAU,EACVC,cAAc,EACdC,IAAI,EACJC,SAAS,EACTC,UAAU,EACVC,OAAO,EACPC,IAAI,EACJC,GAAG,EACHC,kBAAkB,EAClBC,UAAU,EACVC,2BAA2B,EAC3BC,OAAO,EACPC,QAAQ,QACH,yBAAyB;AAChC,SAASC,gBAAgB,QAAQ,wBAAwB;AACzD,SACEC,mBAAmB,EACnBC,8BAA8B,QACzB,2BAA2B;AAClC,SAASC,gBAAgB,QAAQ,cAAc;AAC/C,SAASC,wBAAwB,QAAQ,4BAA4B;AACrE,SAASC,sBAAsB,QAAQ,2BAA2B;AAClE;AACA,SAASC,kBAAkB,QAAQ,sBAAsB;AACzD,SAASC,kBAAkB,QAAQ,sBAAsB;;AAEzD;AACA,OAAO,IAAIC,yBAAyB,GAAG,EAAE,GAAGjB,UAAU;AACtD,OAAO,IAAIkB,6BAA6B,GAAG,CAAC,GAAGtB,UAAU,EAAC;;AAE1D,OAAO,SAASuB,iBAAiBA,CAC/BC,SAAS,EACTC,qBAAqB,EACrBC,aAAa,EACb;EACA,IAAIC,OAAO,GAAG,IAAI1B,cAAc,CAACqB,6BAA6B,CAAC;EAC/D,IAAIM,cAAc,GAAG,IAAI/B,UAAU,CAAC,CAAC;EACrC,IAAIgC,iBAAiB;EAErBL,SAAS,CAACM,SAAS,CAACtB,kBAAkB,CAACuB,eAAe,EAAE,YAAY;IAClEJ,OAAO,CAACK,KAAK,CAAC,CAAC;EACjB,CAAC,CAAC;EACFR,SAAS,CAACM,SAAS,CAACtB,kBAAkB,CAACyB,UAAU,EAAEC,cAAc,CAAC;EAClE,IAAIC,mBAAmB,GAAGhB,kBAAkB,CAAC;IAC3CiB,aAAa,EAAE,SAAAA,cAAUC,gBAAgB,EAAE;MACzC,OAAOC,kBAAkB,CACvBZ,aAAa,EACbF,SAAS,EACTC,qBAAqB,EACrBY,gBACF,CAAC;IACH,CAAC;IACDE,WAAW,EAAE,SAAAA,YAAUC,IAAI,EAAEC,UAAU,EAAEC,eAAe,EAAE;MACxDC,gBAAgB,CACdjB,aAAa,EACbF,SAAS,EACTC,qBAAqB,EACrBE,OAAO,EACPC,cAAc,EACdgB,uBAAuB,EACvBJ,IAAI,CAACK,eAAe,EACpBJ,UAAU,EACVC,eAAe,EACfF,IAAI,CAACM,wBACP,CAAC;IACH;EACF,CAAC,CAAC;EACF,IAAIC,wBAAwB,GAAGZ,mBAAmB,CAACa,IAAI;EACvD,IAAIC,cAAc,GAAG;IACnBC,YAAY,EAAE,SAAAA,aAAUC,SAAS,EAAE;MACjC,IAAMC,MAAM,GAAGzB,OAAO,CAAC0B,OAAO,CAACF,SAAS,CAAC;MACzC,IAAIC,MAAM,IAAIA,MAAM,CAACE,MAAM,EAAE;QAC3B,OAAOF,MAAM,CAACA,MAAM,CAACE,MAAM,GAAG,CAAC,CAAC;MAClC;MACA,OAAOC,SAAS;IAClB,CAAC;IACDC,eAAe,EAAE,SAAAA,gBAAUL,SAAS,EAAE;MACpC,OAAOxB,OAAO,CAAC0B,OAAO,CAACF,SAAS,CAAC;IACnC;EACF,CAAC;EAED,OAAO;IACLH,IAAI,EAAE,SAAAA,KAAA,EAAY;MAChBd,cAAc,CAAC,CAAC;MAChBN,cAAc,CAAC6B,MAAM,CAAC,CAAC;MACvBV,wBAAwB,CAAC,CAAC;IAC5B,CAAC;IACDE,cAAc,EAAEA;EAClB,CAAC;EAED,SAASf,cAAcA,CAAA,EAAG;IACxB,IAAIL,iBAAiB,EAAE;MACrBA,iBAAiB,CAACmB,IAAI,CAAC,CAAC;IAC1B;EACF;EACA,SAASJ,uBAAuBA,CAACc,KAAK,EAAE;IACtC,IAAI,CAAC7B,iBAAiB,IAAI,CAACA,iBAAiB,CAAC8B,SAAS,CAACD,KAAK,CAAC,EAAE;MAC7D,IAAIE,SAAS,GAAGF,KAAK,CAACG,KAAK,CAAC,CAAC;MAC7BhC,iBAAiB,GAAGb,gBAAgB,CAAC0C,KAAK,EAAE,UAAUI,MAAM,EAAE;QAC5DC,cAAc,CAACD,MAAM,EAAEF,SAAS,CAAC;MACnC,CAAC,CAAC;IACJ;EACF;AACF;AACA,SAAStB,kBAAkBA,CACzBZ,aAAa,EACbF,SAAS,EACTC,qBAAqB,EACrBY,gBAAgB,EAChB;EACA,IAAIQ,eAAe,GAAGmB,sBAAsB,CAC1C3B,gBAAgB,EAChBX,aAAa,CAACuC,mBAChB,CAAC;EAED,IAAInB,yBAAwB,GAAG,KAAK;EAEpChC,mBAAmB,CACjBU,SAAS,EACTC,qBAAqB,EACrBC,aAAa,EACb,UAAUwC,oBAAoB,EAAE;IAC9BpB,yBAAwB,GAAGoB,oBAAoB,CAACC,WAAW;EAC7D,CAAC,EACDpD,8BACF,CAAC;EAED,OAAO;IACL8B,eAAe,EAAEA,eAAe;IAChCC,wBAAwB,EAAE,SAAAA,yBAAA,EAAY;MACpC,OAAOA,yBAAwB;IACjC;EACF,CAAC;AACH;AACA,SAASH,gBAAgBA,CACvBjB,aAAa,EACbF,SAAS,EACTC,qBAAqB,EACrBE,OAAO,EACPC,cAAc,EACdgB,uBAAuB,EACvBC,eAAe,EACfJ,UAAU,EACVC,eAAe,EACfI,wBAAwB,EACxB;EACA,IAAIY,KAAK,GAAGU,QAAQ,CAClB5C,SAAS,EACTG,OAAO,EACPe,eAAe,EACfG,eAAe,EACfJ,UACF,CAAC;EACDG,uBAAuB,CAACc,KAAK,CAAC;EAC9B,IAAIW,oBAAoB,GAAGvD,mBAAmB,CAC5CU,SAAS,EACTC,qBAAqB,EACrBC,aAAa,EACb,UAAUwC,oBAAoB,EAAE;IAC9B,IACEA,oBAAoB,CAACC,WAAW,IAChCD,oBAAoB,CAACI,GAAG,GAAGZ,KAAK,CAACa,WAAW,CAACC,SAAS,EACtD;MACA;MACAd,KAAK,CAACe,OAAO,CAAC,CAAC;IACjB,CAAC,MAAM;MACL,IAAIP,oBAAoB,CAACC,WAAW,EAAE;QACpCT,KAAK,CAACV,IAAI,CAACkB,oBAAoB,CAACI,GAAG,CAAC;MACtC,CAAC,MAAM,IAAIxB,wBAAwB,CAAC,CAAC,EAAE;QACrCY,KAAK,CAACV,IAAI;QACR;QACA;QACAU,KAAK,CAACa,WAAW,CAACC,SACpB,CAAC;MACH,CAAC,MAAM;QACLd,KAAK,CAACV,IAAI,CAAC,CAAC;MACd;IACF;EACF,CAAC,EACD3B,yBACF,CAAC;EACD,IAAIqD,uBAAuB,GAAGL,oBAAoB,CAACrB,IAAI;EACvD,IAAI2B,qBAAqB,GAAGnD,SAAS,CAACM,SAAS,CAC7CtB,kBAAkB,CAACyB,UAAU,EAC7B,UAAUO,IAAI,EAAE;IACdkB,KAAK,CAACV,IAAI,CAACR,IAAI,CAACoC,SAAS,CAACJ,SAAS,CAAC;EACtC,CACF,CAAC;EAED,IAAIK,gBAAgB,GAAGjD,cAAc,CAACE,SAAS,CAAC,YAAY;IAC1D4B,KAAK,CAACV,IAAI,CAAC,CAAC;EACd,CAAC,CAAC;EAEFU,KAAK,CAAC9B,cAAc,CAACE,SAAS,CAAC,YAAY;IACzC6C,qBAAqB,CAACG,WAAW,CAAC,CAAC;IACnCJ,uBAAuB,CAAC,CAAC;IACzBG,gBAAgB,CAACC,WAAW,CAAC,CAAC;EAChC,CAAC,CAAC;AACJ;AAEA,SAASd,sBAAsBA,CAACe,KAAK,EAAEd,mBAAmB,EAAE;EAC1D,IAAIe,IAAI,GAAGD,KAAK,CAACE,MAAM,CAACC,qBAAqB,CAAC,CAAC;EAC/C,OAAO;IACLC,IAAI,EAAE1E,UAAU,CAAC2E,KAAK;IACtBH,MAAM,EAAE;MACNI,KAAK,EAAEC,IAAI,CAACC,KAAK,CAACP,IAAI,CAACK,KAAK,CAAC;MAC7BG,MAAM,EAAEF,IAAI,CAACC,KAAK,CAACP,IAAI,CAACQ,MAAM,CAAC;MAC/BC,QAAQ,EAAEvE,sBAAsB,CAAC6D,KAAK,CAACE,MAAM,EAAEhB,mBAAmB;IACpE,CAAC;IACDyB,QAAQ,EAAE;MACRC,CAAC,EAAEL,IAAI,CAACC,KAAK,CAACR,KAAK,CAACa,OAAO,GAAGZ,IAAI,CAACa,IAAI,CAAC;MACxCC,CAAC,EAAER,IAAI,CAACC,KAAK,CAACR,KAAK,CAACgB,OAAO,GAAGf,IAAI,CAACgB,GAAG;IACxC,CAAC;IACDC,IAAI,EAAEhF,wBAAwB,CAAC8D,KAAK,CAACE,MAAM,EAAEhB,mBAAmB;EAClE,CAAC;AACH;AAEA,IAAIiC,WAAW,GAAG;EAChB;EACAC,OAAO,EAAE,CAAC;EACV;EACAC,OAAO,EAAE,CAAC;EACV;EACAC,SAAS,EAAE;AACb,CAAC;AAED,SAASjC,QAAQA,CACf5C,SAAS,EACTG,OAAO,EACPe,eAAe,EACfG,eAAe,EACfJ,UAAU,EACV;EACA,IAAI6D,EAAE,GAAGpG,IAAI,CAAC,CAAC;EACf,IAAIqE,WAAW,GAAGpE,SAAS,CAAC,CAAC;EAC7B,IAAIoG,YAAY,GAAG5E,OAAO,CAAC6E,GAAG,CAACF,EAAE,EAAE/B,WAAW,CAACkC,QAAQ,CAAC;EACxD,IAAIC,uBAAuB,GAAG7F,gBAAgB,CAAC;IAC7CW,SAAS,EAAEA,SAAS;IACpBmF,YAAY,EAAE,SAAAA,aAAU5B,KAAK,EAAE;MAC7B,OACEA,KAAK,CAAC6B,MAAM,KAAKrD,SAAS,KACzB5C,OAAO,CAACoE,KAAK,CAAC6B,MAAM,CAACC,GAAG,CAAC,GACtBjG,QAAQ,CAACmE,KAAK,CAAC6B,MAAM,CAACC,GAAG,EAAEP,EAAE,CAAC,GAC9BvB,KAAK,CAAC6B,MAAM,CAACC,GAAG,KAAKP,EAAE,CAAC;IAEhC;EACF,CAAC,CAAC;EACF,IAAIQ,MAAM,GAAGZ,WAAW,CAACC,OAAO;EAChC,IAAIY,eAAe;EACnB,IAAIC,gBAAgB,GAAG,EAAE;EACzB,IAAIpF,cAAc,GAAG,IAAI/B,UAAU,CAAC,CAAC;EAErC,SAASmD,IAAIA,CAACiE,kBAAkB,EAAE;IAChC,IAAIH,MAAM,KAAKZ,WAAW,CAACC,OAAO,EAAE;MAClC;IACF;IACAY,eAAe,GAAGE,kBAAkB;IACpCH,MAAM,GAAGZ,WAAW,CAACE,OAAO;IAC5B,IAAIW,eAAe,EAAE;MACnBR,YAAY,CAACW,KAAK,CAACnH,eAAe,CAACgH,eAAe,CAAC,CAAC;IACtD,CAAC,MAAM;MACLR,YAAY,CAACY,MAAM,CAAC,CAAC;IACvB;IACAT,uBAAuB,CAAC1D,IAAI,CAAC,CAAC;IAC9BpB,cAAc,CAAC6B,MAAM,CAAC,CAAC;EACzB;EAEA,OAAO;IACLsB,KAAK,EAAEtC,UAAU;IACjBO,IAAI,EAAEA,IAAI;IACVpB,cAAc,EAAEA,cAAc;IAC9BwF,QAAQ,EAAE,SAAAA,SAAA,EAAY;MACpB,OAAOV,uBAAuB,CAACW,WAAW,CAACC,UAAU,GAAG,CAAC;IAC3D,CAAC;IACDC,eAAe,EAAE,SAAAA,gBAAA,EAAY;MAC3B,OAAOR,eAAe,KAAKxD,SAAS;IACtC,CAAC;IACDb,eAAe,EAAEA,eAAe;IAChC8E,cAAc,EAAE,SAAAA,eAAUC,eAAe,EAAE;MACzCT,gBAAgB,CAACU,IAAI,CAACD,eAAe,CAAC;IACxC,CAAC;IACDlD,WAAW,EAAEA,WAAW;IACxBoD,SAAS,EAAE,SAAAA,UAAA,EAAY;MACrB,OAAOb,MAAM,KAAKZ,WAAW,CAACE,OAAO,IAAIU,MAAM,KAAKZ,WAAW,CAACG,SAAS;IAC3E,CAAC;IAEDxC,KAAK,EAAE,SAAAA,MAAA,EAAY;MACjB,OAAOO,QAAQ,CACb5C,SAAS,EACTG,OAAO,EACPe,eAAe,EACfG,eAAe,EACfJ,UACF,CAAC;IACH,CAAC;IAEDmF,QAAQ,EAAE,SAAAA,SAAUC,SAAS,EAAE;MAC7B7E,IAAI,CAAC,CAAC;MACN,IAAI8D,MAAM,KAAKZ,WAAW,CAACE,OAAO,EAAE;QAClC;MACF;MACA,IAAI0B,wBAAwB,GAAGpB,uBAAuB,CAACW,WAAW;MAClE,IAAIU,aAAa,GAAGD,wBAAwB,CAACC,aAAa;MAC1D,IAAIT,UAAU,GAAGQ,wBAAwB,CAACR,UAAU;MACpD,IAAIU,aAAa,GAAGF,wBAAwB,CAACE,aAAa;MAC1D,IAAIC,WAAW,GAAGnI,MAAM,CACtB;QACEqF,IAAI,EAAE1E,UAAU,CAAC2E,KAAK;QACtB8C,QAAQ,EACNnB,eAAe,IAAI1G,OAAO,CAACkE,WAAW,CAACC,SAAS,EAAEuC,eAAe,CAAC;QACpExC,WAAW,EAAEA,WAAW;QACxB+B,EAAE,EAAEA,EAAE;QACNU,gBAAgB,EAAEA,gBAAgB;QAClCmB,MAAM,EAAE;UACNJ,aAAa,EAAEA,aAAa;UAC5BT,UAAU,EAAEA,UAAU;UACtBU,aAAa,EAAEA;QACjB,CAAC;QACDI,MAAM,EAAE1H,2BAA2B,CAACmH,SAAS,EAAE,CAACpF,UAAU,CAAC,CAAC;QAC5DsC,KAAK,EAAEtC;MACT,CAAC,EACDI,eACF,CAAC;MACDrB,SAAS,CAACiC,MAAM,CAACjD,kBAAkB,CAAC6H,qBAAqB,EAAEJ,WAAW,CAAC;MACvEnB,MAAM,GAAGZ,WAAW,CAACG,SAAS;IAChC,CAAC;IAED5B,OAAO,EAAE,SAAAA,QAAA,EAAY;MACnBzB,IAAI,CAAC,CAAC;MACN8D,MAAM,GAAGZ,WAAW,CAACG,SAAS;IAChC;EACF,CAAC;AACH;AAEA,OAAO,SAAStC,cAAcA,CAACD,MAAM,EAAEF,SAAS,EAAE;EAChD,IAAI0E,mBAAmB,GAAGlH,kBAAkB,CAAC0C,MAAM,EAAEF,SAAS,CAAC;EAC/D,IAAI2E,MAAM,GAAGD,mBAAmB,CAACC,MAAM;EACvC,IAAIA,MAAM,EAAE;IACVjI,IAAI,CAACwD,MAAM,EAAE,UAAUJ,KAAK,EAAE;MAC5BA,KAAK,CAACe,OAAO,CAAC,CAAC;IACjB,CAAC,CAAC;IACFb,SAAS,CAACZ,IAAI,CAACpD,YAAY,CAAC,CAAC,CAAC;IAC9BgE,SAAS,CAACgE,QAAQ,CAChBrH,GAAG,CAACuD,MAAM,EAAE,UAAUJ,KAAK,EAAE;MAC3B,OAAOA,KAAK,CAACqB,KAAK;IACpB,CAAC,CACH,CAAC;EACH,CAAC,MAAM;IACLnB,SAAS,CAACa,OAAO,CAAC,CAAC;IACnBnE,IAAI,CAACwD,MAAM,EAAE,UAAUJ,KAAK,EAAE;MAC5BA,KAAK,CAACkE,QAAQ,CAAC,CAAC;IAClB,CAAC,CAAC;EACJ;AACF","ignoreList":[]}