{"version":3,"file":"actionCollection.js","names":["toServerDuration","extend","extend2Lev","ActionType","RumEventType","LifeCycleEventType","UUID","noop","trackClickActions","startActionCollection","lifeCycle","domMutationObservable","configuration","pageStateHistory","subscribe","AUTO_ACTION_COMPLETED","action","notify","RAW_RUM_EVENT_COLLECTED","processAction","actionContexts","findActionId","findAllActionId","trackUserInteractions","addAction","savedCommonContext","autoActionProperties","isAutoAction","error","count","counts","errorCount","id","loadingTime","duration","frustration","type","frustrationTypes","long_task","longTaskCount","resource","resourceCount","_gc","target","position","customerContext","context","undefined","actionEvent","name","date","startClocks","timeStamp","ACTION","view","in_foreground","isInActivePageStateAt","relative","rawRumEvent","startTime","domainContext","event","events","CUSTOM"],"sources":["../../../../src/domain/rumEventsCollection/actions/actionCollection.js"],"sourcesContent":["import {\n  toServerDuration,\n  extend,\n  extend2Lev,\n  ActionType,\n  RumEventType,\n  LifeCycleEventType,\n  UUID,\n  noop\n} from '@cloudcare/browser-core'\nimport { trackClickActions } from './trackClickActions'\nexport function startActionCollection(\n  lifeCycle,\n  domMutationObservable,\n  configuration,\n  pageStateHistory\n) {\n  lifeCycle.subscribe(\n    LifeCycleEventType.AUTO_ACTION_COMPLETED,\n    function (action) {\n      lifeCycle.notify(\n        LifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n        processAction(action, pageStateHistory)\n      )\n    }\n  )\n\n  var actionContexts = { findActionId: noop, findAllActionId: noop }\n  if (configuration.trackUserInteractions) {\n    actionContexts = trackClickActions(\n      lifeCycle,\n      domMutationObservable,\n      configuration\n    ).actionContexts\n  }\n  return {\n    actionContexts: actionContexts,\n    addAction: function (action, savedCommonContext) {\n      lifeCycle.notify(\n        LifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n        extend(\n          { savedCommonContext: savedCommonContext },\n          processAction(action, pageStateHistory)\n        )\n      )\n    }\n  }\n}\n\nfunction processAction(action, pageStateHistory) {\n  var autoActionProperties = isAutoAction(action)\n    ? {\n        action: {\n          error: {\n            count: action.counts.errorCount\n          },\n          id: action.id,\n          loadingTime: toServerDuration(action.duration),\n          frustration: {\n            type: action.frustrationTypes\n          },\n          long_task: {\n            count: action.counts.longTaskCount\n          },\n          resource: {\n            count: action.counts.resourceCount\n          }\n        },\n        _gc: {\n          action: {\n            target: action.target,\n            position: action.position\n          }\n        }\n      }\n    : {\n        action: {\n          loadingTime: 0\n        }\n      }\n  var customerContext = !isAutoAction(action) ? action.context : undefined\n  var actionEvent = extend2Lev(\n    {\n      action: {\n        id: UUID(),\n        target: {\n          name: action.name\n        },\n        type: action.type\n      },\n      date: action.startClocks.timeStamp,\n      type: RumEventType.ACTION,\n      view: {\n        in_foreground: pageStateHistory.isInActivePageStateAt(\n          action.startClocks.relative\n        )\n      }\n    },\n    autoActionProperties\n  )\n\n  return {\n    customerContext: customerContext,\n    rawRumEvent: actionEvent,\n    startTime: action.startClocks.relative,\n    domainContext: isAutoAction(action)\n      ? { event: action.event, events: action.events }\n      : {}\n  }\n}\n\nfunction isAutoAction(action) {\n  return action.type !== ActionType.CUSTOM\n}\n"],"mappings":"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","ignoreList":[]}