{"version":3,"file":"computeFrustration.js","names":["elementMatches","ONE_SECOND","FrustrationType","some","each","MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE","computeFrustration","clicks","rageClick","isRage","addFrustration","RAGE_CLICK","isDead","DEAD_CLICK","hasError","ERROR_CLICK","hasSelectionChanged","click","getUserActivity","selection","scroll","i","length","event","timeStamp","DEAD_CLICK_EXCLUDE_SELECTOR","hasPageActivity","input","target"],"sources":["../../../../src/domain/rumEventsCollection/actions/computeFrustration.js"],"sourcesContent":["import {\n  elementMatches,\n  ONE_SECOND,\n  FrustrationType,\n  some,\n  each\n} from '@cloudcare/browser-core'\n\nvar MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE = 3\n\nexport function computeFrustration(clicks, rageClick) {\n  if (isRage(clicks)) {\n    rageClick.addFrustration(FrustrationType.RAGE_CLICK)\n    if (some(clicks, isDead)) {\n      rageClick.addFrustration(FrustrationType.DEAD_CLICK)\n    }\n    if (rageClick.hasError()) {\n      rageClick.addFrustration(FrustrationType.ERROR_CLICK)\n    }\n    return { isRage: true }\n  }\n\n  var hasSelectionChanged = some(clicks, function (click) {\n    return click.getUserActivity().selection\n  })\n  each(clicks, function (click) {\n    if (click.hasError()) {\n      click.addFrustration(FrustrationType.ERROR_CLICK)\n    }\n    if (\n      isDead(click) &&\n      // Avoid considering clicks part of a double-click or triple-click selections as dead clicks\n      !hasSelectionChanged\n    ) {\n      click.addFrustration(FrustrationType.DEAD_CLICK)\n    }\n  })\n\n  return { isRage: false }\n}\n\nexport function isRage(clicks) {\n  if (\n    some(clicks, function (click) {\n      return click.getUserActivity().selection || click.getUserActivity().scroll\n    })\n  ) {\n    return false\n  }\n  for (\n    var i = 0;\n    i < clicks.length - (MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE - 1);\n    i += 1\n  ) {\n    if (\n      clicks[i + MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE - 1].event.timeStamp -\n        clicks[i].event.timeStamp <=\n      ONE_SECOND\n    ) {\n      return true\n    }\n  }\n  return false\n}\n\nvar DEAD_CLICK_EXCLUDE_SELECTOR =\n  // inputs that don't trigger a meaningful event like \"input\" when clicked, including textual\n  // inputs (using a negative selector is shorter here)\n  'input:not([type=\"checkbox\"]):not([type=\"radio\"]):not([type=\"button\"]):not([type=\"submit\"]):not([type=\"reset\"]):not([type=\"range\"]),' +\n  'textarea,' +\n  'select,' +\n  // contenteditable and their descendants don't always trigger meaningful changes when manipulated\n  '[contenteditable],' +\n  '[contenteditable] *,' +\n  // canvas, as there is no good way to detect activity occurring on them\n  'canvas,' +\n  // links that are interactive (have an href attribute) or any of their descendants, as they can\n  // open a new tab or navigate to a hash without triggering a meaningful event\n  'a[href],' +\n  'a[href] *'\n\nexport function isDead(click) {\n  if (\n    click.hasPageActivity() ||\n    click.getUserActivity().input ||\n    click.getUserActivity().scroll\n  ) {\n    return false\n  }\n  return !elementMatches(click.event.target, DEAD_CLICK_EXCLUDE_SELECTOR)\n}\n"],"mappings":"AAAA,SACEA,cAAc,EACdC,UAAU,EACVC,eAAe,EACfC,IAAI,EACJC,IAAI,QACC,yBAAyB;AAEhC,IAAIC,sCAAsC,GAAG,CAAC;AAE9C,OAAO,SAASC,kBAAkBA,CAACC,MAAM,EAAEC,SAAS,EAAE;EACpD,IAAIC,MAAM,CAACF,MAAM,CAAC,EAAE;IAClBC,SAAS,CAACE,cAAc,CAACR,eAAe,CAACS,UAAU,CAAC;IACpD,IAAIR,IAAI,CAACI,MAAM,EAAEK,MAAM,CAAC,EAAE;MACxBJ,SAAS,CAACE,cAAc,CAACR,eAAe,CAACW,UAAU,CAAC;IACtD;IACA,IAAIL,SAAS,CAACM,QAAQ,CAAC,CAAC,EAAE;MACxBN,SAAS,CAACE,cAAc,CAACR,eAAe,CAACa,WAAW,CAAC;IACvD;IACA,OAAO;MAAEN,MAAM,EAAE;IAAK,CAAC;EACzB;EAEA,IAAIO,mBAAmB,GAAGb,IAAI,CAACI,MAAM,EAAE,UAAUU,KAAK,EAAE;IACtD,OAAOA,KAAK,CAACC,eAAe,CAAC,CAAC,CAACC,SAAS;EAC1C,CAAC,CAAC;EACFf,IAAI,CAACG,MAAM,EAAE,UAAUU,KAAK,EAAE;IAC5B,IAAIA,KAAK,CAACH,QAAQ,CAAC,CAAC,EAAE;MACpBG,KAAK,CAACP,cAAc,CAACR,eAAe,CAACa,WAAW,CAAC;IACnD;IACA,IACEH,MAAM,CAACK,KAAK,CAAC;IACb;IACA,CAACD,mBAAmB,EACpB;MACAC,KAAK,CAACP,cAAc,CAACR,eAAe,CAACW,UAAU,CAAC;IAClD;EACF,CAAC,CAAC;EAEF,OAAO;IAAEJ,MAAM,EAAE;EAAM,CAAC;AAC1B;AAEA,OAAO,SAASA,MAAMA,CAACF,MAAM,EAAE;EAC7B,IACEJ,IAAI,CAACI,MAAM,EAAE,UAAUU,KAAK,EAAE;IAC5B,OAAOA,KAAK,CAACC,eAAe,CAAC,CAAC,CAACC,SAAS,IAAIF,KAAK,CAACC,eAAe,CAAC,CAAC,CAACE,MAAM;EAC5E,CAAC,CAAC,EACF;IACA,OAAO,KAAK;EACd;EACA,KACE,IAAIC,CAAC,GAAG,CAAC,EACTA,CAAC,GAAGd,MAAM,CAACe,MAAM,IAAIjB,sCAAsC,GAAG,CAAC,CAAC,EAChEgB,CAAC,IAAI,CAAC,EACN;IACA,IACEd,MAAM,CAACc,CAAC,GAAGhB,sCAAsC,GAAG,CAAC,CAAC,CAACkB,KAAK,CAACC,SAAS,GACpEjB,MAAM,CAACc,CAAC,CAAC,CAACE,KAAK,CAACC,SAAS,IAC3BvB,UAAU,EACV;MACA,OAAO,IAAI;IACb;EACF;EACA,OAAO,KAAK;AACd;AAEA,IAAIwB,2BAA2B;AAC7B;AACA;AACA,qIAAqI,GACrI,WAAW,GACX,SAAS;AACT;AACA,oBAAoB,GACpB,sBAAsB;AACtB;AACA,SAAS;AACT;AACA;AACA,UAAU,GACV,WAAW;AAEb,OAAO,SAASb,MAAMA,CAACK,KAAK,EAAE;EAC5B,IACEA,KAAK,CAACS,eAAe,CAAC,CAAC,IACvBT,KAAK,CAACC,eAAe,CAAC,CAAC,CAACS,KAAK,IAC7BV,KAAK,CAACC,eAAe,CAAC,CAAC,CAACE,MAAM,EAC9B;IACA,OAAO,KAAK;EACd;EACA,OAAO,CAACpB,cAAc,CAACiB,KAAK,CAACM,KAAK,CAACK,MAAM,EAAEH,2BAA2B,CAAC;AACzE","ignoreList":[]}