{"version":3,"file":"domMutationObservable.js","names":["_browserCore","require","createDOMMutationObservable","MutationObserver","getMutationObserverConstructor","Observable","observable","observer","monitor","notify","observe","document","attributes","characterData","childList","subtree","disconnect","constructor","browserWindow","window","Zone","getZoneJsOriginalValue","patchedInstance","noop","originalInstance"],"sources":["../../src/domain/domMutationObservable.js"],"sourcesContent":["import {\n  noop,\n  Observable,\n  getZoneJsOriginalValue,\n  monitor\n} from '@cloudcare/browser-core'\n\nexport function createDOMMutationObservable() {\n  var MutationObserver = getMutationObserverConstructor()\n\n  return new Observable(function (observable) {\n    if (!MutationObserver) {\n      return\n    }\n    var observer = new MutationObserver(\n      monitor(function () {\n        return observable.notify()\n      })\n    )\n    observer.observe(document, {\n      attributes: true,\n      characterData: true,\n      childList: true,\n      subtree: true\n    })\n    return function () {\n      return observer.disconnect()\n    }\n  })\n}\n\nexport function getMutationObserverConstructor() {\n  var constructor\n  var browserWindow = window\n\n  // Angular uses Zone.js to provide a context persisting across async tasks.  Zone.js replaces the\n  // global MutationObserver constructor with a patched version to support the context propagation.\n  // There is an ongoing issue[1][2] with this setup when using a MutationObserver within a Angular\n  // component: on some occasions, the callback is being called in an infinite loop, causing the\n  // page to freeze (even if the callback is completely empty).\n  //\n  // To work around this issue, we try to get the original MutationObserver constructor stored by\n  // Zone.js.\n  //\n  // [1] https://github.com/angular/angular/issues/26948\n  // [2] https://github.com/angular/angular/issues/31712\n  if (browserWindow.Zone) {\n    // Zone.js 0.8.6+ is storing original class constructors into the browser 'window' object[3].\n    //\n    // [3] https://github.com/angular/angular/blob/6375fa79875c0fe7b815efc45940a6e6f5c9c9eb/packages/zone.js/lib/common/utils.ts#L288\n    constructor = getZoneJsOriginalValue(browserWindow, 'MutationObserver')\n\n    if (\n      browserWindow.MutationObserver &&\n      constructor === browserWindow.MutationObserver\n    ) {\n      // Anterior Zone.js versions (used in Angular 2) does not expose the original MutationObserver\n      // in the 'window' object. Luckily, the patched MutationObserver class is storing an original\n      // instance in its properties[4]. Let's get the original MutationObserver constructor from\n      // there.\n      //\n      // [4] https://github.com/angular/zone.js/blob/v0.8.5/lib/common/utils.ts#L412\n\n      var patchedInstance = new browserWindow.MutationObserver(noop)\n\n      var originalInstance = getZoneJsOriginalValue(\n        patchedInstance,\n        'originalInstance'\n      )\n      constructor = originalInstance && originalInstance.constructor\n    }\n  }\n\n  if (!constructor) {\n    constructor = browserWindow.MutationObserver\n  }\n\n  return constructor\n}\n"],"mappings":";;;;;;;AAAA,IAAAA,YAAA,GAAAC,OAAA;AAOO,SAASC,2BAA2BA,CAAA,EAAG;EAC5C,IAAIC,gBAAgB,GAAGC,8BAA8B,CAAC,CAAC;EAEvD,OAAO,IAAIC,uBAAU,CAAC,UAAUC,UAAU,EAAE;IAC1C,IAAI,CAACH,gBAAgB,EAAE;MACrB;IACF;IACA,IAAII,QAAQ,GAAG,IAAIJ,gBAAgB,CACjC,IAAAK,oBAAO,EAAC,YAAY;MAClB,OAAOF,UAAU,CAACG,MAAM,CAAC,CAAC;IAC5B,CAAC,CACH,CAAC;IACDF,QAAQ,CAACG,OAAO,CAACC,QAAQ,EAAE;MACzBC,UAAU,EAAE,IAAI;MAChBC,aAAa,EAAE,IAAI;MACnBC,SAAS,EAAE,IAAI;MACfC,OAAO,EAAE;IACX,CAAC,CAAC;IACF,OAAO,YAAY;MACjB,OAAOR,QAAQ,CAACS,UAAU,CAAC,CAAC;IAC9B,CAAC;EACH,CAAC,CAAC;AACJ;AAEO,SAASZ,8BAA8BA,CAAA,EAAG;EAC/C,IAAIa,WAAW;EACf,IAAIC,aAAa,GAAGC,MAAM;;EAE1B;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,IAAID,aAAa,CAACE,IAAI,EAAE;IACtB;IACA;IACA;IACAH,WAAW,GAAG,IAAAI,mCAAsB,EAACH,aAAa,EAAE,kBAAkB,CAAC;IAEvE,IACEA,aAAa,CAACf,gBAAgB,IAC9Bc,WAAW,KAAKC,aAAa,CAACf,gBAAgB,EAC9C;MACA;MACA;MACA;MACA;MACA;MACA;;MAEA,IAAImB,eAAe,GAAG,IAAIJ,aAAa,CAACf,gBAAgB,CAACoB,iBAAI,CAAC;MAE9D,IAAIC,gBAAgB,GAAG,IAAAH,mCAAsB,EAC3CC,eAAe,EACf,kBACF,CAAC;MACDL,WAAW,GAAGO,gBAAgB,IAAIA,gBAAgB,CAACP,WAAW;IAChE;EACF;EAEA,IAAI,CAACA,WAAW,EAAE;IAChBA,WAAW,GAAGC,aAAa,CAACf,gBAAgB;EAC9C;EAEA,OAAOc,WAAW;AACpB","ignoreList":[]}