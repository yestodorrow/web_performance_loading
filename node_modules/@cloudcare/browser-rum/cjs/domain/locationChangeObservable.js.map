{"version":3,"file":"locationChangeObservable.js","names":["_browserCore","require","createLocationChangeObservable","location","currentLocation","shallowClone","Observable","observable","_trackHistory","trackHistory","onLocationChange","_trackHash","trackHash","href","newLocation","notify","oldLocation","stop","onHistoryChange","pushState","instrumentMethodAndCallOriginal","history","after","replaceState","popState","addEventListener","window","DOM_EVENT","POP_STATE","onHashChange","HASH_CHANGE"],"sources":["../../src/domain/locationChangeObservable.js"],"sourcesContent":["import {\n  addEventListener,\n  DOM_EVENT,\n  Observable,\n  shallowClone,\n  instrumentMethodAndCallOriginal\n} from '@cloudcare/browser-core'\n\nexport function createLocationChangeObservable(location) {\n  var currentLocation = shallowClone(location)\n  return new Observable(function (observable) {\n    var _trackHistory = trackHistory(onLocationChange)\n    var _trackHash = trackHash(onLocationChange)\n    function onLocationChange() {\n      if (currentLocation.href === location.href) {\n        return\n      }\n      var newLocation = shallowClone(location)\n      observable.notify({\n        newLocation: newLocation,\n        oldLocation: currentLocation\n      })\n      currentLocation = newLocation\n    }\n    return function () {\n      _trackHistory.stop()\n      _trackHash.stop()\n    }\n  })\n}\n\nfunction trackHistory(onHistoryChange) {\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  var pushState = instrumentMethodAndCallOriginal(history, 'pushState', {\n    after: onHistoryChange\n  })\n  var replaceState = instrumentMethodAndCallOriginal(history, 'replaceState', {\n    after: onHistoryChange\n  })\n  var popState = addEventListener(window, DOM_EVENT.POP_STATE, onHistoryChange)\n\n  return {\n    stop: function () {\n      pushState.stop()\n      replaceState.stop()\n      popState.stop()\n    }\n  }\n}\n\nfunction trackHash(onHashChange) {\n  return addEventListener(window, DOM_EVENT.HASH_CHANGE, onHashChange)\n}\n"],"mappings":";;;;;;AAAA,IAAAA,YAAA,GAAAC,OAAA;AAQO,SAASC,8BAA8BA,CAACC,QAAQ,EAAE;EACvD,IAAIC,eAAe,GAAG,IAAAC,yBAAY,EAACF,QAAQ,CAAC;EAC5C,OAAO,IAAIG,uBAAU,CAAC,UAAUC,UAAU,EAAE;IAC1C,IAAIC,aAAa,GAAGC,YAAY,CAACC,gBAAgB,CAAC;IAClD,IAAIC,UAAU,GAAGC,SAAS,CAACF,gBAAgB,CAAC;IAC5C,SAASA,gBAAgBA,CAAA,EAAG;MAC1B,IAAIN,eAAe,CAACS,IAAI,KAAKV,QAAQ,CAACU,IAAI,EAAE;QAC1C;MACF;MACA,IAAIC,WAAW,GAAG,IAAAT,yBAAY,EAACF,QAAQ,CAAC;MACxCI,UAAU,CAACQ,MAAM,CAAC;QAChBD,WAAW,EAAEA,WAAW;QACxBE,WAAW,EAAEZ;MACf,CAAC,CAAC;MACFA,eAAe,GAAGU,WAAW;IAC/B;IACA,OAAO,YAAY;MACjBN,aAAa,CAACS,IAAI,CAAC,CAAC;MACpBN,UAAU,CAACM,IAAI,CAAC,CAAC;IACnB,CAAC;EACH,CAAC,CAAC;AACJ;AAEA,SAASR,YAAYA,CAACS,eAAe,EAAE;EACrC;EACA,IAAIC,SAAS,GAAG,IAAAC,4CAA+B,EAACC,OAAO,EAAE,WAAW,EAAE;IACpEC,KAAK,EAAEJ;EACT,CAAC,CAAC;EACF,IAAIK,YAAY,GAAG,IAAAH,4CAA+B,EAACC,OAAO,EAAE,cAAc,EAAE;IAC1EC,KAAK,EAAEJ;EACT,CAAC,CAAC;EACF,IAAIM,QAAQ,GAAG,IAAAC,6BAAgB,EAACC,MAAM,EAAEC,sBAAS,CAACC,SAAS,EAAEV,eAAe,CAAC;EAE7E,OAAO;IACLD,IAAI,EAAE,SAAAA,KAAA,EAAY;MAChBE,SAAS,CAACF,IAAI,CAAC,CAAC;MAChBM,YAAY,CAACN,IAAI,CAAC,CAAC;MACnBO,QAAQ,CAACP,IAAI,CAAC,CAAC;IACjB;EACF,CAAC;AACH;AAEA,SAASL,SAASA,CAACiB,YAAY,EAAE;EAC/B,OAAO,IAAAJ,6BAAgB,EAACC,MAAM,EAAEC,sBAAS,CAACG,WAAW,EAAED,YAAY,CAAC;AACtE","ignoreList":[]}