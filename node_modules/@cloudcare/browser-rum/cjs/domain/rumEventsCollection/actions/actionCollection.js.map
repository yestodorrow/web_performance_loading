{"version":3,"file":"actionCollection.js","names":["_browserCore","require","_trackClickActions","startActionCollection","lifeCycle","domMutationObservable","configuration","pageStateHistory","subscribe","LifeCycleEventType","AUTO_ACTION_COMPLETED","action","notify","RAW_RUM_EVENT_COLLECTED","processAction","actionContexts","findActionId","noop","findAllActionId","trackUserInteractions","trackClickActions","addAction","savedCommonContext","extend","autoActionProperties","isAutoAction","error","count","counts","errorCount","id","loadingTime","toServerDuration","duration","frustration","type","frustrationTypes","long_task","longTaskCount","resource","resourceCount","_gc","target","position","customerContext","context","undefined","actionEvent","extend2Lev","UUID","name","date","startClocks","timeStamp","RumEventType","ACTION","view","in_foreground","isInActivePageStateAt","relative","rawRumEvent","startTime","domainContext","event","events","ActionType","CUSTOM"],"sources":["../../../../src/domain/rumEventsCollection/actions/actionCollection.js"],"sourcesContent":["import {\n  toServerDuration,\n  extend,\n  extend2Lev,\n  ActionType,\n  RumEventType,\n  LifeCycleEventType,\n  UUID,\n  noop\n} from '@cloudcare/browser-core'\nimport { trackClickActions } from './trackClickActions'\nexport function startActionCollection(\n  lifeCycle,\n  domMutationObservable,\n  configuration,\n  pageStateHistory\n) {\n  lifeCycle.subscribe(\n    LifeCycleEventType.AUTO_ACTION_COMPLETED,\n    function (action) {\n      lifeCycle.notify(\n        LifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n        processAction(action, pageStateHistory)\n      )\n    }\n  )\n\n  var actionContexts = { findActionId: noop, findAllActionId: noop }\n  if (configuration.trackUserInteractions) {\n    actionContexts = trackClickActions(\n      lifeCycle,\n      domMutationObservable,\n      configuration\n    ).actionContexts\n  }\n  return {\n    actionContexts: actionContexts,\n    addAction: function (action, savedCommonContext) {\n      lifeCycle.notify(\n        LifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n        extend(\n          { savedCommonContext: savedCommonContext },\n          processAction(action, pageStateHistory)\n        )\n      )\n    }\n  }\n}\n\nfunction processAction(action, pageStateHistory) {\n  var autoActionProperties = isAutoAction(action)\n    ? {\n        action: {\n          error: {\n            count: action.counts.errorCount\n          },\n          id: action.id,\n          loadingTime: toServerDuration(action.duration),\n          frustration: {\n            type: action.frustrationTypes\n          },\n          long_task: {\n            count: action.counts.longTaskCount\n          },\n          resource: {\n            count: action.counts.resourceCount\n          }\n        },\n        _gc: {\n          action: {\n            target: action.target,\n            position: action.position\n          }\n        }\n      }\n    : {\n        action: {\n          loadingTime: 0\n        }\n      }\n  var customerContext = !isAutoAction(action) ? action.context : undefined\n  var actionEvent = extend2Lev(\n    {\n      action: {\n        id: UUID(),\n        target: {\n          name: action.name\n        },\n        type: action.type\n      },\n      date: action.startClocks.timeStamp,\n      type: RumEventType.ACTION,\n      view: {\n        in_foreground: pageStateHistory.isInActivePageStateAt(\n          action.startClocks.relative\n        )\n      }\n    },\n    autoActionProperties\n  )\n\n  return {\n    customerContext: customerContext,\n    rawRumEvent: actionEvent,\n    startTime: action.startClocks.relative,\n    domainContext: isAutoAction(action)\n      ? { event: action.event, events: action.events }\n      : {}\n  }\n}\n\nfunction isAutoAction(action) {\n  return action.type !== ActionType.CUSTOM\n}\n"],"mappings":"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","ignoreList":[]}