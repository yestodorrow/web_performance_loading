{"version":3,"file":"trackClickActions.js","names":["_browserCore","require","_trackEventCounts","_waitPageActivityEnd2","_clickChain","_getActionNameFromElement","_getSelectorsFromElement","_listenActionEvents2","_computeFrustration2","CLICK_ACTION_MAX_DURATION","ONE_SECOND","exports","ACTION_CONTEXT_TIME_OUT_DELAY","ONE_MINUTE","trackClickActions","lifeCycle","domMutationObservable","configuration","history","ContextHistory","stopObservable","Observable","currentClickChain","subscribe","LifeCycleEventType","SESSION_RENEWED","reset","VIEW_ENDED","stopClickChain","_listenActionEvents","listenActionEvents","onPointerDown","pointerDownEvent","processPointerDown","onPointerUp","data","startEvent","getUserActivity","startClickAction","appendClickToClickChain","clickActionBase","hadActivityOnPointerDown","stopActionEventsListener","stop","actionContexts","findActionId","startTime","allIds","findAll","length","undefined","findAllActionId","notify","click","tryAppend","rageClick","clone","createClickChain","clicks","finalizeClicks","computeClickActionBase","actionNameAttribute","waitPageActivityEnd","pageActivityEndEvent","hadActivity","PAGE_ACTIVITY_VALIDATION_DELAY","newClick","_waitPageActivityEnd","end","startClocks","timeStamp","discard","stopWaitPageActivityEnd","viewEndedSubscription","endClocks","stopSubscription","unsubscribe","event","rect","target","getBoundingClientRect","type","ActionType","CLICK","width","Math","round","height","selector","getSelectorFromElement","position","x","clientX","left","y","clientY","top","name","getActionNameFromElement","ClickStatus","ONGOING","STOPPED","FINALIZED","id","UUID","clocksNow","historyEntry","add","relative","eventCountsSubscription","trackEventCounts","isChildEvent","action","isArray","ids","includes","status","activityEndTime","frustrationTypes","newActivityEndTime","close","getRelativeTime","remove","hasError","eventCounts","errorCount","hasPageActivity","addFrustration","frustrationType","push","isStopped","validate","domEvents","_eventCountsSubscription","resourceCount","longTaskCount","clickAction","assign","duration","elapsed","counts","events","isNullUndefinedDefaultValue","AUTO_ACTION_COMPLETED","_computeFrustration","computeFrustration","isRage","each","timeStampNow","map"],"sources":["../../../../src/domain/rumEventsCollection/actions/trackClickActions.js"],"sourcesContent":["import {\n  timeStampNow,\n  Observable,\n  assign,\n  getRelativeTime,\n  ONE_MINUTE,\n  ContextHistory,\n  UUID,\n  clocksNow,\n  ONE_SECOND,\n  elapsed,\n  each,\n  map,\n  LifeCycleEventType,\n  ActionType,\n  isNullUndefinedDefaultValue,\n  isArray,\n  includes\n} from '@cloudcare/browser-core'\nimport { trackEventCounts } from '../../trackEventCounts'\nimport {\n  waitPageActivityEnd,\n  PAGE_ACTIVITY_VALIDATION_DELAY\n} from '../../waitPageActivityEnd'\nimport { createClickChain } from './clickChain'\nimport { getActionNameFromElement } from './getActionNameFromElement'\nimport { getSelectorFromElement } from './getSelectorsFromElement'\n// import { getSelectorsFromElement } from './getSelectorsFromElement'\nimport { listenActionEvents } from './listenActionEvents'\nimport { computeFrustration } from './computeFrustration'\n\n// Maximum duration for click actions\nexport var CLICK_ACTION_MAX_DURATION = 10 * ONE_SECOND\nexport var ACTION_CONTEXT_TIME_OUT_DELAY = 5 * ONE_MINUTE // arbitrary\n\nexport function trackClickActions(\n  lifeCycle,\n  domMutationObservable,\n  configuration\n) {\n  var history = new ContextHistory(ACTION_CONTEXT_TIME_OUT_DELAY)\n  var stopObservable = new Observable()\n  var currentClickChain\n\n  lifeCycle.subscribe(LifeCycleEventType.SESSION_RENEWED, function () {\n    history.reset()\n  })\n  lifeCycle.subscribe(LifeCycleEventType.VIEW_ENDED, stopClickChain)\n  var _listenActionEvents = listenActionEvents({\n    onPointerDown: function (pointerDownEvent) {\n      return processPointerDown(\n        configuration,\n        lifeCycle,\n        domMutationObservable,\n        pointerDownEvent\n      )\n    },\n    onPointerUp: function (data, startEvent, getUserActivity) {\n      startClickAction(\n        configuration,\n        lifeCycle,\n        domMutationObservable,\n        history,\n        stopObservable,\n        appendClickToClickChain,\n        data.clickActionBase,\n        startEvent,\n        getUserActivity,\n        data.hadActivityOnPointerDown\n      )\n    }\n  })\n  var stopActionEventsListener = _listenActionEvents.stop\n  var actionContexts = {\n    findActionId: function (startTime) {\n      const allIds = history.findAll(startTime)\n      if (allIds && allIds.length) {\n        return allIds[allIds.length - 1]\n      }\n      return undefined\n    },\n    findAllActionId: function (startTime) {\n      return history.findAll(startTime)\n    }\n  }\n\n  return {\n    stop: function () {\n      stopClickChain()\n      stopObservable.notify()\n      stopActionEventsListener()\n    },\n    actionContexts: actionContexts\n  }\n\n  function stopClickChain() {\n    if (currentClickChain) {\n      currentClickChain.stop()\n    }\n  }\n  function appendClickToClickChain(click) {\n    if (!currentClickChain || !currentClickChain.tryAppend(click)) {\n      var rageClick = click.clone()\n      currentClickChain = createClickChain(click, function (clicks) {\n        finalizeClicks(clicks, rageClick)\n      })\n    }\n  }\n}\nfunction processPointerDown(\n  configuration,\n  lifeCycle,\n  domMutationObservable,\n  pointerDownEvent\n) {\n  var clickActionBase = computeClickActionBase(\n    pointerDownEvent,\n    configuration.actionNameAttribute\n  )\n\n  var hadActivityOnPointerDown = false\n\n  waitPageActivityEnd(\n    lifeCycle,\n    domMutationObservable,\n    configuration,\n    function (pageActivityEndEvent) {\n      hadActivityOnPointerDown = pageActivityEndEvent.hadActivity\n    },\n    PAGE_ACTIVITY_VALIDATION_DELAY\n  )\n\n  return {\n    clickActionBase: clickActionBase,\n    hadActivityOnPointerDown: function () {\n      return hadActivityOnPointerDown\n    }\n  }\n}\nfunction startClickAction(\n  configuration,\n  lifeCycle,\n  domMutationObservable,\n  history,\n  stopObservable,\n  appendClickToClickChain,\n  clickActionBase,\n  startEvent,\n  getUserActivity,\n  hadActivityOnPointerDown\n) {\n  var click = newClick(\n    lifeCycle,\n    history,\n    getUserActivity,\n    clickActionBase,\n    startEvent\n  )\n  appendClickToClickChain(click)\n  var _waitPageActivityEnd = waitPageActivityEnd(\n    lifeCycle,\n    domMutationObservable,\n    configuration,\n    function (pageActivityEndEvent) {\n      if (\n        pageActivityEndEvent.hadActivity &&\n        pageActivityEndEvent.end < click.startClocks.timeStamp\n      ) {\n        // If the clock is looking weird, just discard the click\n        click.discard()\n      } else {\n        if (pageActivityEndEvent.hadActivity) {\n          click.stop(pageActivityEndEvent.end)\n        } else if (hadActivityOnPointerDown()) {\n          click.stop(\n            // using the click start as activity end, so the click will have some activity but its\n            // duration will be 0 (as the activity started before the click start)\n            click.startClocks.timeStamp\n          )\n        } else {\n          click.stop()\n        }\n      }\n    },\n    CLICK_ACTION_MAX_DURATION\n  )\n  var stopWaitPageActivityEnd = _waitPageActivityEnd.stop\n  var viewEndedSubscription = lifeCycle.subscribe(\n    LifeCycleEventType.VIEW_ENDED,\n    function (data) {\n      click.stop(data.endClocks.timeStamp)\n    }\n  )\n\n  var stopSubscription = stopObservable.subscribe(function () {\n    click.stop()\n  })\n\n  click.stopObservable.subscribe(function () {\n    viewEndedSubscription.unsubscribe()\n    stopWaitPageActivityEnd()\n    stopSubscription.unsubscribe()\n  })\n}\n\nfunction computeClickActionBase(event, actionNameAttribute) {\n  var rect = event.target.getBoundingClientRect()\n  return {\n    type: ActionType.CLICK,\n    target: {\n      width: Math.round(rect.width),\n      height: Math.round(rect.height),\n      selector: getSelectorFromElement(event.target, actionNameAttribute)\n    },\n    position: {\n      x: Math.round(event.clientX - rect.left),\n      y: Math.round(event.clientY - rect.top)\n    },\n    name: getActionNameFromElement(event.target, actionNameAttribute)\n  }\n}\n\nvar ClickStatus = {\n  // Initial state, the click is still ongoing.\n  ONGOING: 0,\n  // The click is no more ongoing but still needs to be validated or discarded.\n  STOPPED: 1,\n  // Final state, the click has been stopped and validated or discarded.\n  FINALIZED: 2\n}\n\nfunction newClick(\n  lifeCycle,\n  history,\n  getUserActivity,\n  clickActionBase,\n  startEvent\n) {\n  var id = UUID()\n  var startClocks = clocksNow()\n  var historyEntry = history.add(id, startClocks.relative)\n  var eventCountsSubscription = trackEventCounts({\n    lifeCycle: lifeCycle,\n    isChildEvent: function (event) {\n      return (\n        event.action !== undefined &&\n        (isArray(event.action.ids)\n          ? includes(event.action.ids, id)\n          : event.action.ids === id)\n      )\n    }\n  })\n  var status = ClickStatus.ONGOING\n  var activityEndTime\n  var frustrationTypes = []\n  var stopObservable = new Observable()\n\n  function stop(newActivityEndTime) {\n    if (status !== ClickStatus.ONGOING) {\n      return\n    }\n    activityEndTime = newActivityEndTime\n    status = ClickStatus.STOPPED\n    if (activityEndTime) {\n      historyEntry.close(getRelativeTime(activityEndTime))\n    } else {\n      historyEntry.remove()\n    }\n    eventCountsSubscription.stop()\n    stopObservable.notify()\n  }\n\n  return {\n    event: startEvent,\n    stop: stop,\n    stopObservable: stopObservable,\n    hasError: function () {\n      return eventCountsSubscription.eventCounts.errorCount > 0\n    },\n    hasPageActivity: function () {\n      return activityEndTime !== undefined\n    },\n    getUserActivity: getUserActivity,\n    addFrustration: function (frustrationType) {\n      frustrationTypes.push(frustrationType)\n    },\n    startClocks: startClocks,\n    isStopped: function () {\n      return status === ClickStatus.STOPPED || status === ClickStatus.FINALIZED\n    },\n\n    clone: function () {\n      return newClick(\n        lifeCycle,\n        history,\n        getUserActivity,\n        clickActionBase,\n        startEvent\n      )\n    },\n\n    validate: function (domEvents) {\n      stop()\n      if (status !== ClickStatus.STOPPED) {\n        return\n      }\n      var _eventCountsSubscription = eventCountsSubscription.eventCounts\n      var resourceCount = _eventCountsSubscription.resourceCount\n      var errorCount = _eventCountsSubscription.errorCount\n      var longTaskCount = _eventCountsSubscription.longTaskCount\n      var clickAction = assign(\n        {\n          type: ActionType.CLICK,\n          duration:\n            activityEndTime && elapsed(startClocks.timeStamp, activityEndTime),\n          startClocks: startClocks,\n          id: id,\n          frustrationTypes: frustrationTypes,\n          counts: {\n            resourceCount: resourceCount,\n            errorCount: errorCount,\n            longTaskCount: longTaskCount\n          },\n          events: isNullUndefinedDefaultValue(domEvents, [startEvent]),\n          event: startEvent\n        },\n        clickActionBase\n      )\n      lifeCycle.notify(LifeCycleEventType.AUTO_ACTION_COMPLETED, clickAction)\n      status = ClickStatus.FINALIZED\n    },\n\n    discard: function () {\n      stop()\n      status = ClickStatus.FINALIZED\n    }\n  }\n}\n\nexport function finalizeClicks(clicks, rageClick) {\n  var _computeFrustration = computeFrustration(clicks, rageClick)\n  var isRage = _computeFrustration.isRage\n  if (isRage) {\n    each(clicks, function (click) {\n      click.discard()\n    })\n    rageClick.stop(timeStampNow())\n    rageClick.validate(\n      map(clicks, function (click) {\n        return click.event\n      })\n    )\n  } else {\n    rageClick.discard()\n    each(clicks, function (click) {\n      click.validate()\n    })\n  }\n}\n"],"mappings":"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","ignoreList":[]}