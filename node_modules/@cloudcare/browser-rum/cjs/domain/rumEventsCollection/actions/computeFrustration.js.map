{"version":3,"file":"computeFrustration.js","names":["_browserCore","require","MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE","computeFrustration","clicks","rageClick","isRage","addFrustration","FrustrationType","RAGE_CLICK","some","isDead","DEAD_CLICK","hasError","ERROR_CLICK","hasSelectionChanged","click","getUserActivity","selection","each","scroll","i","length","event","timeStamp","ONE_SECOND","DEAD_CLICK_EXCLUDE_SELECTOR","hasPageActivity","input","elementMatches","target"],"sources":["../../../../src/domain/rumEventsCollection/actions/computeFrustration.js"],"sourcesContent":["import {\n  elementMatches,\n  ONE_SECOND,\n  FrustrationType,\n  some,\n  each\n} from '@cloudcare/browser-core'\n\nvar MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE = 3\n\nexport function computeFrustration(clicks, rageClick) {\n  if (isRage(clicks)) {\n    rageClick.addFrustration(FrustrationType.RAGE_CLICK)\n    if (some(clicks, isDead)) {\n      rageClick.addFrustration(FrustrationType.DEAD_CLICK)\n    }\n    if (rageClick.hasError()) {\n      rageClick.addFrustration(FrustrationType.ERROR_CLICK)\n    }\n    return { isRage: true }\n  }\n\n  var hasSelectionChanged = some(clicks, function (click) {\n    return click.getUserActivity().selection\n  })\n  each(clicks, function (click) {\n    if (click.hasError()) {\n      click.addFrustration(FrustrationType.ERROR_CLICK)\n    }\n    if (\n      isDead(click) &&\n      // Avoid considering clicks part of a double-click or triple-click selections as dead clicks\n      !hasSelectionChanged\n    ) {\n      click.addFrustration(FrustrationType.DEAD_CLICK)\n    }\n  })\n\n  return { isRage: false }\n}\n\nexport function isRage(clicks) {\n  if (\n    some(clicks, function (click) {\n      return click.getUserActivity().selection || click.getUserActivity().scroll\n    })\n  ) {\n    return false\n  }\n  for (\n    var i = 0;\n    i < clicks.length - (MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE - 1);\n    i += 1\n  ) {\n    if (\n      clicks[i + MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE - 1].event.timeStamp -\n        clicks[i].event.timeStamp <=\n      ONE_SECOND\n    ) {\n      return true\n    }\n  }\n  return false\n}\n\nvar DEAD_CLICK_EXCLUDE_SELECTOR =\n  // inputs that don't trigger a meaningful event like \"input\" when clicked, including textual\n  // inputs (using a negative selector is shorter here)\n  'input:not([type=\"checkbox\"]):not([type=\"radio\"]):not([type=\"button\"]):not([type=\"submit\"]):not([type=\"reset\"]):not([type=\"range\"]),' +\n  'textarea,' +\n  'select,' +\n  // contenteditable and their descendants don't always trigger meaningful changes when manipulated\n  '[contenteditable],' +\n  '[contenteditable] *,' +\n  // canvas, as there is no good way to detect activity occurring on them\n  'canvas,' +\n  // links that are interactive (have an href attribute) or any of their descendants, as they can\n  // open a new tab or navigate to a hash without triggering a meaningful event\n  'a[href],' +\n  'a[href] *'\n\nexport function isDead(click) {\n  if (\n    click.hasPageActivity() ||\n    click.getUserActivity().input ||\n    click.getUserActivity().scroll\n  ) {\n    return false\n  }\n  return !elementMatches(click.event.target, DEAD_CLICK_EXCLUDE_SELECTOR)\n}\n"],"mappings":";;;;;;;;AAAA,IAAAA,YAAA,GAAAC,OAAA;AAQA,IAAIC,sCAAsC,GAAG,CAAC;AAEvC,SAASC,kBAAkBA,CAACC,MAAM,EAAEC,SAAS,EAAE;EACpD,IAAIC,MAAM,CAACF,MAAM,CAAC,EAAE;IAClBC,SAAS,CAACE,cAAc,CAACC,4BAAe,CAACC,UAAU,CAAC;IACpD,IAAI,IAAAC,iBAAI,EAACN,MAAM,EAAEO,MAAM,CAAC,EAAE;MACxBN,SAAS,CAACE,cAAc,CAACC,4BAAe,CAACI,UAAU,CAAC;IACtD;IACA,IAAIP,SAAS,CAACQ,QAAQ,CAAC,CAAC,EAAE;MACxBR,SAAS,CAACE,cAAc,CAACC,4BAAe,CAACM,WAAW,CAAC;IACvD;IACA,OAAO;MAAER,MAAM,EAAE;IAAK,CAAC;EACzB;EAEA,IAAIS,mBAAmB,GAAG,IAAAL,iBAAI,EAACN,MAAM,EAAE,UAAUY,KAAK,EAAE;IACtD,OAAOA,KAAK,CAACC,eAAe,CAAC,CAAC,CAACC,SAAS;EAC1C,CAAC,CAAC;EACF,IAAAC,iBAAI,EAACf,MAAM,EAAE,UAAUY,KAAK,EAAE;IAC5B,IAAIA,KAAK,CAACH,QAAQ,CAAC,CAAC,EAAE;MACpBG,KAAK,CAACT,cAAc,CAACC,4BAAe,CAACM,WAAW,CAAC;IACnD;IACA,IACEH,MAAM,CAACK,KAAK,CAAC;IACb;IACA,CAACD,mBAAmB,EACpB;MACAC,KAAK,CAACT,cAAc,CAACC,4BAAe,CAACI,UAAU,CAAC;IAClD;EACF,CAAC,CAAC;EAEF,OAAO;IAAEN,MAAM,EAAE;EAAM,CAAC;AAC1B;AAEO,SAASA,MAAMA,CAACF,MAAM,EAAE;EAC7B,IACE,IAAAM,iBAAI,EAACN,MAAM,EAAE,UAAUY,KAAK,EAAE;IAC5B,OAAOA,KAAK,CAACC,eAAe,CAAC,CAAC,CAACC,SAAS,IAAIF,KAAK,CAACC,eAAe,CAAC,CAAC,CAACG,MAAM;EAC5E,CAAC,CAAC,EACF;IACA,OAAO,KAAK;EACd;EACA,KACE,IAAIC,CAAC,GAAG,CAAC,EACTA,CAAC,GAAGjB,MAAM,CAACkB,MAAM,IAAIpB,sCAAsC,GAAG,CAAC,CAAC,EAChEmB,CAAC,IAAI,CAAC,EACN;IACA,IACEjB,MAAM,CAACiB,CAAC,GAAGnB,sCAAsC,GAAG,CAAC,CAAC,CAACqB,KAAK,CAACC,SAAS,GACpEpB,MAAM,CAACiB,CAAC,CAAC,CAACE,KAAK,CAACC,SAAS,IAC3BC,uBAAU,EACV;MACA,OAAO,IAAI;IACb;EACF;EACA,OAAO,KAAK;AACd;AAEA,IAAIC,2BAA2B;AAC7B;AACA;AACA,qIAAqI,GACrI,WAAW,GACX,SAAS;AACT;AACA,oBAAoB,GACpB,sBAAsB;AACtB;AACA,SAAS;AACT;AACA;AACA,UAAU,GACV,WAAW;AAEN,SAASf,MAAMA,CAACK,KAAK,EAAE;EAC5B,IACEA,KAAK,CAACW,eAAe,CAAC,CAAC,IACvBX,KAAK,CAACC,eAAe,CAAC,CAAC,CAACW,KAAK,IAC7BZ,KAAK,CAACC,eAAe,CAAC,CAAC,CAACG,MAAM,EAC9B;IACA,OAAO,KAAK;EACd;EACA,OAAO,CAAC,IAAAS,2BAAc,EAACb,KAAK,CAACO,KAAK,CAACO,MAAM,EAAEJ,2BAA2B,CAAC;AACzE","ignoreList":[]}