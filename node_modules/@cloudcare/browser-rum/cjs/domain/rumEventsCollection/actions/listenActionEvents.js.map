{"version":3,"file":"listenActionEvents.js","names":["_browserCore","require","listenActionEvents","events","selectionEmptyAtPointerDown","userActivity","selection","input","scroll","clickContext","listeners","addEventListener","window","DOM_EVENT","POINTER_DOWN","event","isValidPointerEvent","isSelectionEmpty","onPointerDown","capture","SELECTION_CHANGE","POINTER_UP","localUserActivity","onPointerUp","undefined","SCROLL","passive","INPUT","stop","each","listener","getSelection","isCollapsed","target","Element","isPrimary"],"sources":["../../../../src/domain/rumEventsCollection/actions/listenActionEvents.js"],"sourcesContent":["import { addEventListener, DOM_EVENT, each } from '@cloudcare/browser-core'\n\nexport function listenActionEvents(events) {\n  var selectionEmptyAtPointerDown\n  var userActivity = {\n    selection: false,\n    input: false,\n    scroll: false\n  }\n  var clickContext\n  var listeners = [\n    addEventListener(\n      window,\n      DOM_EVENT.POINTER_DOWN,\n      function (event) {\n        if (isValidPointerEvent(event)) {\n          selectionEmptyAtPointerDown = isSelectionEmpty()\n          userActivity = {\n            selection: false,\n            input: false,\n            scroll: false\n          }\n          clickContext = events.onPointerDown(event)\n        }\n      },\n      { capture: true }\n    ),\n\n    addEventListener(\n      window,\n      DOM_EVENT.SELECTION_CHANGE,\n      function () {\n        if (!selectionEmptyAtPointerDown || !isSelectionEmpty()) {\n          userActivity.selection = true\n        }\n      },\n      { capture: true }\n    ),\n\n    addEventListener(\n      window,\n      DOM_EVENT.POINTER_UP,\n      function (event) {\n        if (isValidPointerEvent(event) && clickContext) {\n          // Use a scoped variable to make sure the value is not changed by other clicks\n          var localUserActivity = userActivity\n          events.onPointerUp(clickContext, event, function () {\n            return localUserActivity\n          })\n          clickContext = undefined\n        }\n      },\n      { capture: true }\n    ),\n    addEventListener(\n      window,\n      DOM_EVENT.SCROLL,\n      function () {\n        userActivity.scroll = true\n      },\n      { capture: true, passive: true }\n    ),\n    addEventListener(\n      window,\n      DOM_EVENT.INPUT,\n      function () {\n        userActivity.input = true\n      },\n      { capture: true }\n    )\n  ]\n\n  return {\n    stop: function () {\n      each(listeners, function (listener) {\n        return listener.stop()\n      })\n    }\n  }\n}\n\nfunction isSelectionEmpty() {\n  var selection = window.getSelection()\n  return !selection || selection.isCollapsed\n}\nfunction isValidPointerEvent(event) {\n  return (\n    event.target instanceof Element &&\n    // Only consider 'primary' pointer events for now. Multi-touch support could be implemented in\n    // the future.\n    event.isPrimary !== false\n  )\n}\n"],"mappings":";;;;;;AAAA,IAAAA,YAAA,GAAAC,OAAA;AAEO,SAASC,kBAAkBA,CAACC,MAAM,EAAE;EACzC,IAAIC,2BAA2B;EAC/B,IAAIC,YAAY,GAAG;IACjBC,SAAS,EAAE,KAAK;IAChBC,KAAK,EAAE,KAAK;IACZC,MAAM,EAAE;EACV,CAAC;EACD,IAAIC,YAAY;EAChB,IAAIC,SAAS,GAAG,CACd,IAAAC,6BAAgB,EACdC,MAAM,EACNC,sBAAS,CAACC,YAAY,EACtB,UAAUC,KAAK,EAAE;IACf,IAAIC,mBAAmB,CAACD,KAAK,CAAC,EAAE;MAC9BX,2BAA2B,GAAGa,gBAAgB,CAAC,CAAC;MAChDZ,YAAY,GAAG;QACbC,SAAS,EAAE,KAAK;QAChBC,KAAK,EAAE,KAAK;QACZC,MAAM,EAAE;MACV,CAAC;MACDC,YAAY,GAAGN,MAAM,CAACe,aAAa,CAACH,KAAK,CAAC;IAC5C;EACF,CAAC,EACD;IAAEI,OAAO,EAAE;EAAK,CAClB,CAAC,EAED,IAAAR,6BAAgB,EACdC,MAAM,EACNC,sBAAS,CAACO,gBAAgB,EAC1B,YAAY;IACV,IAAI,CAAChB,2BAA2B,IAAI,CAACa,gBAAgB,CAAC,CAAC,EAAE;MACvDZ,YAAY,CAACC,SAAS,GAAG,IAAI;IAC/B;EACF,CAAC,EACD;IAAEa,OAAO,EAAE;EAAK,CAClB,CAAC,EAED,IAAAR,6BAAgB,EACdC,MAAM,EACNC,sBAAS,CAACQ,UAAU,EACpB,UAAUN,KAAK,EAAE;IACf,IAAIC,mBAAmB,CAACD,KAAK,CAAC,IAAIN,YAAY,EAAE;MAC9C;MACA,IAAIa,iBAAiB,GAAGjB,YAAY;MACpCF,MAAM,CAACoB,WAAW,CAACd,YAAY,EAAEM,KAAK,EAAE,YAAY;QAClD,OAAOO,iBAAiB;MAC1B,CAAC,CAAC;MACFb,YAAY,GAAGe,SAAS;IAC1B;EACF,CAAC,EACD;IAAEL,OAAO,EAAE;EAAK,CAClB,CAAC,EACD,IAAAR,6BAAgB,EACdC,MAAM,EACNC,sBAAS,CAACY,MAAM,EAChB,YAAY;IACVpB,YAAY,CAACG,MAAM,GAAG,IAAI;EAC5B,CAAC,EACD;IAAEW,OAAO,EAAE,IAAI;IAAEO,OAAO,EAAE;EAAK,CACjC,CAAC,EACD,IAAAf,6BAAgB,EACdC,MAAM,EACNC,sBAAS,CAACc,KAAK,EACf,YAAY;IACVtB,YAAY,CAACE,KAAK,GAAG,IAAI;EAC3B,CAAC,EACD;IAAEY,OAAO,EAAE;EAAK,CAClB,CAAC,CACF;EAED,OAAO;IACLS,IAAI,EAAE,SAAAA,KAAA,EAAY;MAChB,IAAAC,iBAAI,EAACnB,SAAS,EAAE,UAAUoB,QAAQ,EAAE;QAClC,OAAOA,QAAQ,CAACF,IAAI,CAAC,CAAC;MACxB,CAAC,CAAC;IACJ;EACF,CAAC;AACH;AAEA,SAASX,gBAAgBA,CAAA,EAAG;EAC1B,IAAIX,SAAS,GAAGM,MAAM,CAACmB,YAAY,CAAC,CAAC;EACrC,OAAO,CAACzB,SAAS,IAAIA,SAAS,CAAC0B,WAAW;AAC5C;AACA,SAAShB,mBAAmBA,CAACD,KAAK,EAAE;EAClC,OACEA,KAAK,CAACkB,MAAM,YAAYC,OAAO;EAC/B;EACA;EACAnB,KAAK,CAACoB,SAAS,KAAK,KAAK;AAE7B","ignoreList":[]}