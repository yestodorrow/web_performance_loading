{"version":3,"file":"errorCollection.js","names":["_browserCore","require","_trackConsoleError","_trackReportError","startErrorCollection","lifeCycle","configuration","pageStateHistory","errorObservable","Observable","trackConsoleError","trackRuntimeError","trackReportError","subscribe","error","notify","LifeCycleEventType","RAW_ERROR_COLLECTED","doStartErrorCollection","RAW_RUM_EVENT_COLLECTED","assign","customerContext","savedCommonContext","processError","addError","providedError","stackTrace","Error","computeStackTrace","undefined","rawError","computeRawError","originalError","handlingStack","startClocks","nonErrorPrefix","NonErrorPrefix","PROVIDED","source","ErrorSource","CUSTOM","handling","ErrorHandling","HANDLED","context","rawRumEvent","date","timeStamp","id","UUID","message","stack","handling_stack","type","causes","source_type","RumEventType","ERROR","view","in_foreground","isInActivePageStateAt","relative","startTime","domainContext"],"sources":["../../../../src/domain/rumEventsCollection/error/errorCollection.js"],"sourcesContent":["import {\n  assign,\n  computeStackTrace,\n  computeRawError,\n  ErrorSource,\n  UUID,\n  ErrorHandling,\n  Observable,\n  trackRuntimeError,\n  RumEventType,\n  LifeCycleEventType,\n  NonErrorPrefix\n} from '@cloudcare/browser-core'\nimport { trackConsoleError } from './trackConsoleError'\nimport { trackReportError } from './trackReportError'\n\nexport function startErrorCollection(\n  lifeCycle,\n  configuration,\n  pageStateHistory\n) {\n  var errorObservable = new Observable()\n\n  trackConsoleError(errorObservable)\n  trackRuntimeError(errorObservable)\n  trackReportError(configuration, errorObservable)\n\n  errorObservable.subscribe(function (error) {\n    lifeCycle.notify(LifeCycleEventType.RAW_ERROR_COLLECTED, { error: error })\n  })\n\n  return doStartErrorCollection(lifeCycle, pageStateHistory)\n}\n\nexport function doStartErrorCollection(lifeCycle, pageStateHistory) {\n  lifeCycle.subscribe(LifeCycleEventType.RAW_ERROR_COLLECTED, function (error) {\n    lifeCycle.notify(\n      LifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n      assign(\n        {\n          customerContext: error.customerContext,\n          savedCommonContext: error.savedCommonContext\n        },\n        processError(error.error, pageStateHistory)\n      )\n    )\n  })\n\n  return {\n    addError: function (providedError, savedCommonContext) {\n      var error = providedError.error\n      var stackTrace =\n        error instanceof Error ? computeStackTrace(error) : undefined\n      var rawError = computeRawError({\n        stackTrace,\n        originalError: error,\n        handlingStack: providedError.handlingStack,\n        startClocks: providedError.startClocks,\n        nonErrorPrefix: NonErrorPrefix.PROVIDED,\n        source: ErrorSource.CUSTOM,\n        handling: ErrorHandling.HANDLED\n      })\n      lifeCycle.notify(LifeCycleEventType.RAW_ERROR_COLLECTED, {\n        customerContext: providedError.context,\n        savedCommonContext: savedCommonContext,\n        error: rawError\n      })\n    }\n  }\n}\n\nfunction processError(error, pageStateHistory) {\n  var rawRumEvent = {\n    date: error.startClocks.timeStamp,\n    error: {\n      id: UUID(),\n      message: error.message,\n      source: error.source,\n      stack: error.stack,\n      handling_stack: error.handlingStack,\n      type: error.type,\n      handling: error.handling,\n      causes: error.causes,\n      source_type: 'browser'\n    },\n    type: RumEventType.ERROR,\n    view: {\n      in_foreground: pageStateHistory.isInActivePageStateAt(\n        error.startClocks.relative\n      )\n    }\n  }\n\n  return {\n    rawRumEvent: rawRumEvent,\n    startTime: error.startClocks.relative,\n    domainContext: {\n      error: error.originalError\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}