{"version":3,"file":"trackViews.js","names":["_browserCore","require","_trackInitialViewTimings2","_trackCommonViewMetrics2","_trackViewEventCounts2","THROTTLE_VIEW_UPDATE_PERIOD","exports","SESSION_KEEP_ALIVE_INTERVAL","ONE_MINUTE","KEEP_TRACKING_AFTER_VIEW_DELAY","trackViews","location","lifeCycle","domMutationObservable","configuration","locationChangeObservable","areViewsTrackedAutomatically","initialViewOptions","activeViews","Set","startNewView","loadingType","startClocks","viewOptions","newlyCreatedView","newView","add","stopObservable","subscribe","currentView","ViewLoadingType","INITIAL_LOAD","clocksOrigin","startViewLifeCycle","locationChangeSubscription","renewViewOnLocationChange","LifeCycleEventType","SESSION_RENEWED","ROUTE_CHANGE","undefined","name","service","version","SESSION_EXPIRED","end","sessionIsActive","PAGE_EXITED","pageExitEvent","reason","PageExitReason","UNLOADING","PAGEHIDE","params","oldLocation","newLocation","areDifferentLocation","addTiming","time","timeStampNow","startView","options","endClocks","stop","unsubscribe","forEach","view","initialLocation","clocksNow","id","UUID","Observable","customTimings","documentVersion","shallowClone","viewCreatedEvent","notify","BEFORE_VIEW_CREATED","VIEW_CREATED","_scheduleViewUpdate","throttle","triggerViewUpdate","leading","scheduleViewUpdate","throttled","cancelScheduleViewUpdate","cancel","_trackCommonViewMetrics","trackCommonViewMetrics","setLoadEvent","stopCommonViewMetricsTracking","getCommonViewMetrics","stopINPTracking","setViewEnd","_trackInitialViewTimings","trackInitialViewMetrics","noop","initialViewMetrics","stopInitialViewMetricsTracking","_trackViewEventCounts","trackViewEventCounts","stopEventCountsTracking","scheduleStop","eventCounts","keepAliveIntervalId","setInterval","currentEnd","timeStamp","VIEW_UPDATED","commonViewMetrics","duration","elapsed","isActive","result","isNullUndefinedDefaultValue","VIEW_ENDED","AFTER_VIEW_ENDED","clearInterval","relative","setTimeout","relativeTime","looksLikeRelativeTime","sanitizeTiming","sanitized","replace","console","warn","currentLocation","otherLocation","pathname","isHashAnAnchor","hash","getPathFromHash"],"sources":["../../../../src/domain/rumEventsCollection/view/trackViews.js"],"sourcesContent":["import {\n  shallowClone,\n  elapsed,\n  UUID,\n  ONE_MINUTE,\n  throttle,\n  clocksNow,\n  clocksOrigin,\n  timeStampNow,\n  looksLikeRelativeTime,\n  ViewLoadingType,\n  LifeCycleEventType,\n  PageExitReason,\n  isHashAnAnchor,\n  getPathFromHash,\n  noop,\n  setInterval,\n  Observable,\n  clearInterval,\n  setTimeout,\n  isNullUndefinedDefaultValue\n} from '@cloudcare/browser-core'\n\nimport { trackInitialViewMetrics } from './trackInitialViewTimings'\nimport { trackCommonViewMetrics } from './trackCommonViewMetrics'\nimport { trackViewEventCounts } from './trackViewEventCounts'\nexport var THROTTLE_VIEW_UPDATE_PERIOD = 3000\nexport var SESSION_KEEP_ALIVE_INTERVAL = 5 * ONE_MINUTE\nexport var KEEP_TRACKING_AFTER_VIEW_DELAY = 5 * ONE_MINUTE\nexport function trackViews(\n  location,\n  lifeCycle,\n  domMutationObservable,\n  configuration,\n  locationChangeObservable,\n  areViewsTrackedAutomatically,\n  initialViewOptions\n) {\n  var activeViews = new Set()\n  function startNewView(loadingType, startClocks, viewOptions) {\n    var newlyCreatedView = newView(\n      lifeCycle,\n      domMutationObservable,\n      configuration,\n      location,\n      loadingType,\n      startClocks,\n      viewOptions\n    )\n    activeViews.add(newlyCreatedView)\n    newlyCreatedView.stopObservable.subscribe(function () {\n      activeViews.delete(newlyCreatedView)\n    })\n    return newlyCreatedView\n  }\n  var currentView = startNewView(\n    ViewLoadingType.INITIAL_LOAD,\n    clocksOrigin(),\n    initialViewOptions\n  )\n  startViewLifeCycle()\n  var locationChangeSubscription\n  if (areViewsTrackedAutomatically) {\n    locationChangeSubscription = renewViewOnLocationChange(\n      locationChangeObservable\n    )\n  }\n  function startViewLifeCycle() {\n    lifeCycle.subscribe(LifeCycleEventType.SESSION_RENEWED, function () {\n      currentView = startNewView(ViewLoadingType.ROUTE_CHANGE, undefined, {\n        name: currentView.name,\n        service: currentView.service,\n        version: currentView.version\n      })\n    })\n\n    lifeCycle.subscribe(LifeCycleEventType.SESSION_EXPIRED, function () {\n      currentView.end({ sessionIsActive: false })\n    })\n    // End the current view on page unload\n    lifeCycle.subscribe(\n      LifeCycleEventType.PAGE_EXITED,\n      function (pageExitEvent) {\n        if (\n          pageExitEvent.reason === PageExitReason.UNLOADING ||\n          pageExitEvent.reason === PageExitReason.PAGEHIDE\n        ) {\n          currentView.end()\n        }\n      }\n    )\n  }\n\n  function renewViewOnLocationChange(locationChangeObservable) {\n    return locationChangeObservable.subscribe(function (params) {\n      var oldLocation = params.oldLocation\n      var newLocation = params.newLocation\n      if (areDifferentLocation(oldLocation, newLocation)) {\n        currentView.end()\n        currentView = startNewView(ViewLoadingType.ROUTE_CHANGE)\n        return\n      }\n    })\n  }\n\n  return {\n    addTiming: function (name, time) {\n      if (typeof time === 'undefined') {\n        time = timeStampNow()\n      }\n      currentView.addTiming(name, time)\n    },\n    startView: function (options, startClocks) {\n      currentView.end({ endClocks: startClocks })\n      currentView = startNewView(\n        ViewLoadingType.ROUTE_CHANGE,\n        startClocks,\n        options\n      )\n    },\n    stop: function () {\n      if (locationChangeSubscription) {\n        locationChangeSubscription.unsubscribe()\n      }\n      currentView.end()\n      activeViews.forEach(function (view) {\n        view.stop()\n      })\n    }\n  }\n}\n\nfunction newView(\n  lifeCycle,\n  domMutationObservable,\n  configuration,\n  initialLocation,\n  loadingType,\n  startClocks,\n  viewOptions\n) {\n  // Setup initial values\n  if (typeof startClocks === 'undefined') {\n    startClocks = clocksNow()\n  }\n  var id = UUID()\n  var stopObservable = new Observable()\n  var customTimings = {}\n  var documentVersion = 0\n  var endClocks\n  var location = shallowClone(initialLocation)\n\n  var sessionIsActive = true\n  var name\n  var service\n  var version\n  if (viewOptions) {\n    name = viewOptions.name\n    service = viewOptions.service\n    version = viewOptions.version\n  }\n  var viewCreatedEvent = {\n    id: id,\n    name: name,\n    startClocks: startClocks,\n    service: service,\n    version: version\n  }\n  lifeCycle.notify(LifeCycleEventType.BEFORE_VIEW_CREATED, viewCreatedEvent)\n  lifeCycle.notify(LifeCycleEventType.VIEW_CREATED, viewCreatedEvent)\n\n  // Update the view every time the measures are changing\n  var _scheduleViewUpdate = throttle(\n    triggerViewUpdate,\n    THROTTLE_VIEW_UPDATE_PERIOD,\n    {\n      leading: false\n    }\n  )\n  var scheduleViewUpdate = _scheduleViewUpdate.throttled\n  var cancelScheduleViewUpdate = _scheduleViewUpdate.cancel\n\n  var _trackCommonViewMetrics = trackCommonViewMetrics(\n    lifeCycle,\n    domMutationObservable,\n    configuration,\n    scheduleViewUpdate,\n    loadingType,\n    startClocks\n  )\n  var setLoadEvent = _trackCommonViewMetrics.setLoadEvent\n  var stopCommonViewMetricsTracking = _trackCommonViewMetrics.stop\n  var getCommonViewMetrics = _trackCommonViewMetrics.getCommonViewMetrics\n  var stopINPTracking = _trackCommonViewMetrics.stopINPTracking\n  var setViewEnd = _trackCommonViewMetrics.setViewEnd\n  var _trackInitialViewTimings =\n    loadingType === ViewLoadingType.INITIAL_LOAD\n      ? trackInitialViewMetrics(\n          lifeCycle,\n          configuration,\n          setLoadEvent,\n          scheduleViewUpdate\n        )\n      : {\n          stop: noop,\n          initialViewMetrics: {}\n        }\n  var stopInitialViewMetricsTracking = _trackInitialViewTimings.stop\n  var initialViewMetrics = _trackInitialViewTimings.initialViewMetrics\n  var _trackViewEventCounts = trackViewEventCounts(\n    lifeCycle,\n    id,\n    scheduleViewUpdate\n  )\n  var stopEventCountsTracking = _trackViewEventCounts.scheduleStop\n  var eventCounts = _trackViewEventCounts.eventCounts\n\n  // Session keep alive\n  var keepAliveIntervalId = setInterval(\n    triggerViewUpdate,\n    SESSION_KEEP_ALIVE_INTERVAL\n  )\n  triggerViewUpdate()\n\n  function triggerViewUpdate() {\n    cancelScheduleViewUpdate()\n\n    documentVersion += 1\n    var currentEnd =\n      endClocks === undefined ? timeStampNow() : endClocks.timeStamp\n    lifeCycle.notify(LifeCycleEventType.VIEW_UPDATED, {\n      customTimings: customTimings,\n      documentVersion: documentVersion,\n      id: id,\n      name: name,\n      service: service,\n      version: version,\n      loadingType: loadingType,\n      location: location,\n      startClocks: startClocks,\n      commonViewMetrics: getCommonViewMetrics(),\n      initialViewMetrics: initialViewMetrics,\n      duration: elapsed(startClocks.timeStamp, currentEnd),\n      isActive: endClocks === undefined,\n      sessionIsActive: sessionIsActive,\n      eventCounts: eventCounts\n    })\n  }\n  var result = {\n    name: name,\n    service: service,\n    version: version,\n    stopObservable: stopObservable,\n    end: function (options) {\n      if (endClocks) {\n        // view already ended\n        return\n      }\n      endClocks = isNullUndefinedDefaultValue(\n        options && options.endClocks,\n        clocksNow()\n      )\n      sessionIsActive = isNullUndefinedDefaultValue(\n        options && options.sessionIsActive,\n        true\n      )\n      lifeCycle.notify(LifeCycleEventType.VIEW_ENDED, { endClocks: endClocks })\n      lifeCycle.notify(LifeCycleEventType.AFTER_VIEW_ENDED, {\n        endClocks: endClocks\n      })\n      clearInterval(keepAliveIntervalId)\n      setViewEnd(endClocks.relative)\n      stopCommonViewMetricsTracking()\n      triggerViewUpdate()\n      setTimeout(function () {\n        result.stop()\n      }, KEEP_TRACKING_AFTER_VIEW_DELAY)\n    },\n    stop: function () {\n      stopInitialViewMetricsTracking()\n      stopEventCountsTracking()\n      stopINPTracking()\n      stopObservable.notify()\n    },\n    addTiming: function (name, time) {\n      if (endClocks) {\n        return\n      }\n      var relativeTime = looksLikeRelativeTime(time)\n        ? time\n        : elapsed(startClocks.timeStamp, time)\n      customTimings[sanitizeTiming(name)] = relativeTime\n      scheduleViewUpdate()\n    }\n  }\n  return result\n}\n\n/**\n * Timing name is used as facet path that must contain only letters, digits, or the characters - _ . @ $\n */\nfunction sanitizeTiming(name) {\n  var sanitized = name.replace(/[^a-zA-Z0-9-_.@$]/g, '_')\n  if (sanitized !== name) {\n    console.warn(\n      'Invalid timing name: ' + name + ', sanitized to: ' + sanitized\n    )\n  }\n  return sanitized\n}\n\nfunction areDifferentLocation(currentLocation, otherLocation) {\n  return (\n    currentLocation.pathname !== otherLocation.pathname ||\n    (!isHashAnAnchor(otherLocation.hash) &&\n      getPathFromHash(otherLocation.hash) !==\n        getPathFromHash(currentLocation.hash))\n  )\n}\n"],"mappings":"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","ignoreList":[]}