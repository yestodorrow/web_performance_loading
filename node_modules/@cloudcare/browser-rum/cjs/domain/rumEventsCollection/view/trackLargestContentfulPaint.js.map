{"version":3,"file":"trackLargestContentfulPaint.js","names":["_browserCore","require","_getSelectorsFromElement","LCP_MAXIMUM_DELAY","ONE_MINUTE","exports","trackLargestContentfulPaint","lifeCycle","configuration","firstHidden","eventTarget","callback","firstInteractionTimestamp","Infinity","_addEventListeners","addEventListeners","DOM_EVENT","POINTER_DOWN","KEY_DOWN","event","timeStamp","capture","once","stopEventListener","stop","biggestLcpSize","subscribe","LifeCycleEventType","PERFORMANCE_ENTRIES_COLLECTED","entries","lcpEntry","findLast","entry","entryType","startTime","geTimeStamp","size","lcpTargetSelector","element","getSelectorFromElement","actionNameAttribute","value","targetSelector","unsubscribeLifeCycle","unsubscribe"],"sources":["../../../../src/domain/rumEventsCollection/view/trackLargestContentfulPaint.js"],"sourcesContent":["import {\n  addEventListeners,\n  DOM_EVENT,\n  findLast,\n  LifeCycleEventType,\n  ONE_MINUTE\n} from '@cloudcare/browser-core'\nimport { getSelectorFromElement } from '../actions/getSelectorsFromElement'\n\n/**\n * Track the largest contentful paint (LCP) occurring during the initial View.  This can yield\n * multiple values, only the most recent one should be used.\n * Documentation: https://web.dev/lcp/\n * Reference implementation: https://github.com/GoogleChrome/web-vitals/blob/master/src/getLCP.ts\n */\n// It happens in some cases like sleep mode or some browser implementations\nexport var LCP_MAXIMUM_DELAY = 10 * ONE_MINUTE\nexport function trackLargestContentfulPaint(\n  lifeCycle,\n  configuration,\n  firstHidden,\n  eventTarget,\n  callback\n) {\n  // Ignore entries that come after the first user interaction.  According to the documentation, the\n  // browser should not send largest-contentful-paint entries after a user interact with the page,\n  // but the web-vitals reference implementation uses this as a safeguard.\n  var firstInteractionTimestamp = Infinity\n  var _addEventListeners = addEventListeners(\n    eventTarget,\n    [DOM_EVENT.POINTER_DOWN, DOM_EVENT.KEY_DOWN],\n    function (event) {\n      firstInteractionTimestamp = event.timeStamp\n    },\n    { capture: true, once: true }\n  )\n  var stopEventListener = _addEventListeners.stop\n  var biggestLcpSize = 0\n  var subscribe = lifeCycle.subscribe(\n    LifeCycleEventType.PERFORMANCE_ENTRIES_COLLECTED,\n    function (entries) {\n      var lcpEntry = findLast(entries, function (entry) {\n        return (\n          entry.entryType === 'largest-contentful-paint' &&\n          entry.startTime < firstInteractionTimestamp &&\n          entry.startTime < firstHidden.geTimeStamp() &&\n          entry.startTime < LCP_MAXIMUM_DELAY &&\n          // Ensure to get the LCP entry with the biggest size, see\n          // https://bugs.chromium.org/p/chromium/issues/detail?id=1516655\n          entry.size > biggestLcpSize\n        )\n      })\n      if (lcpEntry) {\n        var lcpTargetSelector\n        if (lcpEntry.element) {\n          lcpTargetSelector = getSelectorFromElement(\n            lcpEntry.element,\n            configuration.actionNameAttribute\n          )\n        }\n        callback({\n          value: lcpEntry.startTime,\n          targetSelector: lcpTargetSelector\n        })\n        biggestLcpSize = lcpEntry.size\n      }\n    }\n  )\n  var unsubscribeLifeCycle = subscribe.unsubscribe\n\n  return {\n    stop: function () {\n      stopEventListener()\n      unsubscribeLifeCycle()\n    }\n  }\n}\n"],"mappings":";;;;;;;AAAA,IAAAA,YAAA,GAAAC,OAAA;AAOA,IAAAC,wBAAA,GAAAD,OAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,IAAIE,iBAAiB,GAAG,EAAE,GAAGC,uBAAU;AAAAC,OAAA,CAAAF,iBAAA,GAAAA,iBAAA;AACvC,SAASG,2BAA2BA,CACzCC,SAAS,EACTC,aAAa,EACbC,WAAW,EACXC,WAAW,EACXC,QAAQ,EACR;EACA;EACA;EACA;EACA,IAAIC,yBAAyB,GAAGC,QAAQ;EACxC,IAAIC,kBAAkB,GAAG,IAAAC,8BAAiB,EACxCL,WAAW,EACX,CAACM,sBAAS,CAACC,YAAY,EAAED,sBAAS,CAACE,QAAQ,CAAC,EAC5C,UAAUC,KAAK,EAAE;IACfP,yBAAyB,GAAGO,KAAK,CAACC,SAAS;EAC7C,CAAC,EACD;IAAEC,OAAO,EAAE,IAAI;IAAEC,IAAI,EAAE;EAAK,CAC9B,CAAC;EACD,IAAIC,iBAAiB,GAAGT,kBAAkB,CAACU,IAAI;EAC/C,IAAIC,cAAc,GAAG,CAAC;EACtB,IAAIC,SAAS,GAAGnB,SAAS,CAACmB,SAAS,CACjCC,+BAAkB,CAACC,6BAA6B,EAChD,UAAUC,OAAO,EAAE;IACjB,IAAIC,QAAQ,GAAG,IAAAC,qBAAQ,EAACF,OAAO,EAAE,UAAUG,KAAK,EAAE;MAChD,OACEA,KAAK,CAACC,SAAS,KAAK,0BAA0B,IAC9CD,KAAK,CAACE,SAAS,GAAGtB,yBAAyB,IAC3CoB,KAAK,CAACE,SAAS,GAAGzB,WAAW,CAAC0B,WAAW,CAAC,CAAC,IAC3CH,KAAK,CAACE,SAAS,GAAG/B,iBAAiB;MACnC;MACA;MACA6B,KAAK,CAACI,IAAI,GAAGX,cAAc;IAE/B,CAAC,CAAC;IACF,IAAIK,QAAQ,EAAE;MACZ,IAAIO,iBAAiB;MACrB,IAAIP,QAAQ,CAACQ,OAAO,EAAE;QACpBD,iBAAiB,GAAG,IAAAE,+CAAsB,EACxCT,QAAQ,CAACQ,OAAO,EAChB9B,aAAa,CAACgC,mBAChB,CAAC;MACH;MACA7B,QAAQ,CAAC;QACP8B,KAAK,EAAEX,QAAQ,CAACI,SAAS;QACzBQ,cAAc,EAAEL;MAClB,CAAC,CAAC;MACFZ,cAAc,GAAGK,QAAQ,CAACM,IAAI;IAChC;EACF,CACF,CAAC;EACD,IAAIO,oBAAoB,GAAGjB,SAAS,CAACkB,WAAW;EAEhD,OAAO;IACLpB,IAAI,EAAE,SAAAA,KAAA,EAAY;MAChBD,iBAAiB,CAAC,CAAC;MACnBoB,oBAAoB,CAAC,CAAC;IACxB;EACF,CAAC;AACH","ignoreList":[]}