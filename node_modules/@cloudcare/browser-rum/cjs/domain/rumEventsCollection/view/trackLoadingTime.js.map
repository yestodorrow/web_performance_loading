{"version":3,"file":"trackLoadingTime.js","names":["_browserCore","require","_waitPageActivityEnd2","trackLoadingTime","lifeCycle","domMutationObservable","configuration","loadType","viewStart","callback","isWaitingForLoadEvent","ViewLoadingType","INITIAL_LOAD","isWaitingForActivityLoadingTime","loadingTimeCandidates","invokeCallbackIfAllCandidatesAreReceived","length","Math","max","apply","stopEndCallback","_waitPageActivityEnd","waitPageActivityEnd","event","hadActivity","push","elapsed","timeStamp","end","stop","setLoadEvent","loadEvent"],"sources":["../../../../src/domain/rumEventsCollection/view/trackLoadingTime.js"],"sourcesContent":["import { elapsed, ViewLoadingType } from '@cloudcare/browser-core'\nimport { waitPageActivityEnd } from '../../waitPageActivityEnd'\nexport function trackLoadingTime(\n  lifeCycle,\n  domMutationObservable,\n  configuration,\n  loadType,\n  viewStart,\n  callback\n) {\n  var isWaitingForLoadEvent = loadType === ViewLoadingType.INITIAL_LOAD\n  var isWaitingForActivityLoadingTime = true\n  var loadingTimeCandidates = []\n\n  function invokeCallbackIfAllCandidatesAreReceived() {\n    if (\n      !isWaitingForActivityLoadingTime &&\n      !isWaitingForLoadEvent &&\n      loadingTimeCandidates.length > 0\n    ) {\n      callback(Math.max.apply(Math, loadingTimeCandidates))\n    }\n  }\n  function stopEndCallback() {\n    if (loadingTimeCandidates.length > 0) {\n      callback(Math.max.apply(Math, loadingTimeCandidates))\n    }\n  }\n  var _waitPageActivityEnd = waitPageActivityEnd(\n    lifeCycle,\n    domMutationObservable,\n    configuration,\n    function (event) {\n      if (isWaitingForActivityLoadingTime) {\n        isWaitingForActivityLoadingTime = false\n        if (event.hadActivity) {\n          loadingTimeCandidates.push(elapsed(viewStart.timeStamp, event.end))\n        }\n        invokeCallbackIfAllCandidatesAreReceived()\n      }\n    }\n  )\n\n  var stop = _waitPageActivityEnd.stop\n  return {\n    setLoadEvent: function (loadEvent) {\n      if (isWaitingForLoadEvent) {\n        isWaitingForLoadEvent = false\n        loadingTimeCandidates.push(loadEvent)\n        invokeCallbackIfAllCandidatesAreReceived()\n      }\n    },\n    stop: function () {\n      stop()\n      stopEndCallback()\n    }\n  }\n}\n"],"mappings":";;;;;;AAAA,IAAAA,YAAA,GAAAC,OAAA;AACA,IAAAC,qBAAA,GAAAD,OAAA;AACO,SAASE,gBAAgBA,CAC9BC,SAAS,EACTC,qBAAqB,EACrBC,aAAa,EACbC,QAAQ,EACRC,SAAS,EACTC,QAAQ,EACR;EACA,IAAIC,qBAAqB,GAAGH,QAAQ,KAAKI,4BAAe,CAACC,YAAY;EACrE,IAAIC,+BAA+B,GAAG,IAAI;EAC1C,IAAIC,qBAAqB,GAAG,EAAE;EAE9B,SAASC,wCAAwCA,CAAA,EAAG;IAClD,IACE,CAACF,+BAA+B,IAChC,CAACH,qBAAqB,IACtBI,qBAAqB,CAACE,MAAM,GAAG,CAAC,EAChC;MACAP,QAAQ,CAACQ,IAAI,CAACC,GAAG,CAACC,KAAK,CAACF,IAAI,EAAEH,qBAAqB,CAAC,CAAC;IACvD;EACF;EACA,SAASM,eAAeA,CAAA,EAAG;IACzB,IAAIN,qBAAqB,CAACE,MAAM,GAAG,CAAC,EAAE;MACpCP,QAAQ,CAACQ,IAAI,CAACC,GAAG,CAACC,KAAK,CAACF,IAAI,EAAEH,qBAAqB,CAAC,CAAC;IACvD;EACF;EACA,IAAIO,oBAAoB,GAAG,IAAAC,yCAAmB,EAC5ClB,SAAS,EACTC,qBAAqB,EACrBC,aAAa,EACb,UAAUiB,KAAK,EAAE;IACf,IAAIV,+BAA+B,EAAE;MACnCA,+BAA+B,GAAG,KAAK;MACvC,IAAIU,KAAK,CAACC,WAAW,EAAE;QACrBV,qBAAqB,CAACW,IAAI,CAAC,IAAAC,oBAAO,EAAClB,SAAS,CAACmB,SAAS,EAAEJ,KAAK,CAACK,GAAG,CAAC,CAAC;MACrE;MACAb,wCAAwC,CAAC,CAAC;IAC5C;EACF,CACF,CAAC;EAED,IAAIc,KAAI,GAAGR,oBAAoB,CAACQ,IAAI;EACpC,OAAO;IACLC,YAAY,EAAE,SAAAA,aAAUC,SAAS,EAAE;MACjC,IAAIrB,qBAAqB,EAAE;QACzBA,qBAAqB,GAAG,KAAK;QAC7BI,qBAAqB,CAACW,IAAI,CAACM,SAAS,CAAC;QACrChB,wCAAwC,CAAC,CAAC;MAC5C;IACF,CAAC;IACDc,IAAI,EAAE,SAAAA,KAAA,EAAY;MAChBA,KAAI,CAAC,CAAC;MACNT,eAAe,CAAC,CAAC;IACnB;EACF,CAAC;AACH","ignoreList":[]}