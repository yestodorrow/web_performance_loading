{"version":3,"file":"serialize.js","names":["_browserCore","require","_getSelectorsFromElement","_constants","_types","_privacy","_serializationUtils","_resourceUtils","_typeof","obj","Symbol","iterator","constructor","prototype","_defineProperty","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","toPrimitive","undefined","res","call","TypeError","Number","SerializationContextStatus","INITIAL_FULL_SNAPSHOT","SUBSEQUENT_FULL_SNAPSHOT","MUTATION","exports","serializeDocument","document","configuration","serializationContext","serializeNodeWithId","parentNodePrivacyLevel","defaultPrivacyLevel","node","options","serializedNode","serializeNode","id","getSerializedNodeId","generateNextId","serializedNodeWithId","setSerializedNodeId","serializedNodeIds","add","nodeType","DOCUMENT_NODE","serializeDocumentNode","DOCUMENT_FRAGMENT_NODE","serializeDocumentFragmentNode","DOCUMENT_TYPE_NODE","serializeDocumentTypeNode","ELEMENT_NODE","serializeElementNode","TEXT_NODE","serializeTextNode","CDATA_SECTION_NODE","serializeCDataNode","type","NodeType","Document","childNodes","serializeChildNodes","adoptedStyleSheets","serializeStyleSheets","documentType","DocumentType","name","publicId","systemId","element","isShadowRoot","isNodeShadowRoot","shadowRootsController","addShadowRoot","DocumentFragment","tagName","getValidTagName","isSVG","isSVGElement","nodePrivacyLevel","reducePrivacyLevel","getNodeSelfPrivacyLevel","NodePrivacyLevel","HIDDEN","_boundingClientRect","getBoundingClientRect","width","height","Element","attributes","rr_width","rr_height","PRIVACY_ATTR_NAME","PRIVACY_ATTR_VALUE_HIDDEN","IGNORE","getAttributesForPrivacyLevel","hasChildNodes","childNodesSerializationOptions","ignoreWhiteSpace","assign","textNode","textContent","getTextContent","Text","CDATA","result","forEachChildNodes","childNode","serializedChildNode","push","serializeAttribute","attributeName","attributeValue","getAttribute","MASK","STABLE_ATTRIBUTES","includes","actionNameAttribute","CENSORED_STRING_MARK","CENSORED_IMG_MARK","startsWith","isLongDataUrl","sanitizeDataUrl","_nextId","TAG_NAME_REGEX","processedTagName","toLowerCase","trim","test","transformAttribute","doc","absoluteToDoc","getAbsoluteSrcsetString","switchToAbsoluteUrl","getHref","safeAttrs","ownerDocument","i","length","attribute","item","formValue","getElementInputValue","ALLOW","optionElement","selected","stylesheet","Array","from","styleSheets","find","s","href","cssText","getCssRulesString","_cssText","sheet","inputElement","checked","shouldMaskNode","mediaElement","rr_mediaState","paused","scrollTop","scrollLeft","status","Math","round","elementsScrollPositions","set","has","scroll","get","rr_scrollLeft","rr_scrollTop"],"sources":["../../../../src/domain/replay/record/serialize.js"],"sourcesContent":["import {\n  assign,\n  startsWith,\n  isNodeShadowRoot,\n  forEachChildNodes,\n  hasChildNodes\n} from '@cloudcare/browser-core'\nimport { STABLE_ATTRIBUTES } from '../../rumEventsCollection/actions/getSelectorsFromElement'\nimport {\n  NodePrivacyLevel,\n  PRIVACY_ATTR_NAME,\n  PRIVACY_ATTR_VALUE_HIDDEN,\n  CENSORED_STRING_MARK,\n  CENSORED_IMG_MARK\n} from '../../../constants'\n\nimport { NodeType } from '../../../types'\nimport {\n  getTextContent,\n  shouldMaskNode,\n  reducePrivacyLevel,\n  getNodeSelfPrivacyLevel\n} from './privacy'\nimport {\n  getSerializedNodeId,\n  setSerializedNodeId,\n  getElementInputValue,\n  switchToAbsoluteUrl,\n  serializeStyleSheets,\n  absoluteToDoc,\n  getAbsoluteSrcsetString,\n  isSVGElement,\n  getHref,\n  getCssRulesString\n} from './serializationUtils'\nimport {\n  isLongDataUrl,\n  sanitizeDataUrl\n} from '../../rumEventsCollection/resource/resourceUtils'\n// Those values are the only one that can be used when inheriting privacy levels from parent to\n// children during serialization, since HIDDEN and IGNORE shouldn't serialize their children. This\n// ensures that no children are serialized when they shouldn't.\n\nexport var SerializationContextStatus = {\n  INITIAL_FULL_SNAPSHOT: 0,\n  SUBSEQUENT_FULL_SNAPSHOT: 1,\n  MUTATION: 2\n}\n\nexport function serializeDocument(\n  document,\n  configuration,\n  serializationContext\n) {\n  // We are sure that Documents are never ignored, so this function never returns null\n  return serializeNodeWithId(document, {\n    serializationContext: serializationContext,\n    parentNodePrivacyLevel: configuration.defaultPrivacyLevel,\n    configuration: configuration\n  })\n}\n\nexport function serializeNodeWithId(node, options) {\n  var serializedNode = serializeNode(node, options)\n  if (!serializedNode) {\n    return null\n  }\n\n  // Try to reuse the previous id\n  var id = getSerializedNodeId(node) || generateNextId()\n  var serializedNodeWithId = serializedNode\n  serializedNodeWithId.id = id\n  setSerializedNodeId(node, id)\n  if (options.serializedNodeIds) {\n    options.serializedNodeIds.add(id)\n  }\n  return serializedNodeWithId\n}\n\nfunction serializeNode(node, options) {\n  switch (node.nodeType) {\n    case node.DOCUMENT_NODE:\n      return serializeDocumentNode(node, options)\n    case node.DOCUMENT_FRAGMENT_NODE:\n      return serializeDocumentFragmentNode(node, options)\n    case node.DOCUMENT_TYPE_NODE:\n      return serializeDocumentTypeNode(node)\n    case node.ELEMENT_NODE:\n      return serializeElementNode(node, options)\n    case node.TEXT_NODE:\n      return serializeTextNode(node, options)\n    case node.CDATA_SECTION_NODE:\n      return serializeCDataNode()\n  }\n}\n\nexport function serializeDocumentNode(document, options) {\n  return {\n    type: NodeType.Document,\n    childNodes: serializeChildNodes(document, options),\n    adoptedStyleSheets: serializeStyleSheets(document.adoptedStyleSheets)\n  }\n}\n\nfunction serializeDocumentTypeNode(documentType) {\n  return {\n    type: NodeType.DocumentType,\n    name: documentType.name,\n    publicId: documentType.publicId,\n    systemId: documentType.systemId\n  }\n}\n\nfunction serializeDocumentFragmentNode(element, options) {\n  var isShadowRoot = isNodeShadowRoot(element)\n  if (isShadowRoot) {\n    options.serializationContext.shadowRootsController.addShadowRoot(element)\n  }\n  return {\n    type: NodeType.DocumentFragment,\n    childNodes: serializeChildNodes(element, options),\n    isShadowRoot: isShadowRoot,\n    adoptedStyleSheets: isShadowRoot\n      ? serializeStyleSheets(element.adoptedStyleSheets)\n      : undefined\n  }\n}\n\n/**\n * Serializing Element nodes involves capturing:\n * 1. HTML ATTRIBUTES:\n * 2. JS STATE:\n * - scroll offsets\n * - Form fields (input value, checkbox checked, option selection, range)\n * - Canvas state,\n * - Media (video/audio) play mode + currentTime\n * - iframe contents\n * - webcomponents\n * 3. CUSTOM PROPERTIES:\n * - height+width for when `hidden` to cover the element\n * 4. EXCLUDED INTERACTION STATE:\n * - focus (possible, but not worth perf impact)\n * - hover (tracked only via mouse activity)\n * - fullscreen mode\n */\nexport function serializeElementNode(element, options) {\n  var tagName = getValidTagName(element.tagName)\n  var isSVG = isSVGElement(element) || undefined\n\n  // For performance reason, we don't use getNodePrivacyLevel directly: we leverage the\n  // parentNodePrivacyLevel option to avoid iterating over all parents\n  var nodePrivacyLevel = reducePrivacyLevel(\n    getNodeSelfPrivacyLevel(element),\n    options.parentNodePrivacyLevel\n  )\n\n  if (nodePrivacyLevel === NodePrivacyLevel.HIDDEN) {\n    var _boundingClientRect = element.getBoundingClientRect()\n    var width = _boundingClientRect.width\n    var height = _boundingClientRect.height\n    return {\n      type: NodeType.Element,\n      tagName: tagName,\n      attributes: {\n        rr_width: width + 'px',\n        rr_height: height + 'px',\n        [PRIVACY_ATTR_NAME]: PRIVACY_ATTR_VALUE_HIDDEN\n      },\n      childNodes: [],\n      isSVG: isSVG\n    }\n  }\n\n  // Ignore Elements like Script and some Link, Metas\n  if (nodePrivacyLevel === NodePrivacyLevel.IGNORE) {\n    return\n  }\n\n  var attributes = getAttributesForPrivacyLevel(\n    element,\n    nodePrivacyLevel,\n    options\n  )\n\n  var childNodes = []\n  if (hasChildNodes(element) && tagName !== 'style') {\n    // OBJECT POOLING OPTIMIZATION:\n    // We should not create a new object systematically as it could impact performances. Try to reuse\n    // the same object as much as possible, and clone it only if we need to.\n    var childNodesSerializationOptions\n    if (\n      options.parentNodePrivacyLevel === nodePrivacyLevel &&\n      options.ignoreWhiteSpace === (tagName === 'head')\n    ) {\n      childNodesSerializationOptions = options\n    } else {\n      childNodesSerializationOptions = assign({}, options, {\n        parentNodePrivacyLevel: nodePrivacyLevel,\n        ignoreWhiteSpace: tagName === 'head'\n      })\n    }\n    childNodes = serializeChildNodes(element, childNodesSerializationOptions)\n  }\n\n  //   if (isNodeShadowHost(element)) {\n  //     var shadowRoot = serializeNodeWithId(element.shadowRoot, options)\n  //     if (shadowRoot !== null) {\n  //       childNodes.push(shadowRoot)\n  //     }\n  //   }\n\n  return {\n    type: NodeType.Element,\n    tagName: tagName,\n    attributes: attributes,\n    childNodes: childNodes,\n    isSVG: isSVG\n  }\n}\n\n/**\n * Text Nodes are dependant on Element nodes\n * Privacy levels are set on elements so we check the parentElement of a text node\n * for privacy level.\n */\nfunction serializeTextNode(textNode, options) {\n  // The parent node may not be a html element which has a tagName attribute.\n  // So just let it be undefined which is ok in this use case.\n  //   var parentTagName = textNode.parentElement && textNode.parentElement.tagName\n  var textContent = getTextContent(\n    textNode,\n    options.ignoreWhiteSpace || false,\n    options.parentNodePrivacyLevel\n  )\n  if (textContent === undefined) {\n    return\n  }\n  return {\n    type: NodeType.Text,\n    textContent: textContent\n    // isStyle: parentTagName === 'STYLE' ? true : undefined\n  }\n}\n\nfunction serializeCDataNode() {\n  return {\n    type: NodeType.CDATA,\n    textContent: ''\n  }\n}\n\nexport function serializeChildNodes(node, options) {\n  var result = []\n  forEachChildNodes(node, function (childNode) {\n    var serializedChildNode = serializeNodeWithId(childNode, options)\n    if (serializedChildNode) {\n      result.push(serializedChildNode)\n    }\n  })\n  //   node.childNodes.forEach()\n  return result\n}\n\nexport function serializeAttribute(\n  element,\n  nodePrivacyLevel,\n  attributeName,\n  configuration\n) {\n  if (nodePrivacyLevel === NodePrivacyLevel.HIDDEN) {\n    // dup condition for direct access case\n    return null\n  }\n  var attributeValue = element.getAttribute(attributeName)\n  if (\n    nodePrivacyLevel === NodePrivacyLevel.MASK &&\n    attributeName !== PRIVACY_ATTR_NAME &&\n    !STABLE_ATTRIBUTES.includes(attributeName) &&\n    attributeName !== configuration.actionNameAttribute\n  ) {\n    var tagName = element.tagName\n\n    switch (attributeName) {\n      // Mask Attribute text content\n      case 'title':\n      case 'alt':\n      case 'placeholder':\n        return CENSORED_STRING_MARK\n    }\n    // mask image URLs\n    if (tagName === 'IMG' || tagName === 'SOURCE') {\n      if (attributeName === 'src' || attributeName === 'srcset') {\n        return CENSORED_IMG_MARK\n      } else if (attributeName === 'onerror') {\n        return null\n      }\n    }\n    // mask <a> URLs\n    if (tagName === 'A' && attributeName === 'href') {\n      return CENSORED_STRING_MARK\n    }\n\n    // mask data-* attributes\n    if (attributeValue && startsWith(attributeName, 'data-')) {\n      // Exception: it's safe to reveal the `${PRIVACY_ATTR_NAME}` attr\n      return CENSORED_STRING_MARK\n    }\n    // mask iframe srcdoc\n    if (tagName === 'IFRAME' && attributeName === 'srcdoc') {\n      return CENSORED_STRING_MARK\n    }\n  }\n\n  if (!attributeValue || typeof attributeValue !== 'string') {\n    return attributeValue\n  }\n\n  // Minimum Fix for customer.\n  //   if (\n  //     attributeValue.length > MAX_ATTRIBUTE_VALUE_CHAR_LENGTH &&\n  //     attributeValue.slice(0, 5) === 'data:'\n  //   ) {\n  //     return 'data:truncated'\n  //   }\n  if (isLongDataUrl(attributeValue)) {\n    return sanitizeDataUrl(attributeValue)\n  }\n  return attributeValue\n}\n\nvar _nextId = 1\nfunction generateNextId() {\n  return _nextId++\n}\n\nvar TAG_NAME_REGEX = /[^a-z1-6-_]/\nfunction getValidTagName(tagName) {\n  var processedTagName = (tagName + '').toLowerCase().trim()\n\n  if (TAG_NAME_REGEX.test(processedTagName)) {\n    // if the tag name is odd and we cannot extract\n    // anything from the string, then we return a\n    // generic div\n    return 'div'\n  }\n\n  return processedTagName\n}\n\nfunction transformAttribute(doc, tagName, name, value) {\n  if (!value) return value\n  if (\n    name === 'src' ||\n    (name === 'href' && !(tagName === 'use' && value[0] === '#'))\n  ) {\n    return absoluteToDoc(doc, value)\n  } else if (name === 'xlink:href' && value[0] !== '#') {\n    return absoluteToDoc(doc, value)\n  } else if (\n    name === 'background' &&\n    value &&\n    (tagName === 'table' || tagName === 'td' || tagName === 'th')\n  ) {\n    return absoluteToDoc(doc, value)\n  } else if (name === 'srcset') {\n    return getAbsoluteSrcsetString(doc, value)\n  } else if (name === 'style') {\n    return switchToAbsoluteUrl(value, getHref())\n  } else if (tagName === 'object' && name === 'data') {\n    return absoluteToDoc(doc, value)\n  } else {\n    return value\n  }\n}\n\nfunction getAttributesForPrivacyLevel(element, nodePrivacyLevel, options) {\n  if (nodePrivacyLevel === NodePrivacyLevel.HIDDEN) {\n    return {}\n  }\n  var safeAttrs = {}\n  var tagName = getValidTagName(element.tagName)\n  var doc = element.ownerDocument\n\n  for (var i = 0; i < element.attributes.length; i += 1) {\n    var attribute = element.attributes.item(i)\n    var attributeName = attribute.name\n    var attributeValue = serializeAttribute(\n      element,\n      nodePrivacyLevel,\n      attributeName,\n      options.configuration\n    )\n    if (attributeValue !== null) {\n      safeAttrs[attributeName] = transformAttribute(\n        doc,\n        tagName,\n        attributeName,\n        attributeValue\n      )\n    }\n  }\n\n  if (\n    element.value &&\n    (tagName === 'textarea' ||\n      tagName === 'select' ||\n      tagName === 'option' ||\n      tagName === 'input')\n  ) {\n    var formValue = getElementInputValue(element, nodePrivacyLevel)\n    if (formValue !== undefined) {\n      safeAttrs.value = formValue\n    }\n  }\n\n  /**\n   * <Option> can be selected, which occurs if its `value` matches ancestor `<Select>.value`\n   */\n  if (tagName === 'option' && nodePrivacyLevel === NodePrivacyLevel.ALLOW) {\n    // For privacy=`MASK`, all the values would be the same, so skip.\n    var optionElement = element\n    if (optionElement.selected) {\n      safeAttrs.selected = optionElement.selected\n    }\n  }\n\n  // remote css\n  if (tagName === 'link') {\n    var stylesheet = Array.from(doc.styleSheets).find(function (s) {\n      return s.href === element.href\n    })\n    var cssText = getCssRulesString(stylesheet)\n\n    if (cssText && stylesheet) {\n      safeAttrs._cssText = cssText\n    }\n  }\n\n  // dynamic stylesheet\n  if (tagName === 'style' && element.sheet) {\n    var cssText = getCssRulesString(element.sheet)\n    if (cssText) {\n      safeAttrs._cssText = cssText\n    }\n  }\n\n  /**\n   * Forms: input[type=checkbox,radio]\n   * The `checked` property for <input> is a little bit special:\n   * 1. el.checked is a setter that returns if truthy.\n   * 2. getAttribute returns the string value\n   * getAttribute('checked') does not sync with `Element.checked`, so use JS property\n   * NOTE: `checked` property exists on `HTMLInputElement`. For serializer assumptions, we check for type=radio|check.\n   */\n  var inputElement = element\n  if (\n    tagName === 'input' &&\n    (inputElement.type === 'radio' || inputElement.type === 'checkbox')\n  ) {\n    if (nodePrivacyLevel === NodePrivacyLevel.ALLOW) {\n      safeAttrs.checked = !!inputElement.checked\n    } else if (shouldMaskNode(inputElement, nodePrivacyLevel)) {\n      delete safeAttrs.checked\n    }\n  }\n\n  /**\n   * Serialize the media playback state\n   */\n  if (tagName === 'audio' || tagName === 'video') {\n    var mediaElement = element\n    safeAttrs.rr_mediaState = mediaElement.paused ? 'paused' : 'played'\n  }\n\n  /**\n   * Serialize the scroll state for each element only for full snapshot\n   */\n  var scrollTop\n  var scrollLeft\n  var serializationContext = options.serializationContext\n  switch (serializationContext.status) {\n    case SerializationContextStatus.INITIAL_FULL_SNAPSHOT:\n      scrollTop = Math.round(element.scrollTop)\n      scrollLeft = Math.round(element.scrollLeft)\n      if (scrollTop || scrollLeft) {\n        serializationContext.elementsScrollPositions.set(element, {\n          scrollTop: scrollTop,\n          scrollLeft: scrollLeft\n        })\n      }\n      break\n    case SerializationContextStatus.SUBSEQUENT_FULL_SNAPSHOT:\n      if (serializationContext.elementsScrollPositions.has(element)) {\n        const scroll = serializationContext.elementsScrollPositions.get(element)\n        scrollTop = scroll.scrollTop\n        scrollLeft = scroll.scrollLeft\n      }\n      break\n  }\n  if (scrollLeft) {\n    safeAttrs.rr_scrollLeft = scrollLeft\n  }\n  if (scrollTop) {\n    safeAttrs.rr_scrollTop = scrollTop\n  }\n\n  return safeAttrs\n}\n"],"mappings":";;;;;;;;;;;;AAAA,IAAAA,YAAA,GAAAC,OAAA;AAOA,IAAAC,wBAAA,GAAAD,OAAA;AACA,IAAAE,UAAA,GAAAF,OAAA;AAQA,IAAAG,MAAA,GAAAH,OAAA;AACA,IAAAI,QAAA,GAAAJ,OAAA;AAMA,IAAAK,mBAAA,GAAAL,OAAA;AAYA,IAAAM,cAAA,GAAAN,OAAA;AAGyD,SAAAO,QAAAC,GAAA,sCAAAD,OAAA,wBAAAE,MAAA,uBAAAA,MAAA,CAAAC,QAAA,aAAAF,GAAA,kBAAAA,GAAA,gBAAAA,GAAA,WAAAA,GAAA,yBAAAC,MAAA,IAAAD,GAAA,CAAAG,WAAA,KAAAF,MAAA,IAAAD,GAAA,KAAAC,MAAA,CAAAG,SAAA,qBAAAJ,GAAA,KAAAD,OAAA,CAAAC,GAAA;AAAA,SAAAK,gBAAAL,GAAA,EAAAM,GAAA,EAAAC,KAAA,IAAAD,GAAA,GAAAE,cAAA,CAAAF,GAAA,OAAAA,GAAA,IAAAN,GAAA,IAAAS,MAAA,CAAAC,cAAA,CAAAV,GAAA,EAAAM,GAAA,IAAAC,KAAA,EAAAA,KAAA,EAAAI,UAAA,QAAAC,YAAA,QAAAC,QAAA,oBAAAb,GAAA,CAAAM,GAAA,IAAAC,KAAA,WAAAP,GAAA;AAAA,SAAAQ,eAAAM,GAAA,QAAAR,GAAA,GAAAS,YAAA,CAAAD,GAAA,oBAAAf,OAAA,CAAAO,GAAA,iBAAAA,GAAA,GAAAU,MAAA,CAAAV,GAAA;AAAA,SAAAS,aAAAE,KAAA,EAAAC,IAAA,QAAAnB,OAAA,CAAAkB,KAAA,kBAAAA,KAAA,kBAAAA,KAAA,MAAAE,IAAA,GAAAF,KAAA,CAAAhB,MAAA,CAAAmB,WAAA,OAAAD,IAAA,KAAAE,SAAA,QAAAC,GAAA,GAAAH,IAAA,CAAAI,IAAA,CAAAN,KAAA,EAAAC,IAAA,oBAAAnB,OAAA,CAAAuB,GAAA,uBAAAA,GAAA,YAAAE,SAAA,4DAAAN,IAAA,gBAAAF,MAAA,GAAAS,MAAA,EAAAR,KAAA;AACzD;AACA;AACA;;AAEO,IAAIS,0BAA0B,GAAG;EACtCC,qBAAqB,EAAE,CAAC;EACxBC,wBAAwB,EAAE,CAAC;EAC3BC,QAAQ,EAAE;AACZ,CAAC;AAAAC,OAAA,CAAAJ,0BAAA,GAAAA,0BAAA;AAEM,SAASK,iBAAiBA,CAC/BC,QAAQ,EACRC,aAAa,EACbC,oBAAoB,EACpB;EACA;EACA,OAAOC,mBAAmB,CAACH,QAAQ,EAAE;IACnCE,oBAAoB,EAAEA,oBAAoB;IAC1CE,sBAAsB,EAAEH,aAAa,CAACI,mBAAmB;IACzDJ,aAAa,EAAEA;EACjB,CAAC,CAAC;AACJ;AAEO,SAASE,mBAAmBA,CAACG,IAAI,EAAEC,OAAO,EAAE;EACjD,IAAIC,cAAc,GAAGC,aAAa,CAACH,IAAI,EAAEC,OAAO,CAAC;EACjD,IAAI,CAACC,cAAc,EAAE;IACnB,OAAO,IAAI;EACb;;EAEA;EACA,IAAIE,EAAE,GAAG,IAAAC,uCAAmB,EAACL,IAAI,CAAC,IAAIM,cAAc,CAAC,CAAC;EACtD,IAAIC,oBAAoB,GAAGL,cAAc;EACzCK,oBAAoB,CAACH,EAAE,GAAGA,EAAE;EAC5B,IAAAI,uCAAmB,EAACR,IAAI,EAAEI,EAAE,CAAC;EAC7B,IAAIH,OAAO,CAACQ,iBAAiB,EAAE;IAC7BR,OAAO,CAACQ,iBAAiB,CAACC,GAAG,CAACN,EAAE,CAAC;EACnC;EACA,OAAOG,oBAAoB;AAC7B;AAEA,SAASJ,aAAaA,CAACH,IAAI,EAAEC,OAAO,EAAE;EACpC,QAAQD,IAAI,CAACW,QAAQ;IACnB,KAAKX,IAAI,CAACY,aAAa;MACrB,OAAOC,qBAAqB,CAACb,IAAI,EAAEC,OAAO,CAAC;IAC7C,KAAKD,IAAI,CAACc,sBAAsB;MAC9B,OAAOC,6BAA6B,CAACf,IAAI,EAAEC,OAAO,CAAC;IACrD,KAAKD,IAAI,CAACgB,kBAAkB;MAC1B,OAAOC,yBAAyB,CAACjB,IAAI,CAAC;IACxC,KAAKA,IAAI,CAACkB,YAAY;MACpB,OAAOC,oBAAoB,CAACnB,IAAI,EAAEC,OAAO,CAAC;IAC5C,KAAKD,IAAI,CAACoB,SAAS;MACjB,OAAOC,iBAAiB,CAACrB,IAAI,EAAEC,OAAO,CAAC;IACzC,KAAKD,IAAI,CAACsB,kBAAkB;MAC1B,OAAOC,kBAAkB,CAAC,CAAC;EAC/B;AACF;AAEO,SAASV,qBAAqBA,CAACnB,QAAQ,EAAEO,OAAO,EAAE;EACvD,OAAO;IACLuB,IAAI,EAAEC,eAAQ,CAACC,QAAQ;IACvBC,UAAU,EAAEC,mBAAmB,CAAClC,QAAQ,EAAEO,OAAO,CAAC;IAClD4B,kBAAkB,EAAE,IAAAC,wCAAoB,EAACpC,QAAQ,CAACmC,kBAAkB;EACtE,CAAC;AACH;AAEA,SAASZ,yBAAyBA,CAACc,YAAY,EAAE;EAC/C,OAAO;IACLP,IAAI,EAAEC,eAAQ,CAACO,YAAY;IAC3BC,IAAI,EAAEF,YAAY,CAACE,IAAI;IACvBC,QAAQ,EAAEH,YAAY,CAACG,QAAQ;IAC/BC,QAAQ,EAAEJ,YAAY,CAACI;EACzB,CAAC;AACH;AAEA,SAASpB,6BAA6BA,CAACqB,OAAO,EAAEnC,OAAO,EAAE;EACvD,IAAIoC,YAAY,GAAG,IAAAC,6BAAgB,EAACF,OAAO,CAAC;EAC5C,IAAIC,YAAY,EAAE;IAChBpC,OAAO,CAACL,oBAAoB,CAAC2C,qBAAqB,CAACC,aAAa,CAACJ,OAAO,CAAC;EAC3E;EACA,OAAO;IACLZ,IAAI,EAAEC,eAAQ,CAACgB,gBAAgB;IAC/Bd,UAAU,EAAEC,mBAAmB,CAACQ,OAAO,EAAEnC,OAAO,CAAC;IACjDoC,YAAY,EAAEA,YAAY;IAC1BR,kBAAkB,EAAEQ,YAAY,GAC5B,IAAAP,wCAAoB,EAACM,OAAO,CAACP,kBAAkB,CAAC,GAChD9C;EACN,CAAC;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASoC,oBAAoBA,CAACiB,OAAO,EAAEnC,OAAO,EAAE;EACrD,IAAIyC,OAAO,GAAGC,eAAe,CAACP,OAAO,CAACM,OAAO,CAAC;EAC9C,IAAIE,KAAK,GAAG,IAAAC,gCAAY,EAACT,OAAO,CAAC,IAAIrD,SAAS;;EAE9C;EACA;EACA,IAAI+D,gBAAgB,GAAG,IAAAC,2BAAkB,EACvC,IAAAC,gCAAuB,EAACZ,OAAO,CAAC,EAChCnC,OAAO,CAACH,sBACV,CAAC;EAED,IAAIgD,gBAAgB,KAAKG,2BAAgB,CAACC,MAAM,EAAE;IAChD,IAAIC,mBAAmB,GAAGf,OAAO,CAACgB,qBAAqB,CAAC,CAAC;IACzD,IAAIC,KAAK,GAAGF,mBAAmB,CAACE,KAAK;IACrC,IAAIC,MAAM,GAAGH,mBAAmB,CAACG,MAAM;IACvC,OAAO;MACL9B,IAAI,EAAEC,eAAQ,CAAC8B,OAAO;MACtBb,OAAO,EAAEA,OAAO;MAChBc,UAAU,EAAAzF,eAAA;QACR0F,QAAQ,EAAEJ,KAAK,GAAG,IAAI;QACtBK,SAAS,EAAEJ,MAAM,GAAG;MAAI,GACvBK,4BAAiB,EAAGC,oCAAyB,CAC/C;MACDjC,UAAU,EAAE,EAAE;MACdiB,KAAK,EAAEA;IACT,CAAC;EACH;;EAEA;EACA,IAAIE,gBAAgB,KAAKG,2BAAgB,CAACY,MAAM,EAAE;IAChD;EACF;EAEA,IAAIL,UAAU,GAAGM,4BAA4B,CAC3C1B,OAAO,EACPU,gBAAgB,EAChB7C,OACF,CAAC;EAED,IAAI0B,UAAU,GAAG,EAAE;EACnB,IAAI,IAAAoC,0BAAa,EAAC3B,OAAO,CAAC,IAAIM,OAAO,KAAK,OAAO,EAAE;IACjD;IACA;IACA;IACA,IAAIsB,8BAA8B;IAClC,IACE/D,OAAO,CAACH,sBAAsB,KAAKgD,gBAAgB,IACnD7C,OAAO,CAACgE,gBAAgB,MAAMvB,OAAO,KAAK,MAAM,CAAC,EACjD;MACAsB,8BAA8B,GAAG/D,OAAO;IAC1C,CAAC,MAAM;MACL+D,8BAA8B,GAAG,IAAAE,mBAAM,EAAC,CAAC,CAAC,EAAEjE,OAAO,EAAE;QACnDH,sBAAsB,EAAEgD,gBAAgB;QACxCmB,gBAAgB,EAAEvB,OAAO,KAAK;MAChC,CAAC,CAAC;IACJ;IACAf,UAAU,GAAGC,mBAAmB,CAACQ,OAAO,EAAE4B,8BAA8B,CAAC;EAC3E;;EAEA;EACA;EACA;EACA;EACA;EACA;;EAEA,OAAO;IACLxC,IAAI,EAAEC,eAAQ,CAAC8B,OAAO;IACtBb,OAAO,EAAEA,OAAO;IAChBc,UAAU,EAAEA,UAAU;IACtB7B,UAAU,EAAEA,UAAU;IACtBiB,KAAK,EAAEA;EACT,CAAC;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,SAASvB,iBAAiBA,CAAC8C,QAAQ,EAAElE,OAAO,EAAE;EAC5C;EACA;EACA;EACA,IAAImE,WAAW,GAAG,IAAAC,uBAAc,EAC9BF,QAAQ,EACRlE,OAAO,CAACgE,gBAAgB,IAAI,KAAK,EACjChE,OAAO,CAACH,sBACV,CAAC;EACD,IAAIsE,WAAW,KAAKrF,SAAS,EAAE;IAC7B;EACF;EACA,OAAO;IACLyC,IAAI,EAAEC,eAAQ,CAAC6C,IAAI;IACnBF,WAAW,EAAEA;IACb;EACF,CAAC;AACH;;AAEA,SAAS7C,kBAAkBA,CAAA,EAAG;EAC5B,OAAO;IACLC,IAAI,EAAEC,eAAQ,CAAC8C,KAAK;IACpBH,WAAW,EAAE;EACf,CAAC;AACH;AAEO,SAASxC,mBAAmBA,CAAC5B,IAAI,EAAEC,OAAO,EAAE;EACjD,IAAIuE,MAAM,GAAG,EAAE;EACf,IAAAC,8BAAiB,EAACzE,IAAI,EAAE,UAAU0E,SAAS,EAAE;IAC3C,IAAIC,mBAAmB,GAAG9E,mBAAmB,CAAC6E,SAAS,EAAEzE,OAAO,CAAC;IACjE,IAAI0E,mBAAmB,EAAE;MACvBH,MAAM,CAACI,IAAI,CAACD,mBAAmB,CAAC;IAClC;EACF,CAAC,CAAC;EACF;EACA,OAAOH,MAAM;AACf;AAEO,SAASK,kBAAkBA,CAChCzC,OAAO,EACPU,gBAAgB,EAChBgC,aAAa,EACbnF,aAAa,EACb;EACA,IAAImD,gBAAgB,KAAKG,2BAAgB,CAACC,MAAM,EAAE;IAChD;IACA,OAAO,IAAI;EACb;EACA,IAAI6B,cAAc,GAAG3C,OAAO,CAAC4C,YAAY,CAACF,aAAa,CAAC;EACxD,IACEhC,gBAAgB,KAAKG,2BAAgB,CAACgC,IAAI,IAC1CH,aAAa,KAAKnB,4BAAiB,IACnC,CAACuB,0CAAiB,CAACC,QAAQ,CAACL,aAAa,CAAC,IAC1CA,aAAa,KAAKnF,aAAa,CAACyF,mBAAmB,EACnD;IACA,IAAI1C,OAAO,GAAGN,OAAO,CAACM,OAAO;IAE7B,QAAQoC,aAAa;MACnB;MACA,KAAK,OAAO;MACZ,KAAK,KAAK;MACV,KAAK,aAAa;QAChB,OAAOO,+BAAoB;IAC/B;IACA;IACA,IAAI3C,OAAO,KAAK,KAAK,IAAIA,OAAO,KAAK,QAAQ,EAAE;MAC7C,IAAIoC,aAAa,KAAK,KAAK,IAAIA,aAAa,KAAK,QAAQ,EAAE;QACzD,OAAOQ,4BAAiB;MAC1B,CAAC,MAAM,IAAIR,aAAa,KAAK,SAAS,EAAE;QACtC,OAAO,IAAI;MACb;IACF;IACA;IACA,IAAIpC,OAAO,KAAK,GAAG,IAAIoC,aAAa,KAAK,MAAM,EAAE;MAC/C,OAAOO,+BAAoB;IAC7B;;IAEA;IACA,IAAIN,cAAc,IAAI,IAAAQ,uBAAU,EAACT,aAAa,EAAE,OAAO,CAAC,EAAE;MACxD;MACA,OAAOO,+BAAoB;IAC7B;IACA;IACA,IAAI3C,OAAO,KAAK,QAAQ,IAAIoC,aAAa,KAAK,QAAQ,EAAE;MACtD,OAAOO,+BAAoB;IAC7B;EACF;EAEA,IAAI,CAACN,cAAc,IAAI,OAAOA,cAAc,KAAK,QAAQ,EAAE;IACzD,OAAOA,cAAc;EACvB;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,IAAI,IAAAS,4BAAa,EAACT,cAAc,CAAC,EAAE;IACjC,OAAO,IAAAU,8BAAe,EAACV,cAAc,CAAC;EACxC;EACA,OAAOA,cAAc;AACvB;AAEA,IAAIW,OAAO,GAAG,CAAC;AACf,SAASpF,cAAcA,CAAA,EAAG;EACxB,OAAOoF,OAAO,EAAE;AAClB;AAEA,IAAIC,cAAc,GAAG,aAAa;AAClC,SAAShD,eAAeA,CAACD,OAAO,EAAE;EAChC,IAAIkD,gBAAgB,GAAG,CAAClD,OAAO,GAAG,EAAE,EAAEmD,WAAW,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC;EAE1D,IAAIH,cAAc,CAACI,IAAI,CAACH,gBAAgB,CAAC,EAAE;IACzC;IACA;IACA;IACA,OAAO,KAAK;EACd;EAEA,OAAOA,gBAAgB;AACzB;AAEA,SAASI,kBAAkBA,CAACC,GAAG,EAAEvD,OAAO,EAAET,IAAI,EAAEhE,KAAK,EAAE;EACrD,IAAI,CAACA,KAAK,EAAE,OAAOA,KAAK;EACxB,IACEgE,IAAI,KAAK,KAAK,IACbA,IAAI,KAAK,MAAM,IAAI,EAAES,OAAO,KAAK,KAAK,IAAIzE,KAAK,CAAC,CAAC,CAAC,KAAK,GAAG,CAAE,EAC7D;IACA,OAAO,IAAAiI,iCAAa,EAACD,GAAG,EAAEhI,KAAK,CAAC;EAClC,CAAC,MAAM,IAAIgE,IAAI,KAAK,YAAY,IAAIhE,KAAK,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;IACpD,OAAO,IAAAiI,iCAAa,EAACD,GAAG,EAAEhI,KAAK,CAAC;EAClC,CAAC,MAAM,IACLgE,IAAI,KAAK,YAAY,IACrBhE,KAAK,KACJyE,OAAO,KAAK,OAAO,IAAIA,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,IAAI,CAAC,EAC7D;IACA,OAAO,IAAAwD,iCAAa,EAACD,GAAG,EAAEhI,KAAK,CAAC;EAClC,CAAC,MAAM,IAAIgE,IAAI,KAAK,QAAQ,EAAE;IAC5B,OAAO,IAAAkE,2CAAuB,EAACF,GAAG,EAAEhI,KAAK,CAAC;EAC5C,CAAC,MAAM,IAAIgE,IAAI,KAAK,OAAO,EAAE;IAC3B,OAAO,IAAAmE,uCAAmB,EAACnI,KAAK,EAAE,IAAAoI,2BAAO,EAAC,CAAC,CAAC;EAC9C,CAAC,MAAM,IAAI3D,OAAO,KAAK,QAAQ,IAAIT,IAAI,KAAK,MAAM,EAAE;IAClD,OAAO,IAAAiE,iCAAa,EAACD,GAAG,EAAEhI,KAAK,CAAC;EAClC,CAAC,MAAM;IACL,OAAOA,KAAK;EACd;AACF;AAEA,SAAS6F,4BAA4BA,CAAC1B,OAAO,EAAEU,gBAAgB,EAAE7C,OAAO,EAAE;EACxE,IAAI6C,gBAAgB,KAAKG,2BAAgB,CAACC,MAAM,EAAE;IAChD,OAAO,CAAC,CAAC;EACX;EACA,IAAIoD,SAAS,GAAG,CAAC,CAAC;EAClB,IAAI5D,OAAO,GAAGC,eAAe,CAACP,OAAO,CAACM,OAAO,CAAC;EAC9C,IAAIuD,GAAG,GAAG7D,OAAO,CAACmE,aAAa;EAE/B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGpE,OAAO,CAACoB,UAAU,CAACiD,MAAM,EAAED,CAAC,IAAI,CAAC,EAAE;IACrD,IAAIE,SAAS,GAAGtE,OAAO,CAACoB,UAAU,CAACmD,IAAI,CAACH,CAAC,CAAC;IAC1C,IAAI1B,aAAa,GAAG4B,SAAS,CAACzE,IAAI;IAClC,IAAI8C,cAAc,GAAGF,kBAAkB,CACrCzC,OAAO,EACPU,gBAAgB,EAChBgC,aAAa,EACb7E,OAAO,CAACN,aACV,CAAC;IACD,IAAIoF,cAAc,KAAK,IAAI,EAAE;MAC3BuB,SAAS,CAACxB,aAAa,CAAC,GAAGkB,kBAAkB,CAC3CC,GAAG,EACHvD,OAAO,EACPoC,aAAa,EACbC,cACF,CAAC;IACH;EACF;EAEA,IACE3C,OAAO,CAACnE,KAAK,KACZyE,OAAO,KAAK,UAAU,IACrBA,OAAO,KAAK,QAAQ,IACpBA,OAAO,KAAK,QAAQ,IACpBA,OAAO,KAAK,OAAO,CAAC,EACtB;IACA,IAAIkE,SAAS,GAAG,IAAAC,wCAAoB,EAACzE,OAAO,EAAEU,gBAAgB,CAAC;IAC/D,IAAI8D,SAAS,KAAK7H,SAAS,EAAE;MAC3BuH,SAAS,CAACrI,KAAK,GAAG2I,SAAS;IAC7B;EACF;;EAEA;AACF;AACA;EACE,IAAIlE,OAAO,KAAK,QAAQ,IAAII,gBAAgB,KAAKG,2BAAgB,CAAC6D,KAAK,EAAE;IACvE;IACA,IAAIC,aAAa,GAAG3E,OAAO;IAC3B,IAAI2E,aAAa,CAACC,QAAQ,EAAE;MAC1BV,SAAS,CAACU,QAAQ,GAAGD,aAAa,CAACC,QAAQ;IAC7C;EACF;;EAEA;EACA,IAAItE,OAAO,KAAK,MAAM,EAAE;IACtB,IAAIuE,UAAU,GAAGC,KAAK,CAACC,IAAI,CAAClB,GAAG,CAACmB,WAAW,CAAC,CAACC,IAAI,CAAC,UAAUC,CAAC,EAAE;MAC7D,OAAOA,CAAC,CAACC,IAAI,KAAKnF,OAAO,CAACmF,IAAI;IAChC,CAAC,CAAC;IACF,IAAIC,OAAO,GAAG,IAAAC,qCAAiB,EAACR,UAAU,CAAC;IAE3C,IAAIO,OAAO,IAAIP,UAAU,EAAE;MACzBX,SAAS,CAACoB,QAAQ,GAAGF,OAAO;IAC9B;EACF;;EAEA;EACA,IAAI9E,OAAO,KAAK,OAAO,IAAIN,OAAO,CAACuF,KAAK,EAAE;IACxC,IAAIH,OAAO,GAAG,IAAAC,qCAAiB,EAACrF,OAAO,CAACuF,KAAK,CAAC;IAC9C,IAAIH,OAAO,EAAE;MACXlB,SAAS,CAACoB,QAAQ,GAAGF,OAAO;IAC9B;EACF;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAII,YAAY,GAAGxF,OAAO;EAC1B,IACEM,OAAO,KAAK,OAAO,KAClBkF,YAAY,CAACpG,IAAI,KAAK,OAAO,IAAIoG,YAAY,CAACpG,IAAI,KAAK,UAAU,CAAC,EACnE;IACA,IAAIsB,gBAAgB,KAAKG,2BAAgB,CAAC6D,KAAK,EAAE;MAC/CR,SAAS,CAACuB,OAAO,GAAG,CAAC,CAACD,YAAY,CAACC,OAAO;IAC5C,CAAC,MAAM,IAAI,IAAAC,uBAAc,EAACF,YAAY,EAAE9E,gBAAgB,CAAC,EAAE;MACzD,OAAOwD,SAAS,CAACuB,OAAO;IAC1B;EACF;;EAEA;AACF;AACA;EACE,IAAInF,OAAO,KAAK,OAAO,IAAIA,OAAO,KAAK,OAAO,EAAE;IAC9C,IAAIqF,YAAY,GAAG3F,OAAO;IAC1BkE,SAAS,CAAC0B,aAAa,GAAGD,YAAY,CAACE,MAAM,GAAG,QAAQ,GAAG,QAAQ;EACrE;;EAEA;AACF;AACA;EACE,IAAIC,SAAS;EACb,IAAIC,UAAU;EACd,IAAIvI,oBAAoB,GAAGK,OAAO,CAACL,oBAAoB;EACvD,QAAQA,oBAAoB,CAACwI,MAAM;IACjC,KAAKhJ,0BAA0B,CAACC,qBAAqB;MACnD6I,SAAS,GAAGG,IAAI,CAACC,KAAK,CAAClG,OAAO,CAAC8F,SAAS,CAAC;MACzCC,UAAU,GAAGE,IAAI,CAACC,KAAK,CAAClG,OAAO,CAAC+F,UAAU,CAAC;MAC3C,IAAID,SAAS,IAAIC,UAAU,EAAE;QAC3BvI,oBAAoB,CAAC2I,uBAAuB,CAACC,GAAG,CAACpG,OAAO,EAAE;UACxD8F,SAAS,EAAEA,SAAS;UACpBC,UAAU,EAAEA;QACd,CAAC,CAAC;MACJ;MACA;IACF,KAAK/I,0BAA0B,CAACE,wBAAwB;MACtD,IAAIM,oBAAoB,CAAC2I,uBAAuB,CAACE,GAAG,CAACrG,OAAO,CAAC,EAAE;QAC7D,IAAMsG,MAAM,GAAG9I,oBAAoB,CAAC2I,uBAAuB,CAACI,GAAG,CAACvG,OAAO,CAAC;QACxE8F,SAAS,GAAGQ,MAAM,CAACR,SAAS;QAC5BC,UAAU,GAAGO,MAAM,CAACP,UAAU;MAChC;MACA;EACJ;EACA,IAAIA,UAAU,EAAE;IACd7B,SAAS,CAACsC,aAAa,GAAGT,UAAU;EACtC;EACA,IAAID,SAAS,EAAE;IACb5B,SAAS,CAACuC,YAAY,GAAGX,SAAS;EACpC;EAEA,OAAO5B,SAAS;AAClB","ignoreList":[]}