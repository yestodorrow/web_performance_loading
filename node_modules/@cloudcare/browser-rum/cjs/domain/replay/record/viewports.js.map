{"version":3,"file":"viewports.js","names":["TOLERANCE","isVisualViewportFactoredIn","visual","window","visualViewport","Math","abs","pageTop","offsetTop","scrollY","pageLeft","offsetLeft","scrollX","convertMouseEventToLayoutCoordinates","clientX","clientY","normalised","layoutViewportX","layoutViewportY","visualViewportX","visualViewportY","round","exports","getVisualViewport","scale","height","width"],"sources":["../../../../src/domain/replay/record/viewports.js"],"sourcesContent":["/**\n * Browsers have not standardized various dimension properties. Mobile devices typically report\n * dimensions in reference to the visual viewport, while desktop uses the layout viewport. For example,\n * Mobile Chrome will change innerWidth when a pinch zoom takes place, while Chrome Desktop (mac) will not.\n *\n * With the new Viewport API, we now calculate and normalize dimension properties to the layout viewport.\n * If the VisualViewport API is not supported by a browser, it isn't reasonably possible to detect or normalize\n * which viewport is being measured. Therefore these exported functions will fallback to assuming that the layout\n * viewport is being measured by the browser\n */\n\n// Scrollbar widths vary across properties on different devices and browsers\nvar TOLERANCE = 25\n\n/**\n * Use the Visual Viewport API's properties to measure scrollX/Y in reference to the layout viewport\n * in order to determine if window.scrollX/Y is measuring the layout or visual viewport.\n * This finding corresponds to which viewport mouseEvent.clientX/Y and window.innerWidth/Height measures.\n */\nfunction isVisualViewportFactoredIn() {\n  var visual = window.visualViewport\n  return (\n    Math.abs(visual.pageTop - visual.offsetTop - window.scrollY) > TOLERANCE ||\n    Math.abs(visual.pageLeft - visual.offsetLeft - window.scrollX) > TOLERANCE\n  )\n}\n\nexport var convertMouseEventToLayoutCoordinates = function (clientX, clientY) {\n  var visual = window.visualViewport\n  var normalised = {\n    layoutViewportX: clientX,\n    layoutViewportY: clientY,\n    visualViewportX: clientX,\n    visualViewportY: clientY\n  }\n\n  if (!visual) {\n    // On old browsers, we cannot normalise, so fallback to clientX/Y\n    return normalised\n  } else if (isVisualViewportFactoredIn()) {\n    // Typically Mobile Devices\n    normalised.layoutViewportX = Math.round(clientX + visual.offsetLeft)\n    normalised.layoutViewportY = Math.round(clientY + visual.offsetTop)\n  } else {\n    // Typically Desktop Devices\n    normalised.visualViewportX = Math.round(clientX - visual.offsetLeft)\n    normalised.visualViewportY = Math.round(clientY - visual.offsetTop)\n  }\n  return normalised\n}\n\nexport var getVisualViewport = function () {\n  var visual = window.visualViewport\n  return {\n    scale: visual.scale,\n    offsetLeft: visual.offsetLeft,\n    offsetTop: visual.offsetTop,\n    pageLeft: visual.pageLeft,\n    pageTop: visual.pageTop,\n    height: visual.height,\n    width: visual.width\n  }\n}\n"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,IAAIA,SAAS,GAAG,EAAE;;AAElB;AACA;AACA;AACA;AACA;AACA,SAASC,0BAA0BA,CAAA,EAAG;EACpC,IAAIC,MAAM,GAAGC,MAAM,CAACC,cAAc;EAClC,OACEC,IAAI,CAACC,GAAG,CAACJ,MAAM,CAACK,OAAO,GAAGL,MAAM,CAACM,SAAS,GAAGL,MAAM,CAACM,OAAO,CAAC,GAAGT,SAAS,IACxEK,IAAI,CAACC,GAAG,CAACJ,MAAM,CAACQ,QAAQ,GAAGR,MAAM,CAACS,UAAU,GAAGR,MAAM,CAACS,OAAO,CAAC,GAAGZ,SAAS;AAE9E;AAEO,IAAIa,oCAAoC,GAAG,SAAvCA,oCAAoCA,CAAaC,OAAO,EAAEC,OAAO,EAAE;EAC5E,IAAIb,MAAM,GAAGC,MAAM,CAACC,cAAc;EAClC,IAAIY,UAAU,GAAG;IACfC,eAAe,EAAEH,OAAO;IACxBI,eAAe,EAAEH,OAAO;IACxBI,eAAe,EAAEL,OAAO;IACxBM,eAAe,EAAEL;EACnB,CAAC;EAED,IAAI,CAACb,MAAM,EAAE;IACX;IACA,OAAOc,UAAU;EACnB,CAAC,MAAM,IAAIf,0BAA0B,CAAC,CAAC,EAAE;IACvC;IACAe,UAAU,CAACC,eAAe,GAAGZ,IAAI,CAACgB,KAAK,CAACP,OAAO,GAAGZ,MAAM,CAACS,UAAU,CAAC;IACpEK,UAAU,CAACE,eAAe,GAAGb,IAAI,CAACgB,KAAK,CAACN,OAAO,GAAGb,MAAM,CAACM,SAAS,CAAC;EACrE,CAAC,MAAM;IACL;IACAQ,UAAU,CAACG,eAAe,GAAGd,IAAI,CAACgB,KAAK,CAACP,OAAO,GAAGZ,MAAM,CAACS,UAAU,CAAC;IACpEK,UAAU,CAACI,eAAe,GAAGf,IAAI,CAACgB,KAAK,CAACN,OAAO,GAAGb,MAAM,CAACM,SAAS,CAAC;EACrE;EACA,OAAOQ,UAAU;AACnB,CAAC;AAAAM,OAAA,CAAAT,oCAAA,GAAAA,oCAAA;AAEM,IAAIU,iBAAiB,GAAG,SAApBA,iBAAiBA,CAAA,EAAe;EACzC,IAAIrB,MAAM,GAAGC,MAAM,CAACC,cAAc;EAClC,OAAO;IACLoB,KAAK,EAAEtB,MAAM,CAACsB,KAAK;IACnBb,UAAU,EAAET,MAAM,CAACS,UAAU;IAC7BH,SAAS,EAAEN,MAAM,CAACM,SAAS;IAC3BE,QAAQ,EAAER,MAAM,CAACQ,QAAQ;IACzBH,OAAO,EAAEL,MAAM,CAACK,OAAO;IACvBkB,MAAM,EAAEvB,MAAM,CAACuB,MAAM;IACrBC,KAAK,EAAExB,MAAM,CAACwB;EAChB,CAAC;AACH,CAAC;AAAAJ,OAAA,CAAAC,iBAAA,GAAAA,iBAAA","ignoreList":[]}