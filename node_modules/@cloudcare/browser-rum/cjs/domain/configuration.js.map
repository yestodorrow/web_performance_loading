{"version":3,"file":"configuration.js","names":["_browserCore","require","_buildEnv","_tracer","validateAndBuildRumConfiguration","initConfiguration","applicationId","display","error","requireParamsValidate","validatePostRequestRequireParamsConfiguration","sessionReplaySampleRate","undefined","isPercentage","allowedTracingUrls","validateAndBuildTracingOptions","tracingSampleRate","excludedActivityUrls","isArray","baseConfiguration","validateAndBuildConfiguration","trackUserInteractions","isNullUndefinedDefaultValue","trackInteractions","assign","actionNameAttribute","trackViewsManually","traceType","TraceType","DDTRACE","traceId128Bit","defaultPrivacyLevel","objectHasValue","DefaultPrivacyLevel","MASK_USER_INPUT","buildEnv","allowedTracingOrigins","warn","tracingOptions","each","option","isMatchOption","push","match","isTracingOption","legacyMatchOption","tracingOption","convertLegacyMatchOptionToTracingOption","allowedDDTracingOrigins","item","RegExp","url","test","getOrigin"],"sources":["../../src/domain/configuration.js"],"sourcesContent":["import {\n  assign,\n  display,\n  isPercentage,\n  validateAndBuildConfiguration,\n  validatePostRequestRequireParamsConfiguration,\n  isArray,\n  TraceType,\n  isNullUndefinedDefaultValue,\n  DefaultPrivacyLevel,\n  objectHasValue,\n  isMatchOption,\n  getOrigin,\n  each\n} from '@cloudcare/browser-core'\nimport { buildEnv } from '../boot/buildEnv'\nimport { isTracingOption } from '../domain/tracing/tracer'\n\nexport function validateAndBuildRumConfiguration(initConfiguration) {\n  if (!initConfiguration.applicationId) {\n    display.error(\n      'Application ID is not configured, no RUM data will be collected.'\n    )\n    return\n  }\n  var requireParamsValidate =\n    validatePostRequestRequireParamsConfiguration(initConfiguration)\n  if (!requireParamsValidate) return\n  // TODO remove fallback in next major\n  if (\n    initConfiguration.sessionReplaySampleRate !== undefined &&\n    !isPercentage(initConfiguration.sessionReplaySampleRate)\n  ) {\n    display.error('Premium Sample Rate should be a number between 0 and 100')\n    return\n  }\n  var allowedTracingUrls = validateAndBuildTracingOptions(initConfiguration)\n  if (!allowedTracingUrls) {\n    return\n  }\n  //   if (initConfiguration.allowedTracingOrigins !== undefined) {\n  //     if (!isArray(initConfiguration.allowedTracingOrigins)) {\n  //       display.error('Allowed Tracing Origins should be an array')\n  //       return\n  //     }\n  //   }\n  //   if (initConfiguration.allowedDDTracingOrigins !== undefined) {\n  //     if (!isArray(initConfiguration.allowedDDTracingOrigins)) {\n  //       display.error('Allowed Tracing Origins should be an array')\n  //       return\n  //     }\n  //   }\n  if (\n    initConfiguration.tracingSampleRate !== undefined &&\n    !isPercentage(initConfiguration.tracingSampleRate)\n  ) {\n    display.error('Tracing Sample Rate should be a number between 0 and 100')\n    return\n  }\n  if (\n    initConfiguration.excludedActivityUrls !== undefined &&\n    !isArray(initConfiguration.excludedActivityUrls)\n  ) {\n    display.error('Excluded Activity Urls should be an array')\n    return\n  }\n\n  var baseConfiguration = validateAndBuildConfiguration(initConfiguration)\n  if (!baseConfiguration) {\n    return\n  }\n  var trackUserInteractions = !!isNullUndefinedDefaultValue(\n    initConfiguration.trackUserInteractions,\n    initConfiguration.trackInteractions\n  )\n\n  return assign(\n    {\n      applicationId: initConfiguration.applicationId,\n      actionNameAttribute: initConfiguration.actionNameAttribute,\n      sessionReplaySampleRate: isNullUndefinedDefaultValue(\n        initConfiguration.sessionReplaySampleRate,\n        100\n      ),\n      tracingSampleRate: initConfiguration.tracingSampleRate,\n      allowedTracingUrls: allowedTracingUrls,\n      excludedActivityUrls: isNullUndefinedDefaultValue(\n        initConfiguration.excludedActivityUrls,\n        []\n      ),\n      trackUserInteractions: trackUserInteractions,\n      trackViewsManually: !!initConfiguration.trackViewsManually,\n      traceType: isNullUndefinedDefaultValue(\n        initConfiguration.traceType,\n        TraceType.DDTRACE\n      ),\n      traceId128Bit: !!initConfiguration.traceId128Bit,\n      defaultPrivacyLevel: objectHasValue(\n        DefaultPrivacyLevel,\n        initConfiguration.defaultPrivacyLevel\n      )\n        ? initConfiguration.defaultPrivacyLevel\n        : DefaultPrivacyLevel.MASK_USER_INPUT\n    },\n    baseConfiguration,\n    buildEnv\n  )\n}\n/**\n * Handles allowedTracingUrls and processes legacy allowedTracingOrigins\n */\nfunction validateAndBuildTracingOptions(initConfiguration) {\n  // Advise about parameters precedence.\n  if (\n    initConfiguration.allowedTracingUrls !== undefined &&\n    initConfiguration.allowedTracingOrigins !== undefined\n  ) {\n    display.warn(\n      'Both allowedTracingUrls and allowedTracingOrigins (deprecated) have been defined. The parameter allowedTracingUrls will override allowedTracingOrigins.'\n    )\n  }\n  // Handle allowedTracingUrls first\n  if (initConfiguration.allowedTracingUrls !== undefined) {\n    if (!isArray(initConfiguration.allowedTracingUrls)) {\n      display.error('Allowed Tracing URLs should be an array')\n      return\n    }\n    // if (initConfiguration.allowedTracingUrls.length !== 0 && initConfiguration.service === undefined) {\n    //   display.error('Service needs to be configured when tracing is enabled')\n    //   return\n    // }\n    // Convert from (MatchOption | TracingOption) to TracingOption, remove unknown properties\n    var tracingOptions = []\n    each(initConfiguration.allowedTracingUrls, function (option) {\n      if (isMatchOption(option)) {\n        tracingOptions.push({\n          match: option,\n          traceType: isNullUndefinedDefaultValue(\n            initConfiguration.traceType,\n            TraceType.DDTRACE\n          )\n        })\n      } else if (isTracingOption(option)) {\n        tracingOptions.push(option)\n      } else {\n        display.warn(\n          'Allowed Tracing Urls parameters should be a string, RegExp, function, or an object. Ignoring parameter',\n          option\n        )\n      }\n    })\n    return tracingOptions\n  }\n\n  // Handle conversion of allowedTracingOrigins to allowedTracingUrls\n  if (initConfiguration.allowedTracingOrigins !== undefined) {\n    if (!isArray(initConfiguration.allowedTracingOrigins)) {\n      display.error('Allowed Tracing Origins should be an array')\n      return\n    }\n\n    var tracingOptions = []\n    each(initConfiguration.allowedTracingOrigins, function (legacyMatchOption) {\n      var tracingOption = convertLegacyMatchOptionToTracingOption(\n        legacyMatchOption,\n        isNullUndefinedDefaultValue(\n          initConfiguration.traceType,\n          TraceType.DDTRACE\n        )\n      )\n      if (tracingOption) {\n        tracingOptions.push(tracingOption)\n      }\n    })\n\n    return tracingOptions\n  }\n  // Handle conversion of allowedDDTracingOrigins to allowedTracingUrls\n  if (initConfiguration.allowedDDTracingOrigins !== undefined) {\n    if (!isArray(initConfiguration.allowedDDTracingOrigins)) {\n      display.error('Allowed Tracing Origins should be an array')\n      return\n    }\n\n    var tracingOptions = []\n    each(\n      initConfiguration.allowedDDTracingOrigins,\n      function (legacyMatchOption) {\n        var tracingOption = convertLegacyMatchOptionToTracingOption(\n          legacyMatchOption,\n          isNullUndefinedDefaultValue(\n            initConfiguration.traceType,\n            TraceType.DDTRACE\n          )\n        )\n        if (tracingOption) {\n          tracingOptions.push(tracingOption)\n        }\n      }\n    )\n\n    return tracingOptions\n  }\n\n  return []\n}\n\n/**\n * Converts parameters from the deprecated allowedTracingOrigins\n * to allowedTracingUrls. Handles the change from origin to full URLs.\n */\nfunction convertLegacyMatchOptionToTracingOption(item, traceType) {\n  var match\n  if (typeof item === 'string') {\n    match = item\n  } else if (item instanceof RegExp) {\n    match = function (url) {\n      return item.test(getOrigin(url))\n    }\n  } else if (typeof item === 'function') {\n    match = function (url) {\n      return item(getOrigin(url))\n    }\n  }\n\n  if (match === undefined) {\n    display.warn(\n      'Allowed Tracing Origins parameters should be a string, RegExp or function. Ignoring parameter',\n      item\n    )\n    return undefined\n  }\n\n  return { match: match, traceType: traceType }\n}\n"],"mappings":"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","ignoreList":[]}