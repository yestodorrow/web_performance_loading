{"version":3,"file":"batch.js","names":["_display","require","_tools","_rowData","_dataMap","_enums","_byteUtils","_pageExitObservable","_jsonStringify","HAS_MULTI_BYTES_CHARACTERS","CUSTOM_KEYS","processedMessageByDataMap","message","type","rowStr","rowData","undefined","tags","fields","hasFileds","each","dataMap","value","key","measurement","tagsStr","extend","commonTags","filterFileds","value_path","_key","_value","findByPath","push","isNumber","escapeJsonValue","escapeRowData","fieldsStr","commonFields","isArray","length","_valueData","escapeRowField","isString","context","isObject","isEmptyObject","_tagKeys","indexOf","RumEventType","LOGGER","join","date","time","exports","batch","request","flushController","messageBytesLimit","sendContentTypeByJson","pushOnlyBuffer","upsertBuffer","_this","flushObservable","subscribe","event","flush","prototype","add","addOrUpdate","upsert","messages","concat","values","payloadData","payload","data","bytesCount","flushReason","reason","isPageExitReason","sendOnExit","send","_process","process","processedMessage","messageBytesCount","display","warn","hasMessageFor","remove","jsonStringify","computeBytesCount","separatorBytesCount","getMessagesCount","notifyBeforeAddMessage","notifyAfterAddMessage","removedMessage","notifyAfterRemoveMessage","Batch"],"sources":["../../src/transport/batch.js"],"sourcesContent":["import { display } from '../helper/display'\nimport {\n  values,\n  findByPath,\n  each,\n  isNumber,\n  isArray,\n  extend,\n  isString,\n  isEmptyObject,\n  isObject\n} from '../helper/tools'\nimport {\n  escapeJsonValue,\n  escapeRowField,\n  escapeRowData\n} from '../helper/serialisation/rowData'\nimport { commonTags, dataMap, commonFields } from '../dataMap'\nimport { RumEventType } from '../helper/enums'\nimport { computeBytesCount } from '../helper/byteUtils'\nimport { isPageExitReason } from '../browser/pageExitObservable'\nimport { jsonStringify } from '../helper/serialisation/jsonStringify'\n// https://en.wikipedia.org/wiki/UTF-8\n// eslint-disable-next-line no-control-regex\nvar HAS_MULTI_BYTES_CHARACTERS = /[^\\u0000-\\u007F]/\nvar CUSTOM_KEYS = 'custom_keys'\nexport var processedMessageByDataMap = function (message) {\n  if (!message || !message.type)\n    return {\n      rowStr: '',\n      rowData: undefined\n    }\n\n  var rowData = { tags: {}, fields: {} }\n  var hasFileds = false\n  var rowStr = ''\n  each(dataMap, function (value, key) {\n    if (value.type === message.type) {\n      rowStr += key + ','\n      rowData.measurement = key\n      var tagsStr = []\n      var tags = extend({}, commonTags, value.tags)\n      var filterFileds = ['date', 'type', CUSTOM_KEYS] // 已经在datamap中定义过的fields和tags\n      each(tags, function (value_path, _key) {\n        var _value = findByPath(message, value_path)\n        filterFileds.push(_key)\n        if (_value || isNumber(_value)) {\n          rowData.tags[_key] = escapeJsonValue(_value, true)\n          tagsStr.push(escapeRowData(_key) + '=' + escapeRowData(_value))\n        }\n      })\n\n      var fieldsStr = []\n      var fields = extend({}, commonFields, value.fields)\n      each(fields, function (_value, _key) {\n        if (isArray(_value) && _value.length === 2) {\n          var value_path = _value[1]\n          var _valueData = findByPath(message, value_path)\n          filterFileds.push(_key)\n          if (_valueData !== undefined && _valueData !== null) {\n            rowData.fields[_key] = escapeJsonValue(_valueData) // 这里不需要转译\n            fieldsStr.push(\n              escapeRowData(_key) + '=' + escapeRowField(_valueData)\n            )\n          }\n        } else if (isString(_value)) {\n          var _valueData = findByPath(message, _value)\n          filterFileds.push(_key)\n          if (_valueData !== undefined && _valueData !== null) {\n            rowData.fields[_key] = escapeJsonValue(_valueData) // 这里不需要转译\n            fieldsStr.push(\n              escapeRowData(_key) + '=' + escapeRowField(_valueData)\n            )\n          }\n        }\n      })\n      if (\n        message.context &&\n        isObject(message.context) &&\n        !isEmptyObject(message.context)\n      ) {\n        // 自定义tag， 存储成field\n        var _tagKeys = []\n        each(message.context, function (_value, _key) {\n          // 如果和之前tag重名，则舍弃\n          if (filterFileds.indexOf(_key) > -1) return\n          filterFileds.push(_key)\n          if (_value !== undefined && _value !== null) {\n            _tagKeys.push(_key)\n            rowData.fields[_key] = escapeJsonValue(_value) // 这里不需要转译\n            fieldsStr.push(escapeRowData(_key) + '=' + escapeRowField(_value))\n          }\n        })\n        if (_tagKeys.length) {\n          rowData.fields[CUSTOM_KEYS] = escapeJsonValue(_tagKeys)\n          fieldsStr.push(\n            escapeRowData(CUSTOM_KEYS) + '=' + escapeRowField(_tagKeys)\n          )\n        }\n      }\n      if (message.type === RumEventType.LOGGER) {\n        // 这里处理日志类型数据自定义字段\n        each(message, function (value, key) {\n          if (\n            filterFileds.indexOf(key) === -1 &&\n            value !== undefined &&\n            value !== null\n          ) {\n            rowData.fields[key] = escapeJsonValue(value) // 这里不需要转译\n            fieldsStr.push(escapeRowData(key) + '=' + escapeRowField(value))\n          }\n        })\n      }\n      if (tagsStr.length) {\n        rowStr += tagsStr.join(',')\n      }\n      if (fieldsStr.length) {\n        rowStr += ' '\n        rowStr += fieldsStr.join(',')\n        hasFileds = true\n      }\n      rowStr = rowStr + ' ' + message.date\n      rowData.time = message.date // 这里不需要转译\n    }\n  })\n  return {\n    rowStr: hasFileds ? rowStr : '',\n    rowData: hasFileds ? rowData : undefined\n  }\n}\nvar batch = function (\n  request,\n  flushController,\n  messageBytesLimit,\n  sendContentTypeByJson\n) {\n  this.pushOnlyBuffer = []\n  this.upsertBuffer = {}\n  this.request = request\n  this.flushController = flushController\n  this.messageBytesLimit = messageBytesLimit\n  this.sendContentTypeByJson = sendContentTypeByJson\n  var _this = this\n  this.flushController.flushObservable.subscribe(function (event) {\n    _this.flush(event)\n  })\n}\nbatch.prototype.add = function (message) {\n  this.addOrUpdate(message)\n}\nbatch.prototype.upsert = function (message, key) {\n  this.addOrUpdate(message, key)\n}\nbatch.prototype.flush = function (event) {\n  var messages = this.pushOnlyBuffer.concat(values(this.upsertBuffer))\n  this.pushOnlyBuffer = []\n  this.upsertBuffer = {}\n  if (messages.length > 0) {\n    var payloadData = ''\n    if (this.sendContentTypeByJson) {\n      payloadData = '[' + messages.join(',') + ']'\n    } else {\n      payloadData = messages.join('\\n')\n    }\n    var payload = {\n      data: payloadData,\n      bytesCount: event.bytesCount,\n      flushReason: event.reason\n    }\n    if (isPageExitReason(event.reason)) {\n      this.request.sendOnExit(payload)\n    } else {\n      this.request.send(payload)\n    }\n  }\n}\n\nbatch.prototype.addOrUpdate = function (message, key) {\n  var _process = this.process(message)\n  var processedMessage = _process.processedMessage\n  var messageBytesCount = _process.messageBytesCount\n  if (messageBytesCount >= this.messageBytesLimit) {\n    display.warn(\n      'Discarded a message whose size was bigger than the maximum allowed size ' +\n        this.messageBytesLimit +\n        'KB.'\n    )\n    return\n  }\n  if (this.hasMessageFor(key)) {\n    this.remove(key)\n  }\n  this.push(processedMessage, messageBytesCount, key)\n}\nbatch.prototype.process = function (message) {\n  var processedMessage = ''\n  if (this.sendContentTypeByJson) {\n    processedMessage = jsonStringify(processedMessageByDataMap(message).rowData)\n  } else {\n    processedMessage = processedMessageByDataMap(message).rowStr\n  }\n  var messageBytesCount = computeBytesCount(processedMessage)\n  return {\n    processedMessage: processedMessage,\n    messageBytesCount: messageBytesCount\n  }\n}\n\nbatch.prototype.push = function (processedMessage, messageBytesCount, key) {\n  var separatorBytesCount = this.flushController.getMessagesCount() > 0 ? 1 : 0\n  this.flushController.notifyBeforeAddMessage(\n    messageBytesCount + separatorBytesCount\n  )\n  if (key !== undefined) {\n    this.upsertBuffer[key] = processedMessage\n  } else {\n    this.pushOnlyBuffer.push(processedMessage)\n  }\n  this.flushController.notifyAfterAddMessage()\n}\n\nbatch.prototype.remove = function (key) {\n  var removedMessage = this.upsertBuffer[key]\n  delete this.upsertBuffer[key]\n  var messageBytesCount = computeBytesCount(removedMessage)\n  // If there are other messages, a '\\n' will be added at serialization\n  var separatorBytesCount = this.flushController.getMessagesCount() > 1 ? 1 : 0\n  this.flushController.notifyAfterRemoveMessage(\n    messageBytesCount + separatorBytesCount\n  )\n}\n\nbatch.prototype.hasMessageFor = function (key) {\n  return key !== undefined && this.upsertBuffer[key] !== undefined\n}\nexport var Batch = batch\n"],"mappings":"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","ignoreList":[]}