{"version":3,"file":"cookie.js","names":["_tools","require","COOKIE_ACCESS_DELAY","ONE_SECOND","exports","setCookie","name","value","expireDelay","options","date","Date","setTime","getTime","expires","toUTCString","sameSite","crossSite","domain","secure","partitioned","document","cookie","getCookie","findCommaSeparatedValue","initCookieParsed","getInitCookie","findCommaSeparatedValues","get","resetInitCookies","undefined","deleteCookie","areCookiesAuthorized","testCookieName","concat","UUID","testCookieValue","error","getCurrentSiteCache","getCurrentSite","domainLevels","window","location","hostname","split","candidateDomain","pop","length"],"sources":["../../src/browser/cookie.js"],"sourcesContent":["import {\n  findCommaSeparatedValue,\n  UUID,\n  ONE_SECOND,\n  findCommaSeparatedValues\n} from '../helper/tools'\nexport var COOKIE_ACCESS_DELAY = ONE_SECOND\n\nexport function setCookie(name, value, expireDelay, options) {\n  var date = new Date()\n  date.setTime(date.getTime() + expireDelay)\n  var expires = 'expires=' + date.toUTCString()\n  var sameSite = options && options.crossSite ? 'none' : 'strict'\n  var domain = options && options.domain ? ';domain=' + options.domain : ''\n  var secure = options && options.secure ? ';secure' : ''\n  var partitioned = options && options.partitioned ? ';partitioned' : ''\n  document.cookie =\n    name +\n    '=' +\n    value +\n    ';' +\n    expires +\n    ';path=/;samesite=' +\n    sameSite +\n    domain +\n    secure +\n    partitioned\n}\n\nexport function getCookie(name) {\n  return findCommaSeparatedValue(document.cookie, name)\n}\nvar initCookieParsed\n/**\n * Returns a cached value of the cookie. Use this during SDK initialization (and whenever possible)\n * to avoid accessing document.cookie multiple times.\n */\nexport function getInitCookie(name) {\n  if (!initCookieParsed) {\n    initCookieParsed = findCommaSeparatedValues(document.cookie)\n  }\n  return initCookieParsed.get(name)\n}\n\nexport function resetInitCookies() {\n  initCookieParsed = undefined\n}\nexport function deleteCookie(name, options) {\n  setCookie(name, '', 0, options)\n}\n\nexport function areCookiesAuthorized(options) {\n  if (document.cookie === undefined || document.cookie === null) {\n    return false\n  }\n  try {\n    // Use a unique cookie name to avoid issues when the SDK is initialized multiple times during\n    // the test cookie lifetime\n    var testCookieName = `gc_cookie_test_${UUID()}`\n    var testCookieValue = 'test'\n    setCookie(testCookieName, testCookieValue, ONE_SECOND, options)\n    return getCookie(testCookieName) === testCookieValue\n  } catch (error) {\n    return false\n  }\n}\n\n/**\n * No API to retrieve it, number of levels for subdomain and suffix are unknown\n * strategy: find the minimal domain on which cookies are allowed to be set\n * https://web.dev/same-site-same-origin/#site\n */\nvar getCurrentSiteCache\nexport function getCurrentSite() {\n  if (getCurrentSiteCache === undefined) {\n    // Use a unique cookie name to avoid issues when the SDK is initialized multiple times during\n    // the test cookie lifetime\n    var testCookieName = `gc_site_test_${UUID()}`\n    var testCookieValue = 'test'\n\n    var domainLevels = window.location.hostname.split('.')\n    var candidateDomain = domainLevels.pop()\n    while (domainLevels.length && !getCookie(testCookieName)) {\n      candidateDomain = domainLevels.pop() + '.' + candidateDomain\n      setCookie(testCookieName, testCookieValue, ONE_SECOND, {\n        domain: candidateDomain\n      })\n    }\n    getCurrentSiteCache = candidateDomain\n  }\n  return getCurrentSiteCache\n}\n"],"mappings":"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","ignoreList":[]}