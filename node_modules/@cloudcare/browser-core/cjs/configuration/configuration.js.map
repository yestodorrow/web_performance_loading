{"version":3,"file":"configuration.js","names":["_cookie","require","_catchUserErrors","_display","_tools","_byteUtils","_transportConfiguration","DefaultPrivacyLevel","ALLOW","MASK","MASK_USER_INPUT","exports","validateAndBuildConfiguration","initConfiguration","sampleRate","undefined","isPercentage","display","error","sessionSampleRate","telemetrySampleRate","assign","beforeSend","catchUserErrors","cookieOptions","buildCookieOptions","isNullUndefinedDefaultValue","service","version","env","telemetryEnabled","silentMultipleInit","batchBytesLimit","ONE_KIBI_BYTE","eventRateLimiterThreshold","maxTelemetryEventsPerPage","flushTimeout","ONE_SECOND","batchMessagesLimit","messageBytesLimit","resourceUrlLimit","storeContextsToLocal","sendContentTypeByJson","computeTransportConfiguration","validatePostRequestRequireParamsConfiguration","site","datakitOrigin","datakitUrl","clientToken","secure","useSecureSessionCookie","usePartitionedCrossSiteSessionCookie","useCrossSiteSessionCookie","crossSite","partitioned","trackSessionAcrossSubdomains","domain","getCurrentSite"],"sources":["../../src/configuration/configuration.js"],"sourcesContent":["import { getCurrentSite } from '../browser/cookie'\nimport { catchUserErrors } from '../helper/catchUserErrors'\nimport { display } from '../helper/display'\nimport {\n  assign,\n  isPercentage,\n  ONE_SECOND,\n  isNullUndefinedDefaultValue\n} from '../helper/tools'\nimport { ONE_KIBI_BYTE } from '../helper/byteUtils'\nimport { computeTransportConfiguration } from './transportConfiguration'\n\nexport var DefaultPrivacyLevel = {\n  ALLOW: 'allow',\n  MASK: 'mask',\n  MASK_USER_INPUT: 'mask-user-input'\n}\nexport function validateAndBuildConfiguration(initConfiguration) {\n  if (\n    initConfiguration.sampleRate !== undefined &&\n    !isPercentage(initConfiguration.sampleRate)\n  ) {\n    display.error('Sample Rate should be a number between 0 and 100')\n    return\n  }\n  if (\n    initConfiguration.sessionSampleRate !== undefined &&\n    !isPercentage(initConfiguration.sessionSampleRate)\n  ) {\n    display.error('Sample Rate should be a number between 0 and 100')\n    return\n  }\n  if (\n    initConfiguration.telemetrySampleRate !== undefined &&\n    !isPercentage(initConfiguration.telemetrySampleRate)\n  ) {\n    display.error('Telemetry Sample Rate should be a number between 0 and 100')\n    return\n  }\n  var sessionSampleRate =\n    initConfiguration.sessionSampleRate || initConfiguration.sampleRate\n  return assign(\n    {\n      beforeSend:\n        initConfiguration.beforeSend &&\n        catchUserErrors(\n          initConfiguration.beforeSend,\n          'beforeSend threw an error:'\n        ),\n      cookieOptions: buildCookieOptions(initConfiguration),\n      sessionSampleRate: isNullUndefinedDefaultValue(sessionSampleRate, 100),\n      service: initConfiguration.service,\n      version: initConfiguration.version,\n      env: initConfiguration.env,\n      telemetrySampleRate: isNullUndefinedDefaultValue(\n        initConfiguration.telemetrySampleRate,\n        100\n      ),\n      telemetryEnabled: isNullUndefinedDefaultValue(\n        initConfiguration.telemetryEnabled,\n        false\n      ),\n      silentMultipleInit: !!initConfiguration.silentMultipleInit,\n\n      /**\n       * beacon payload max queue size implementation is 64kb\n       * ensure that we leave room for logs, rum and potential other users\n       */\n      batchBytesLimit: 16 * ONE_KIBI_BYTE,\n\n      eventRateLimiterThreshold: 3000,\n      maxTelemetryEventsPerPage: 15,\n\n      /**\n       * flush automatically, aim to be lower than ALB connection timeout\n       * to maximize connection reuse.\n       */\n      flushTimeout: 30 * ONE_SECOND,\n\n      /**\n       * Logs intake limit\n       */\n      batchMessagesLimit: 50,\n      messageBytesLimit: 256 * ONE_KIBI_BYTE,\n      resourceUrlLimit: 5 * ONE_KIBI_BYTE,\n      storeContextsToLocal: !!initConfiguration.storeContextsToLocal,\n      sendContentTypeByJson: !!initConfiguration.sendContentTypeByJson\n    },\n    computeTransportConfiguration(initConfiguration)\n  )\n}\nexport function validatePostRequestRequireParamsConfiguration(\n  initConfiguration\n) {\n  if (\n    !initConfiguration.site &&\n    !initConfiguration.datakitOrigin &&\n    !initConfiguration.datakitUrl\n  ) {\n    display.error(\n      'datakitOrigin or site is not configured, no RUM data will be collected.'\n    )\n    return false\n  }\n  //   if (!initConfiguration.datakitUrl && !initConfiguration.datakitOrigin) {\n  //     display.error(\n  //       'datakitOrigin is not configured, no RUM data will be collected.'\n  //     )\n  //     return false\n  //   }\n  if (initConfiguration.site && !initConfiguration.clientToken) {\n    display.error(\n      'clientToken is not configured, no RUM data will be collected.'\n    )\n    return false\n  }\n  return true\n}\nexport function buildCookieOptions(initConfiguration) {\n  var cookieOptions = {}\n\n  //   cookieOptions.secure = mustUseSecureCookie(initConfiguration)\n  //   cookieOptions.crossSite = !!initConfiguration.useCrossSiteSessionCookie\n  cookieOptions.secure =\n    !!initConfiguration.useSecureSessionCookie ||\n    !!initConfiguration.usePartitionedCrossSiteSessionCookie ||\n    !!initConfiguration.useCrossSiteSessionCookie\n  cookieOptions.crossSite =\n    !!initConfiguration.usePartitionedCrossSiteSessionCookie ||\n    !!initConfiguration.useCrossSiteSessionCookie\n  cookieOptions.partitioned =\n    !!initConfiguration.usePartitionedCrossSiteSessionCookie\n  if (initConfiguration.trackSessionAcrossSubdomains) {\n    cookieOptions.domain = getCurrentSite()\n  }\n\n  return cookieOptions\n}\n\n// function mustUseSecureCookie(initConfiguration) {\n//   return (\n//     !!initConfiguration.useSecureSessionCookie ||\n//     !!initConfiguration.useCrossSiteSessionCookie\n//   )\n// }\n"],"mappings":"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","ignoreList":[]}