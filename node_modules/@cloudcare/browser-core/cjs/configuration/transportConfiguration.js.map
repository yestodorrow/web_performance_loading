{"version":3,"file":"transportConfiguration.js","names":["_tools","require","TRIM_REGIX","typeMap","rum","log","sessionReplay","getEndPointUrl","configuration","type","subUrl","url","datakitOrigin","datakitUrl","site","indexOf","location","origin","trim","endpoint","lastIndexOf","length","clientToken","str","replace","computeTransportConfiguration","initConfiguration","isIntakeUrl","isFunction","isBoolean","isServerError","request","rumEndpoint","logsEndpoint","sessionReplayEndPoint","isIntakeRequest","notTakeRequest","push","some","takeUrl"],"sources":["../../src/configuration/transportConfiguration.js"],"sourcesContent":["import { isFunction, isBoolean, some } from '../helper/tools'\nvar TRIM_REGIX = /^\\s+|\\s+$/g\nvar typeMap = {\n  rum: '/rum',\n  log: '/logging',\n  sessionReplay: '/rum/replay'\n}\nfunction getEndPointUrl(configuration, type) {\n  // type: rum, log,replay\n  var subUrl = typeMap[type]\n  if (!subUrl) return ''\n  var url =\n    configuration.datakitOrigin ||\n    configuration.datakitUrl ||\n    configuration.site\n  if (url.indexOf('/') === 0) {\n    // 绝对路径这种 /xxx\n    url = location.origin + trim(url)\n  }\n  var endpoint = url\n  if (url.lastIndexOf('/') === url.length - 1) {\n    endpoint = trim(url) + 'v1/write' + subUrl\n  } else {\n    endpoint = trim(url) + '/v1/write' + subUrl\n  }\n  if (configuration.site && configuration.clientToken) {\n    endpoint =\n      endpoint + '?token=' + configuration.clientToken + '&to_headless=true'\n  }\n  return endpoint\n}\n\nfunction trim(str) {\n  return str.replace(TRIM_REGIX, '')\n}\n\nexport function computeTransportConfiguration(initConfiguration) {\n  var isIntakeUrl = function (url) {\n    return false\n  }\n  if (\n    'isIntakeUrl' in initConfiguration &&\n    isFunction(initConfiguration.isIntakeUrl) &&\n    isBoolean(initConfiguration.isIntakeUrl())\n  ) {\n    isIntakeUrl = initConfiguration.isIntakeUrl\n  }\n  var isServerError = function (request) {\n    return false\n  }\n  if (\n    'isServerError' in initConfiguration &&\n    isFunction(initConfiguration.isServerError) &&\n    isBoolean(initConfiguration.isServerError())\n  ) {\n    isServerError = initConfiguration.isServerError\n  }\n  return {\n    rumEndpoint: getEndPointUrl(initConfiguration, 'rum'),\n    logsEndpoint: getEndPointUrl(initConfiguration, 'log'),\n    sessionReplayEndPoint: getEndPointUrl(initConfiguration, 'sessionReplay'),\n    isIntakeUrl: isIntakeUrl,\n    isServerError: isServerError\n  }\n}\nexport function isIntakeRequest(url, configuration) {\n  var notTakeRequest = [configuration.rumEndpoint]\n  if (configuration.logsEndpoint) {\n    notTakeRequest.push(configuration.logsEndpoint)\n  }\n  if (configuration.sessionReplayEndPoint) {\n    notTakeRequest.push(configuration.sessionReplayEndPoint)\n  }\n  // datakit 地址，log 地址，以及客户自定义过滤方法定义url\n  return (\n    some(notTakeRequest, function (takeUrl) {\n      return url.indexOf(takeUrl) === 0\n    }) || configuration.isIntakeUrl(url)\n  )\n}\n"],"mappings":"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","ignoreList":[]}