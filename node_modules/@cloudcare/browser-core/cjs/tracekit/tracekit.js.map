{"version":3,"file":"tracekit.js","names":["_instrumentMethod","require","_tools","_computeStackTrace","ERROR_TYPES_RE","startUnhandledErrorCollection","callback","_instrumentOnError","instrumentOnError","_instrumentUnhandledRejection","instrumentUnhandledRejection","stop","instrumentMethodAndCallOriginal","window","before","messageObj","url","line","column","errorObj","stackTrace","Error","computeStackTrace","location","parse","tryToParseMessage","name","message","stack","isNullUndefinedDefaultValue","toString","call","groups","exec","e","reason"],"sources":["../../src/tracekit/tracekit.js"],"sourcesContent":["import { instrumentMethodAndCallOriginal } from '../helper/instrumentMethod'\nimport { isNullUndefinedDefaultValue } from '../helper/tools'\nimport { computeStackTrace } from './computeStackTrace'\n\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Error_types\nvar ERROR_TYPES_RE =\n  /^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?([\\s\\S]*)$/\n/**\n * Cross-browser collection of unhandled errors\n *\n * Supports:\n * - Firefox: full stack trace with line numbers, plus column number\n * on top frame; column number is not guaranteed\n * - Opera: full stack trace with line and column numbers\n * - Chrome: full stack trace with line and column numbers\n * - Safari: line and column number for the top frame only; some frames\n * may be missing, and column number is not guaranteed\n * - IE: line and column number for the top frame only; some frames\n * may be missing, and column number is not guaranteed\n *\n * In theory, TraceKit should work on all of the following versions:\n * - IE5.5+ (only 8.0 tested)\n * - Firefox 0.9+ (only 3.5+ tested)\n * - Opera 7+ (only 10.50 tested; versions 9 and earlier may require\n * Exceptions Have Stacktrace to be enabled in opera:config)\n * - Safari 3+ (only 4+ tested)\n * - Chrome 1+ (only 5+ tested)\n * - Konqueror 3.5+ (untested)\n *\n * Tries to catch all unhandled errors and report them to the\n * callback.\n *\n * Callbacks receive a StackTrace object as described in the\n * computeStackTrace docs.\n *\n * @memberof TraceKit\n * @namespace\n */\n\nexport function startUnhandledErrorCollection(callback) {\n  var _instrumentOnError = instrumentOnError(callback)\n  var _instrumentUnhandledRejection = instrumentUnhandledRejection(callback)\n  return {\n    stop: function () {\n      _instrumentOnError.stop()\n      _instrumentUnhandledRejection.stop()\n    }\n  }\n}\n\n/**\n * Install a global onerror handler\n */\nfunction instrumentOnError(callback) {\n  return instrumentMethodAndCallOriginal(window, 'onerror', {\n    before: function (messageObj, url, line, column, errorObj) {\n      var stackTrace\n      if (errorObj instanceof Error) {\n        stackTrace = computeStackTrace(errorObj)\n      } else {\n        var location = {\n          url: url,\n          column: column,\n          line: line\n        }\n        var parse = tryToParseMessage(messageObj)\n\n        stackTrace = {\n          name: parse.name,\n          message: parse.message,\n          stack: [location]\n        }\n      }\n      callback(stackTrace, isNullUndefinedDefaultValue(errorObj, messageObj))\n    }\n  })\n}\nfunction tryToParseMessage(messageObj) {\n  let name\n  let message\n  if ({}.toString.call(messageObj) === '[object String]') {\n    var groups = ERROR_TYPES_RE.exec(messageObj)\n    if (groups) {\n      name = groups[1]\n      message = groups[2]\n    }\n  }\n  return { name: name, message: message }\n}\n/**\n * Install a global onunhandledrejection handler\n */\nfunction instrumentUnhandledRejection(callback) {\n  return instrumentMethodAndCallOriginal(window, 'onunhandledrejection', {\n    before: function (e) {\n      var reason = e.reason || 'Empty reason'\n      var stack = computeStackTrace(reason)\n      callback(stack, reason)\n    }\n  })\n}\n"],"mappings":";;;;;;AAAA,IAAAA,iBAAA,GAAAC,OAAA;AACA,IAAAC,MAAA,GAAAD,OAAA;AACA,IAAAE,kBAAA,GAAAF,OAAA;AAEA;AACA,IAAIG,cAAc,GAChB,8GAA8G;AAChH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEO,SAASC,6BAA6BA,CAACC,QAAQ,EAAE;EACtD,IAAIC,kBAAkB,GAAGC,iBAAiB,CAACF,QAAQ,CAAC;EACpD,IAAIG,6BAA6B,GAAGC,4BAA4B,CAACJ,QAAQ,CAAC;EAC1E,OAAO;IACLK,IAAI,EAAE,SAAAA,KAAA,EAAY;MAChBJ,kBAAkB,CAACI,IAAI,CAAC,CAAC;MACzBF,6BAA6B,CAACE,IAAI,CAAC,CAAC;IACtC;EACF,CAAC;AACH;;AAEA;AACA;AACA;AACA,SAASH,iBAAiBA,CAACF,QAAQ,EAAE;EACnC,OAAO,IAAAM,iDAA+B,EAACC,MAAM,EAAE,SAAS,EAAE;IACxDC,MAAM,EAAE,SAAAA,OAAUC,UAAU,EAAEC,GAAG,EAAEC,IAAI,EAAEC,MAAM,EAAEC,QAAQ,EAAE;MACzD,IAAIC,UAAU;MACd,IAAID,QAAQ,YAAYE,KAAK,EAAE;QAC7BD,UAAU,GAAG,IAAAE,oCAAiB,EAACH,QAAQ,CAAC;MAC1C,CAAC,MAAM;QACL,IAAII,QAAQ,GAAG;UACbP,GAAG,EAAEA,GAAG;UACRE,MAAM,EAAEA,MAAM;UACdD,IAAI,EAAEA;QACR,CAAC;QACD,IAAIO,KAAK,GAAGC,iBAAiB,CAACV,UAAU,CAAC;QAEzCK,UAAU,GAAG;UACXM,IAAI,EAAEF,KAAK,CAACE,IAAI;UAChBC,OAAO,EAAEH,KAAK,CAACG,OAAO;UACtBC,KAAK,EAAE,CAACL,QAAQ;QAClB,CAAC;MACH;MACAjB,QAAQ,CAACc,UAAU,EAAE,IAAAS,kCAA2B,EAACV,QAAQ,EAAEJ,UAAU,CAAC,CAAC;IACzE;EACF,CAAC,CAAC;AACJ;AACA,SAASU,iBAAiBA,CAACV,UAAU,EAAE;EACrC,IAAIW,IAAI;EACR,IAAIC,OAAO;EACX,IAAI,CAAC,CAAC,CAACG,QAAQ,CAACC,IAAI,CAAChB,UAAU,CAAC,KAAK,iBAAiB,EAAE;IACtD,IAAIiB,MAAM,GAAG5B,cAAc,CAAC6B,IAAI,CAAClB,UAAU,CAAC;IAC5C,IAAIiB,MAAM,EAAE;MACVN,IAAI,GAAGM,MAAM,CAAC,CAAC,CAAC;MAChBL,OAAO,GAAGK,MAAM,CAAC,CAAC,CAAC;IACrB;EACF;EACA,OAAO;IAAEN,IAAI,EAAEA,IAAI;IAAEC,OAAO,EAAEA;EAAQ,CAAC;AACzC;AACA;AACA;AACA;AACA,SAASjB,4BAA4BA,CAACJ,QAAQ,EAAE;EAC9C,OAAO,IAAAM,iDAA+B,EAACC,MAAM,EAAE,sBAAsB,EAAE;IACrEC,MAAM,EAAE,SAAAA,OAAUoB,CAAC,EAAE;MACnB,IAAIC,MAAM,GAAGD,CAAC,CAACC,MAAM,IAAI,cAAc;MACvC,IAAIP,KAAK,GAAG,IAAAN,oCAAiB,EAACa,MAAM,CAAC;MACrC7B,QAAQ,CAACsB,KAAK,EAAEO,MAAM,CAAC;IACzB;EACF,CAAC,CAAC;AACJ","ignoreList":[]}