{"version":3,"file":"createEventRateLimiter.js","names":["_errorTools","require","_tools","_timer","createEventRateLimiter","eventType","limit","onLimitReached","eventCount","allowNextEvent","isLimitReached","setTimeout","ONE_MINUTE","message","source","ErrorSource","AGENT","startClocks","clocksNow"],"sources":["../../src/helper/createEventRateLimiter.js"],"sourcesContent":["import { ErrorSource } from './errorTools'\nimport { clocksNow, ONE_MINUTE } from './tools'\nimport { setTimeout } from './timer'\nexport function createEventRateLimiter(eventType, limit, onLimitReached) {\n  var eventCount = 0\n  var allowNextEvent = false\n  return {\n    isLimitReached: function () {\n      if (eventCount === 0) {\n        setTimeout(function () {\n          eventCount = 0\n        }, ONE_MINUTE)\n      }\n      eventCount += 1\n      if (eventCount <= limit || allowNextEvent) {\n        allowNextEvent = false\n        return false\n      }\n      if (eventCount === limit + 1) {\n        allowNextEvent = true\n        try {\n          onLimitReached({\n            message:\n              'Reached max number of ' + eventType + 's by minute: ' + limit,\n            source: ErrorSource.AGENT,\n            startClocks: clocksNow()\n          })\n        } finally {\n          allowNextEvent = false\n        }\n      }\n      return true\n    }\n  }\n}\n"],"mappings":";;;;;;AAAA,IAAAA,WAAA,GAAAC,OAAA;AACA,IAAAC,MAAA,GAAAD,OAAA;AACA,IAAAE,MAAA,GAAAF,OAAA;AACO,SAASG,sBAAsBA,CAACC,SAAS,EAAEC,KAAK,EAAEC,cAAc,EAAE;EACvE,IAAIC,UAAU,GAAG,CAAC;EAClB,IAAIC,cAAc,GAAG,KAAK;EAC1B,OAAO;IACLC,cAAc,EAAE,SAAAA,eAAA,EAAY;MAC1B,IAAIF,UAAU,KAAK,CAAC,EAAE;QACpB,IAAAG,iBAAU,EAAC,YAAY;UACrBH,UAAU,GAAG,CAAC;QAChB,CAAC,EAAEI,iBAAU,CAAC;MAChB;MACAJ,UAAU,IAAI,CAAC;MACf,IAAIA,UAAU,IAAIF,KAAK,IAAIG,cAAc,EAAE;QACzCA,cAAc,GAAG,KAAK;QACtB,OAAO,KAAK;MACd;MACA,IAAID,UAAU,KAAKF,KAAK,GAAG,CAAC,EAAE;QAC5BG,cAAc,GAAG,IAAI;QACrB,IAAI;UACFF,cAAc,CAAC;YACbM,OAAO,EACL,wBAAwB,GAAGR,SAAS,GAAG,eAAe,GAAGC,KAAK;YAChEQ,MAAM,EAAEC,uBAAW,CAACC,KAAK;YACzBC,WAAW,EAAE,IAAAC,gBAAS,EAAC;UACzB,CAAC,CAAC;QACJ,CAAC,SAAS;UACRT,cAAc,GAAG,KAAK;QACxB;MACF;MACA,OAAO,IAAI;IACb;EACF,CAAC;AACH","ignoreList":[]}