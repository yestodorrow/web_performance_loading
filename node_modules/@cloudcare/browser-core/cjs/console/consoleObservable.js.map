{"version":3,"file":"consoleObservable.js","names":["_tracekit","require","_errorTools","_observable","_tools","_jsonStringify","_display","_monitor","consoleObservablesByApi","initConsoleObservable","apis","consoleObservables","map","api","createConsoleObservable","mergeObservables","apply","Observable","observable","originalConsoleApi","console","params","slice","call","arguments","handlingStack","createHandlingStack","callMonitored","notify","buildConsoleLog","message","param","formatConsoleParameters","join","stack","causes","ConsoleApiName","error","firstErrorParam","find","Error","toStackTraceString","computeStackTrace","undefined","flattenErrorCauses","formatErrorMessage","jsonStringify"],"sources":["../../src/console/consoleObservable.js"],"sourcesContent":["import { computeStackTrace } from '../tracekit'\nimport {\n  createHandlingStack,\n  formatErrorMessage,\n  toStackTraceString,\n  flattenErrorCauses\n} from '../helper/errorTools'\nimport { mergeObservables, Observable } from '../helper/observable'\nimport { find, map } from '../helper/tools'\nimport { jsonStringify } from '../helper/serialisation/jsonStringify'\nimport { ConsoleApiName } from '../helper/display'\nimport { callMonitored } from '../helper/monitor'\nvar consoleObservablesByApi = {}\n\nexport function initConsoleObservable(apis) {\n  var consoleObservables = map(apis, function (api) {\n    if (!consoleObservablesByApi[api]) {\n      consoleObservablesByApi[api] = createConsoleObservable(api)\n    }\n    return consoleObservablesByApi[api]\n  })\n\n  return mergeObservables.apply(this, consoleObservables)\n}\n\n/* eslint-disable no-console */\nfunction createConsoleObservable(api) {\n  return new Observable(function (observable) {\n    var originalConsoleApi = console[api]\n    console[api] = function () {\n      var params = [].slice.call(arguments)\n      originalConsoleApi.apply(console, arguments)\n      var handlingStack = createHandlingStack()\n      callMonitored(function () {\n        observable.notify(buildConsoleLog(params, api, handlingStack))\n      })\n    }\n    return function () {\n      console[api] = originalConsoleApi\n    }\n  })\n}\n\nfunction buildConsoleLog(params, api, handlingStack) {\n  var message = map(params, function (param) {\n    return formatConsoleParameters(param)\n  }).join(' ')\n  var stack\n  var causes\n  if (api === ConsoleApiName.error) {\n    var firstErrorParam = find(params, function (param) {\n      return param instanceof Error\n    })\n    stack = firstErrorParam\n      ? toStackTraceString(computeStackTrace(firstErrorParam))\n      : undefined\n    message = 'console error: ' + message\n    causes = firstErrorParam\n      ? flattenErrorCauses(firstErrorParam, 'console')\n      : undefined\n  }\n\n  return {\n    api: api,\n    message: message,\n    stack: stack,\n    handlingStack: handlingStack,\n    causes: causes\n  }\n}\n\nfunction formatConsoleParameters(param) {\n  if (typeof param === 'string') {\n    return param\n  }\n  if (param instanceof Error) {\n    return formatErrorMessage(computeStackTrace(param))\n  }\n  return jsonStringify(param, undefined, 2)\n}\n"],"mappings":"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","ignoreList":[]}