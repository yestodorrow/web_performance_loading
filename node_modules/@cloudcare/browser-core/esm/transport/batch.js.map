{"version":3,"file":"batch.js","names":["display","values","findByPath","each","isNumber","isArray","extend","isString","isEmptyObject","isObject","escapeJsonValue","escapeRowField","escapeRowData","commonTags","dataMap","commonFields","RumEventType","computeBytesCount","isPageExitReason","jsonStringify","HAS_MULTI_BYTES_CHARACTERS","CUSTOM_KEYS","processedMessageByDataMap","message","type","rowStr","rowData","undefined","tags","fields","hasFileds","value","key","measurement","tagsStr","filterFileds","value_path","_key","_value","push","fieldsStr","length","_valueData","context","_tagKeys","indexOf","LOGGER","join","date","time","batch","request","flushController","messageBytesLimit","sendContentTypeByJson","pushOnlyBuffer","upsertBuffer","_this","flushObservable","subscribe","event","flush","prototype","add","addOrUpdate","upsert","messages","concat","payloadData","payload","data","bytesCount","flushReason","reason","sendOnExit","send","_process","process","processedMessage","messageBytesCount","warn","hasMessageFor","remove","separatorBytesCount","getMessagesCount","notifyBeforeAddMessage","notifyAfterAddMessage","removedMessage","notifyAfterRemoveMessage","Batch"],"sources":["../../src/transport/batch.js"],"sourcesContent":["import { display } from '../helper/display'\nimport {\n  values,\n  findByPath,\n  each,\n  isNumber,\n  isArray,\n  extend,\n  isString,\n  isEmptyObject,\n  isObject\n} from '../helper/tools'\nimport {\n  escapeJsonValue,\n  escapeRowField,\n  escapeRowData\n} from '../helper/serialisation/rowData'\nimport { commonTags, dataMap, commonFields } from '../dataMap'\nimport { RumEventType } from '../helper/enums'\nimport { computeBytesCount } from '../helper/byteUtils'\nimport { isPageExitReason } from '../browser/pageExitObservable'\nimport { jsonStringify } from '../helper/serialisation/jsonStringify'\n// https://en.wikipedia.org/wiki/UTF-8\n// eslint-disable-next-line no-control-regex\nvar HAS_MULTI_BYTES_CHARACTERS = /[^\\u0000-\\u007F]/\nvar CUSTOM_KEYS = 'custom_keys'\nexport var processedMessageByDataMap = function (message) {\n  if (!message || !message.type)\n    return {\n      rowStr: '',\n      rowData: undefined\n    }\n\n  var rowData = { tags: {}, fields: {} }\n  var hasFileds = false\n  var rowStr = ''\n  each(dataMap, function (value, key) {\n    if (value.type === message.type) {\n      rowStr += key + ','\n      rowData.measurement = key\n      var tagsStr = []\n      var tags = extend({}, commonTags, value.tags)\n      var filterFileds = ['date', 'type', CUSTOM_KEYS] // 已经在datamap中定义过的fields和tags\n      each(tags, function (value_path, _key) {\n        var _value = findByPath(message, value_path)\n        filterFileds.push(_key)\n        if (_value || isNumber(_value)) {\n          rowData.tags[_key] = escapeJsonValue(_value, true)\n          tagsStr.push(escapeRowData(_key) + '=' + escapeRowData(_value))\n        }\n      })\n\n      var fieldsStr = []\n      var fields = extend({}, commonFields, value.fields)\n      each(fields, function (_value, _key) {\n        if (isArray(_value) && _value.length === 2) {\n          var value_path = _value[1]\n          var _valueData = findByPath(message, value_path)\n          filterFileds.push(_key)\n          if (_valueData !== undefined && _valueData !== null) {\n            rowData.fields[_key] = escapeJsonValue(_valueData) // 这里不需要转译\n            fieldsStr.push(\n              escapeRowData(_key) + '=' + escapeRowField(_valueData)\n            )\n          }\n        } else if (isString(_value)) {\n          var _valueData = findByPath(message, _value)\n          filterFileds.push(_key)\n          if (_valueData !== undefined && _valueData !== null) {\n            rowData.fields[_key] = escapeJsonValue(_valueData) // 这里不需要转译\n            fieldsStr.push(\n              escapeRowData(_key) + '=' + escapeRowField(_valueData)\n            )\n          }\n        }\n      })\n      if (\n        message.context &&\n        isObject(message.context) &&\n        !isEmptyObject(message.context)\n      ) {\n        // 自定义tag， 存储成field\n        var _tagKeys = []\n        each(message.context, function (_value, _key) {\n          // 如果和之前tag重名，则舍弃\n          if (filterFileds.indexOf(_key) > -1) return\n          filterFileds.push(_key)\n          if (_value !== undefined && _value !== null) {\n            _tagKeys.push(_key)\n            rowData.fields[_key] = escapeJsonValue(_value) // 这里不需要转译\n            fieldsStr.push(escapeRowData(_key) + '=' + escapeRowField(_value))\n          }\n        })\n        if (_tagKeys.length) {\n          rowData.fields[CUSTOM_KEYS] = escapeJsonValue(_tagKeys)\n          fieldsStr.push(\n            escapeRowData(CUSTOM_KEYS) + '=' + escapeRowField(_tagKeys)\n          )\n        }\n      }\n      if (message.type === RumEventType.LOGGER) {\n        // 这里处理日志类型数据自定义字段\n        each(message, function (value, key) {\n          if (\n            filterFileds.indexOf(key) === -1 &&\n            value !== undefined &&\n            value !== null\n          ) {\n            rowData.fields[key] = escapeJsonValue(value) // 这里不需要转译\n            fieldsStr.push(escapeRowData(key) + '=' + escapeRowField(value))\n          }\n        })\n      }\n      if (tagsStr.length) {\n        rowStr += tagsStr.join(',')\n      }\n      if (fieldsStr.length) {\n        rowStr += ' '\n        rowStr += fieldsStr.join(',')\n        hasFileds = true\n      }\n      rowStr = rowStr + ' ' + message.date\n      rowData.time = message.date // 这里不需要转译\n    }\n  })\n  return {\n    rowStr: hasFileds ? rowStr : '',\n    rowData: hasFileds ? rowData : undefined\n  }\n}\nvar batch = function (\n  request,\n  flushController,\n  messageBytesLimit,\n  sendContentTypeByJson\n) {\n  this.pushOnlyBuffer = []\n  this.upsertBuffer = {}\n  this.request = request\n  this.flushController = flushController\n  this.messageBytesLimit = messageBytesLimit\n  this.sendContentTypeByJson = sendContentTypeByJson\n  var _this = this\n  this.flushController.flushObservable.subscribe(function (event) {\n    _this.flush(event)\n  })\n}\nbatch.prototype.add = function (message) {\n  this.addOrUpdate(message)\n}\nbatch.prototype.upsert = function (message, key) {\n  this.addOrUpdate(message, key)\n}\nbatch.prototype.flush = function (event) {\n  var messages = this.pushOnlyBuffer.concat(values(this.upsertBuffer))\n  this.pushOnlyBuffer = []\n  this.upsertBuffer = {}\n  if (messages.length > 0) {\n    var payloadData = ''\n    if (this.sendContentTypeByJson) {\n      payloadData = '[' + messages.join(',') + ']'\n    } else {\n      payloadData = messages.join('\\n')\n    }\n    var payload = {\n      data: payloadData,\n      bytesCount: event.bytesCount,\n      flushReason: event.reason\n    }\n    if (isPageExitReason(event.reason)) {\n      this.request.sendOnExit(payload)\n    } else {\n      this.request.send(payload)\n    }\n  }\n}\n\nbatch.prototype.addOrUpdate = function (message, key) {\n  var _process = this.process(message)\n  var processedMessage = _process.processedMessage\n  var messageBytesCount = _process.messageBytesCount\n  if (messageBytesCount >= this.messageBytesLimit) {\n    display.warn(\n      'Discarded a message whose size was bigger than the maximum allowed size ' +\n        this.messageBytesLimit +\n        'KB.'\n    )\n    return\n  }\n  if (this.hasMessageFor(key)) {\n    this.remove(key)\n  }\n  this.push(processedMessage, messageBytesCount, key)\n}\nbatch.prototype.process = function (message) {\n  var processedMessage = ''\n  if (this.sendContentTypeByJson) {\n    processedMessage = jsonStringify(processedMessageByDataMap(message).rowData)\n  } else {\n    processedMessage = processedMessageByDataMap(message).rowStr\n  }\n  var messageBytesCount = computeBytesCount(processedMessage)\n  return {\n    processedMessage: processedMessage,\n    messageBytesCount: messageBytesCount\n  }\n}\n\nbatch.prototype.push = function (processedMessage, messageBytesCount, key) {\n  var separatorBytesCount = this.flushController.getMessagesCount() > 0 ? 1 : 0\n  this.flushController.notifyBeforeAddMessage(\n    messageBytesCount + separatorBytesCount\n  )\n  if (key !== undefined) {\n    this.upsertBuffer[key] = processedMessage\n  } else {\n    this.pushOnlyBuffer.push(processedMessage)\n  }\n  this.flushController.notifyAfterAddMessage()\n}\n\nbatch.prototype.remove = function (key) {\n  var removedMessage = this.upsertBuffer[key]\n  delete this.upsertBuffer[key]\n  var messageBytesCount = computeBytesCount(removedMessage)\n  // If there are other messages, a '\\n' will be added at serialization\n  var separatorBytesCount = this.flushController.getMessagesCount() > 1 ? 1 : 0\n  this.flushController.notifyAfterRemoveMessage(\n    messageBytesCount + separatorBytesCount\n  )\n}\n\nbatch.prototype.hasMessageFor = function (key) {\n  return key !== undefined && this.upsertBuffer[key] !== undefined\n}\nexport var Batch = batch\n"],"mappings":"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","ignoreList":[]}