{"version":3,"file":"cookie.js","names":["findCommaSeparatedValue","UUID","ONE_SECOND","findCommaSeparatedValues","COOKIE_ACCESS_DELAY","setCookie","name","value","expireDelay","options","date","Date","setTime","getTime","expires","toUTCString","sameSite","crossSite","domain","secure","partitioned","document","cookie","getCookie","initCookieParsed","getInitCookie","get","resetInitCookies","undefined","deleteCookie","areCookiesAuthorized","testCookieName","concat","testCookieValue","error","getCurrentSiteCache","getCurrentSite","domainLevels","window","location","hostname","split","candidateDomain","pop","length"],"sources":["../../src/browser/cookie.js"],"sourcesContent":["import {\n  findCommaSeparatedValue,\n  UUID,\n  ONE_SECOND,\n  findCommaSeparatedValues\n} from '../helper/tools'\nexport var COOKIE_ACCESS_DELAY = ONE_SECOND\n\nexport function setCookie(name, value, expireDelay, options) {\n  var date = new Date()\n  date.setTime(date.getTime() + expireDelay)\n  var expires = 'expires=' + date.toUTCString()\n  var sameSite = options && options.crossSite ? 'none' : 'strict'\n  var domain = options && options.domain ? ';domain=' + options.domain : ''\n  var secure = options && options.secure ? ';secure' : ''\n  var partitioned = options && options.partitioned ? ';partitioned' : ''\n  document.cookie =\n    name +\n    '=' +\n    value +\n    ';' +\n    expires +\n    ';path=/;samesite=' +\n    sameSite +\n    domain +\n    secure +\n    partitioned\n}\n\nexport function getCookie(name) {\n  return findCommaSeparatedValue(document.cookie, name)\n}\nvar initCookieParsed\n/**\n * Returns a cached value of the cookie. Use this during SDK initialization (and whenever possible)\n * to avoid accessing document.cookie multiple times.\n */\nexport function getInitCookie(name) {\n  if (!initCookieParsed) {\n    initCookieParsed = findCommaSeparatedValues(document.cookie)\n  }\n  return initCookieParsed.get(name)\n}\n\nexport function resetInitCookies() {\n  initCookieParsed = undefined\n}\nexport function deleteCookie(name, options) {\n  setCookie(name, '', 0, options)\n}\n\nexport function areCookiesAuthorized(options) {\n  if (document.cookie === undefined || document.cookie === null) {\n    return false\n  }\n  try {\n    // Use a unique cookie name to avoid issues when the SDK is initialized multiple times during\n    // the test cookie lifetime\n    var testCookieName = `gc_cookie_test_${UUID()}`\n    var testCookieValue = 'test'\n    setCookie(testCookieName, testCookieValue, ONE_SECOND, options)\n    return getCookie(testCookieName) === testCookieValue\n  } catch (error) {\n    return false\n  }\n}\n\n/**\n * No API to retrieve it, number of levels for subdomain and suffix are unknown\n * strategy: find the minimal domain on which cookies are allowed to be set\n * https://web.dev/same-site-same-origin/#site\n */\nvar getCurrentSiteCache\nexport function getCurrentSite() {\n  if (getCurrentSiteCache === undefined) {\n    // Use a unique cookie name to avoid issues when the SDK is initialized multiple times during\n    // the test cookie lifetime\n    var testCookieName = `gc_site_test_${UUID()}`\n    var testCookieValue = 'test'\n\n    var domainLevels = window.location.hostname.split('.')\n    var candidateDomain = domainLevels.pop()\n    while (domainLevels.length && !getCookie(testCookieName)) {\n      candidateDomain = domainLevels.pop() + '.' + candidateDomain\n      setCookie(testCookieName, testCookieValue, ONE_SECOND, {\n        domain: candidateDomain\n      })\n    }\n    getCurrentSiteCache = candidateDomain\n  }\n  return getCurrentSiteCache\n}\n"],"mappings":"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","ignoreList":[]}