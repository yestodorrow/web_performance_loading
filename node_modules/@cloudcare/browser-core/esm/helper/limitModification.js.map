{"version":3,"file":"limitModification.js","names":["extend2Lev","each","objectEntries","getType","deepClone","sanitize","limitModification","object","modifiableFieldPaths","modifier","clone","result","filedPaths","fieldPath","fieldType","newValue","get","newType","set","path","current","_iterator","_createForOfIteratorHelper","split","_step","s","n","done","field","value","isValidObjectContaining","err","e","f","fields","i","length","isValidObject","Object","prototype","hasOwnProperty","call"],"sources":["../../src/helper/limitModification.js"],"sourcesContent":["import { extend2Lev, each, objectEntries, getType, deepClone } from './tools'\nimport { sanitize } from './sanitize'\n\n/**\n * Current limitation:\n * - field path do not support array, 'a.b.c' only\n */\nexport function limitModification(object, modifiableFieldPaths, modifier) {\n  var clone = deepClone(object)\n  var result = modifier(clone)\n  each(objectEntries(modifiableFieldPaths), function (filedPaths) {\n    var fieldPath = filedPaths[0]\n    var fieldType = filedPaths[1]\n    var newValue = get(clone, fieldPath)\n    var newType = getType(newValue)\n    if (newType === fieldType) {\n      set(object, fieldPath, sanitize(newValue))\n    } else if (\n      fieldType === 'object' &&\n      (newType === 'undefined' || newType === 'null')\n    ) {\n      set(object, fieldPath, {})\n    }\n  })\n\n  return result\n}\n\nfunction get(object, path) {\n  var current = object\n  for (var field of path.split('.')) {\n    if (!isValidObjectContaining(current, field)) {\n      return\n    }\n    current = current[field]\n  }\n  return current\n}\n\nfunction set(object, path, value) {\n  var current = object\n  var fields = path.split('.')\n  for (var i = 0; i < fields.length; i += 1) {\n    var field = fields[i]\n    if (!isValidObject(current)) {\n      return\n    }\n    if (i !== fields.length - 1) {\n      current = current[field]\n    } else {\n      current[field] = value\n    }\n  }\n}\n\nfunction isValidObject(object) {\n  return getType(object) === 'object'\n}\n\nfunction isValidObjectContaining(object, field) {\n  return (\n    isValidObject(object) && Object.prototype.hasOwnProperty.call(object, field)\n  )\n}\n"],"mappings":"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","ignoreList":[]}