{"version":3,"file":"configuration.js","names":["getCurrentSite","catchUserErrors","display","assign","isPercentage","ONE_SECOND","isNullUndefinedDefaultValue","ONE_KIBI_BYTE","computeTransportConfiguration","DefaultPrivacyLevel","ALLOW","MASK","MASK_USER_INPUT","validateAndBuildConfiguration","initConfiguration","sampleRate","undefined","error","sessionSampleRate","telemetrySampleRate","beforeSend","cookieOptions","buildCookieOptions","service","version","env","telemetryEnabled","silentMultipleInit","batchBytesLimit","eventRateLimiterThreshold","maxTelemetryEventsPerPage","flushTimeout","batchMessagesLimit","messageBytesLimit","resourceUrlLimit","storeContextsToLocal","sendContentTypeByJson","validatePostRequestRequireParamsConfiguration","site","datakitOrigin","datakitUrl","clientToken","secure","useSecureSessionCookie","usePartitionedCrossSiteSessionCookie","useCrossSiteSessionCookie","crossSite","partitioned","trackSessionAcrossSubdomains","domain"],"sources":["../../src/configuration/configuration.js"],"sourcesContent":["import { getCurrentSite } from '../browser/cookie'\nimport { catchUserErrors } from '../helper/catchUserErrors'\nimport { display } from '../helper/display'\nimport {\n  assign,\n  isPercentage,\n  ONE_SECOND,\n  isNullUndefinedDefaultValue\n} from '../helper/tools'\nimport { ONE_KIBI_BYTE } from '../helper/byteUtils'\nimport { computeTransportConfiguration } from './transportConfiguration'\n\nexport var DefaultPrivacyLevel = {\n  ALLOW: 'allow',\n  MASK: 'mask',\n  MASK_USER_INPUT: 'mask-user-input'\n}\nexport function validateAndBuildConfiguration(initConfiguration) {\n  if (\n    initConfiguration.sampleRate !== undefined &&\n    !isPercentage(initConfiguration.sampleRate)\n  ) {\n    display.error('Sample Rate should be a number between 0 and 100')\n    return\n  }\n  if (\n    initConfiguration.sessionSampleRate !== undefined &&\n    !isPercentage(initConfiguration.sessionSampleRate)\n  ) {\n    display.error('Sample Rate should be a number between 0 and 100')\n    return\n  }\n  if (\n    initConfiguration.telemetrySampleRate !== undefined &&\n    !isPercentage(initConfiguration.telemetrySampleRate)\n  ) {\n    display.error('Telemetry Sample Rate should be a number between 0 and 100')\n    return\n  }\n  var sessionSampleRate =\n    initConfiguration.sessionSampleRate || initConfiguration.sampleRate\n  return assign(\n    {\n      beforeSend:\n        initConfiguration.beforeSend &&\n        catchUserErrors(\n          initConfiguration.beforeSend,\n          'beforeSend threw an error:'\n        ),\n      cookieOptions: buildCookieOptions(initConfiguration),\n      sessionSampleRate: isNullUndefinedDefaultValue(sessionSampleRate, 100),\n      service: initConfiguration.service,\n      version: initConfiguration.version,\n      env: initConfiguration.env,\n      telemetrySampleRate: isNullUndefinedDefaultValue(\n        initConfiguration.telemetrySampleRate,\n        100\n      ),\n      telemetryEnabled: isNullUndefinedDefaultValue(\n        initConfiguration.telemetryEnabled,\n        false\n      ),\n      silentMultipleInit: !!initConfiguration.silentMultipleInit,\n\n      /**\n       * beacon payload max queue size implementation is 64kb\n       * ensure that we leave room for logs, rum and potential other users\n       */\n      batchBytesLimit: 16 * ONE_KIBI_BYTE,\n\n      eventRateLimiterThreshold: 3000,\n      maxTelemetryEventsPerPage: 15,\n\n      /**\n       * flush automatically, aim to be lower than ALB connection timeout\n       * to maximize connection reuse.\n       */\n      flushTimeout: 30 * ONE_SECOND,\n\n      /**\n       * Logs intake limit\n       */\n      batchMessagesLimit: 50,\n      messageBytesLimit: 256 * ONE_KIBI_BYTE,\n      resourceUrlLimit: 5 * ONE_KIBI_BYTE,\n      storeContextsToLocal: !!initConfiguration.storeContextsToLocal,\n      sendContentTypeByJson: !!initConfiguration.sendContentTypeByJson\n    },\n    computeTransportConfiguration(initConfiguration)\n  )\n}\nexport function validatePostRequestRequireParamsConfiguration(\n  initConfiguration\n) {\n  if (\n    !initConfiguration.site &&\n    !initConfiguration.datakitOrigin &&\n    !initConfiguration.datakitUrl\n  ) {\n    display.error(\n      'datakitOrigin or site is not configured, no RUM data will be collected.'\n    )\n    return false\n  }\n  //   if (!initConfiguration.datakitUrl && !initConfiguration.datakitOrigin) {\n  //     display.error(\n  //       'datakitOrigin is not configured, no RUM data will be collected.'\n  //     )\n  //     return false\n  //   }\n  if (initConfiguration.site && !initConfiguration.clientToken) {\n    display.error(\n      'clientToken is not configured, no RUM data will be collected.'\n    )\n    return false\n  }\n  return true\n}\nexport function buildCookieOptions(initConfiguration) {\n  var cookieOptions = {}\n\n  //   cookieOptions.secure = mustUseSecureCookie(initConfiguration)\n  //   cookieOptions.crossSite = !!initConfiguration.useCrossSiteSessionCookie\n  cookieOptions.secure =\n    !!initConfiguration.useSecureSessionCookie ||\n    !!initConfiguration.usePartitionedCrossSiteSessionCookie ||\n    !!initConfiguration.useCrossSiteSessionCookie\n  cookieOptions.crossSite =\n    !!initConfiguration.usePartitionedCrossSiteSessionCookie ||\n    !!initConfiguration.useCrossSiteSessionCookie\n  cookieOptions.partitioned =\n    !!initConfiguration.usePartitionedCrossSiteSessionCookie\n  if (initConfiguration.trackSessionAcrossSubdomains) {\n    cookieOptions.domain = getCurrentSite()\n  }\n\n  return cookieOptions\n}\n\n// function mustUseSecureCookie(initConfiguration) {\n//   return (\n//     !!initConfiguration.useSecureSessionCookie ||\n//     !!initConfiguration.useCrossSiteSessionCookie\n//   )\n// }\n"],"mappings":"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","ignoreList":[]}